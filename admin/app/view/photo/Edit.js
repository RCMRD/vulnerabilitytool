Ext.define('VulnerabilityToolAdmin.view.photo.Edit', {
    extend: 'Ext.window.Window',
    alias : 'widget.photoEdit',
    title : 'Edit Photo',
    layout: 'fit',
    autoShow: true,
    modal: true,

    initComponent: function() {
        this.items = [
            {
                xtype: 'form',
                items: [
                    {
                        xtype: 'displayfield',
                        name : 'gid',
                        fieldLabel: 'ID'
                    },
                    {
                        xtype: 'textfield',
                        name : 'name',
                        fieldLabel: 'Location'
                    },
                    {
                        xtype: 'textfield',
                        name : 'description',
                        fieldLabel: 'Description'
                    },
                    {
                        xtype: 'numberfield',
                        name: 'longitude',
                        fieldLabel: 'Longitude',
                        maxValue: 50,
                        decimalPrecision: 6,
                        minValue: -20
                    },
                    {
                        xtype: 'numberfield',
                        name: 'latitude',
                        fieldLabel: 'Latitude',
                        decimalPrecision: 6,
                        maxValue: 50,
                        minValue: -20
                    },
                    {
                        xtype: 'datefield',
                        name: 'date',
                        fieldLabel: 'Collection Date'

                    },

                    Ext.widget('form', {

                        width: 400,
                        bodyPadding: 10,
                        html: '<div class="panelCont">Only images of png, jpg, and jpeg are allowed. Maximum file size allowed is 150 kbs. ' +
                        'Reduce image width and height to 800x600 pixels resolution. Optimize the images using image ' +
                        'editing software to reduce size.</div>',
                        items: [
                            {
                                xtype: 'filefield',
                                name: 'file',
                                fieldLabel: 'File',
                                labelWidth: 50,
                                regex: /(.)+((\.png)|(\.jpg)|(\.jpeg)(\w)?)$/i,
                                regexText: 'Only PNG, JPG and JPEG image formats are accepted',
                                anchor: '100%',

                                buttonText: 'Browse Image...'
                            },
                            {
                                buttons: [{
                                    text: 'Upload',
                                    handler: function () {
                                        var form = this.up('form').getForm();
                                        if (form.isValid()) {
                                            form.submit({
                                                url: 'data/Upload.php',
                                                waitMsg: 'Uploading your file...',
                                                success: function (f, a) {
                                                    var result = a.result;
                                                    var message = result.data.msg;
                                                    var fileName = result.data.name;
                                                    Ext.Msg.alert('Success', message);
                                                    Ext.getCmp("photo_id").setValue(fileName);
                                                },
                                                failure: function (f, a) {
                                                    Ext.Msg.alert('Failure', a.result.msg);
                                                }
                                            });
                                        }
                                    }
                                }]
                            }
                        ]
                    }),
                    {
                        xtype: 'hiddenfield',
                        id:'photo_id',
                        allowBlank: false,
                        name: 'photo'
                    }
                ]
            }
        ];

        this.buttons = [
            {
                text: 'Save',
                action: 'save'
            },
            {
                text: 'Cancel',
                scope: this,
                handler: this.close
            }
        ];

        this.callParent(arguments);
    }
});