Ext.define('VulnerabilityToolAdmin.controller.Photo', {
    extend: 'Ext.app.Controller',
    stores: ['Photo'],
    views: [
        'photo.List',
        'photo.Edit',
        'photo.Create'
    ],
    
    init: function() {
        this.control({
            'viewport > panel': {
                render: this.onPanelRendered
            },
            'photoList': {
                itemdblclick: this.editPhoto,
                selectionchange: this.selectPhoto
            },
            
            'photoList button[action=addPhoto]': {
                click: this.newPhoto
            },
            
            'photoList button[action=delete]': {
                click: this.deletePhotoClick
            },
            'photoEdit button[action=save]': {
                click: this.updatePhoto
               // click: this.uploadPhoto
            },
            'photoCreate button[action=save]': {
                click: this.createPhoto
            }
        });
    },
    
    onPanelRendered: function() {
        this.getPhotoStore().load({params:{start:0, limit:10}});
    },
    
    selectPhoto: function(selModel, selections) {
        var delBut = Ext.ComponentQuery.query('#deletePhoto')[0];
        delBut.setDisabled(false);
    },
    
    editPhoto: function(grid, record) {
        var view = Ext.widget('photoEdit');
        view.down('form').loadRecord(record);
        
    },
    
    newPhoto: function(button) {
        var view = Ext.widget('photoCreate');
        view.down('form');
    },
    
    updatePhoto: function(button) {
            var win    = button.up('window'),
            form   = win.down('form'),
            record = form.getRecord(),
            values = form.getValues();
            var viewEF = form.getForm();
        if (viewEF.isValid()) {
            record.set(values);
            win.close();
            this.getPhotoStore().sync();
        }
    },

    createPhoto: function(button) {
        console.log('clicked the Save button Create');
            var win    = button.up('window'),
            form   = win.down('form'),
            record = form.getRecord(),
            values = form.getValues();
        this.getPhotoStore().add(values);
        win.close();
        this.getPhotoStore().sync();
    },
    
    deletePhotoClick: function(selModel, selections) {

        var viewList = Ext.ComponentQuery.query('#photoID')[0];
        var selection=viewList.getSelectionModel().getSelection()[0];
        if(selection)
        {
            this.getPhotoStore().remove(selection);
            this.getPhotoStore().sync();
        }
        
    }
});