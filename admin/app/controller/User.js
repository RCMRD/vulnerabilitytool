Ext.define('VulnerabilityToolAdmin.controller.User', {
    extend: 'Ext.app.Controller',
    stores: ['User'],
    views: [
        'user.List',
        'user.Edit',
        'user.Create'
    ],
    
    init: function() {
        this.control({
            'viewport > panel': {
                render: this.onPanelRendered
            },
            'userList': {
                itemdblclick: this.editUser,
                selectionchange: this.selectUser
            },
            
            'userList button[action=addUser]': {
                click: this.newUser
            },
            
            'userList button[action=delete]': {
                click: this.deleteUserClick
            },
            'userEdit button[action=save]': {
                click: this.updateUser
            },
            'userCreate button[action=save]': {
                click: this.createUser
            }
        });
    },
    
    onPanelRendered: function() {

    },
    
    selectUser: function(selModel, selections) {
        var delBut = Ext.ComponentQuery.query('#deleteUser')[0];
        delBut.setDisabled(false);
    },
    
    editUser: function(grid, record) {
        var view = Ext.widget('userEdit');
        view.down('form').loadRecord(record);

        
    },
    
    newUser: function(button) {
        var view = Ext.widget('userCreate');
        view.down('form');
    },
    
    updateUser: function(button) {
            var win    = button.up('window'),
            form   = win.down('form'),
            record = form.getRecord(),
            values = form.getValues();
            var viewEF = form.getForm();
        if (viewEF.isValid()) {
            record.set(values);
            win.close();
            this.getUserStore().sync();
        }
    },
    
    createUser: function(button) {
            var win    = button.up('window'),
            form   = win.down('form'),
            record = form.getRecord(),
            values = form.getValues();
        this.getUserStore().add(values);
        win.close();
        
        this.getUserStore().sync();
    },
    
    deleteUserClick: function(selModel, selections) {
        var viewList = Ext.ComponentQuery.query('#userID')[0];
        var selection=viewList.getSelectionModel().getSelection()[0];
        if(selection)
        {
            this.getUserStore().remove(selection);
            this.getUserStore().sync();
        }
        
    }
});