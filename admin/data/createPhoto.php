<?php
require_once("include/SessionStarter.php");
require_once 'lib/response.php';
require_once 'lib/request.php';


/**
 * Class Photo Creates photos.
 */
class Photo
{
    var $gid;
    var $name;
    var $description;
    var $latitude;
    var $longitude;
    var $date;
    var $photo;
}

//Make DB connection
require_once('../../data/include/DBConnection.class.php');

$request = new Request(array());

if(isset($request->params))
{
    $db = dbConn::getConnection();
    $array_r=$request->params;
    $photo= new Photo();
    $photo->name=($array_r->name);
    $photo->description=($array_r->description);
    $photo->longitude=($array_r->longitude);
    $photo->latitude=($array_r->latitude);
    $photo->date=($array_r->date);
    $photo->photo=($array_r->photo);

    
    //insert data
    $query="INSERT INTO malawi_field_photos (name,longitude, latitude,  description, photo, date) VALUES ('$photo->name',
'$photo->longitude', '$photo->latitude', '$photo->description', '$photo->photo', '$photo->date')";
    $result =$db->query($query);
    //object response
    $res = new Response();
    $res->success = true;
    $res->message = "Created Record";
    
    
    //Need to Send USER to EXTjs to be correctly viewd in grid
    $result2 = $db->query("SELECT * FROM malawi_field_photos where gid =".$db->lastInsertId('malawi_field_photos_gid_seq'));
    $query_array=array();
    $i=0;
    //Iterate all Select
    while($row= $result2->fetch(PDO::FETCH_ASSOC))
      {
        //Create New Photo instance
        $photo = new Photo();
        //Fetch Photo Info
          $photo->gid=$row['gid'];
          $photo->name=$row['name'];
          $photo->description=$row['description'];
          $photo->longitude=$row['longitude'];
          $photo->latitude=$row['latitude'];
          $photo->date=$row['date'];
          $photo->photo=$row['photo'];
        //Add Photo to ARRAY
        $query_array[$i]=$photo;
        $i++;
      }
     
      
    $res->data = $query_array;
    //print Json
    print_r($res->to_json());
}
else
{
    //echo "false";
    $res = new Response();
    $res->success = false;
    $res->message = "Error Create record";
    $res->data = array();
    print_r($res->to_json());
}
?>
