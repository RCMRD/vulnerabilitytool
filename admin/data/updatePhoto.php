<?php
/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
require_once("include/SessionStarter.php");
require_once 'lib/response.php';
require_once 'lib/request.php';


class Photo
{
    var $gid;
    var $name;
    var $description;
    var $latitude;
    var $longitude;
    var $date;
    var $photo;
}

require_once( '../../data/include/DBConnection.class.php');
//echo $_SESSION['site_folder'].'/data/include/DBConnection.class.php';


$request = new Request(array());

if(isset($request->params)) {
    $db = dbConn::getConnection();
    $array_r=$request->params;
    $photo= new Photo();
    $photo->gid=($array_r->gid);
    $photo->name=($array_r->name);
    $photo->description=($array_r->description);
    $photo->latitude=($array_r->latitude);
    $photo->longitude=($array_r->longitude);
    $photo->date=($array_r->date);
    $photo->photo=($array_r->photo);
    //update
    $query="UPDATE malawi_field_photos SET name='$photo->name', longitude='$photo->longitude',
         latitude='$photo->latitude',description='$photo->description', date='$photo->date',
        photo='$photo->photo' WHERE gid=$photo->gid";

    $result = $db->exec($query);
  //  echo $query;
    //object response
    $res = new Response();
    $res->success = true;
    $res->message = "Updated record";


    /////Query Last update TO validate data was updated
    $result2 = $db->query("SELECT * FROM malawi_field_photos where gid =$photo->gid");
    $query_array=array();
    $i=0;
    //Iterate all Select
    while($row = $result2->fetch(PDO::FETCH_ASSOC))
      {
            //Create New Photo instance
            $photo = new Photo();
            //Fetch Photo Info
          $photo->gid=$row['gid'];
          $photo->name=$row['name'];
          $photo->description=$row['description'];
          $photo->longitude=$row['longitude'];
          $photo->latitude=$row['latitude'];
          $photo->date=$row['date'];
          $photo->photo=$row['photo'];

            //Add Photo to ARRAY
            $query_array[$i]=$photo;
            $i++;
      }

      ///////////


    $res->data = $query_array;
    print_r($res->to_json());
}
else
{
    //echo "false";
    $res = new Response();
    $res->success = false;
    $res->message = "Error Create record";
    $res->data = array();
    print_r($res->to_json());
}
?>
