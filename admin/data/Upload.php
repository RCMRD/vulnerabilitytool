<?php
require_once("include/SessionStarter.php");
//saving upload file
if(isset($_FILES['file'])) {

    $name = $_FILES["file"]["name"];
    $size = $_FILES['file']['size'];
    $type = $_FILES['file']['type'];
    $error = $_FILES['file']['error'];
    $tmpName = $_FILES['file']['tmp_name'];

    $uploadDir = '../../assets/images/field_photos/';

    $uploadFile = $uploadDir . $name;
    if (file_exists($uploadFile ) ) {
        $nameWithoutExt = substr($name, 0, -4);

        $name = $nameWithoutExt.time().'.'.pathinfo($name, PATHINFO_EXTENSION);
    }
    $errors     = array();
    $maxsize    = 150000; //150kbs
    $acceptable = array(
        'image/jpeg',
        'image/jpg',
        'image/png'
    );

    if(($size >= $maxsize) || ($size == 0)) {
        $errors[] = 'File too large. File must be less than 150 KB.';
    }

    if((!in_array($type, $acceptable)) && (!empty($type)) ) {
        $errors[] = 'Invalid file type. Only JPG, JPEG and PNG image types are accepted.';
    }

    if(count($errors) === 0) {
        move_uploaded_file($tmpName, $uploadFile);
        $response = array('success' => true,
            'data' => array('name' => $name,
            'msg' => 'File Uploaded successfully. You can now save your image into the system.'
            )
        );
        echo json_encode($response);
    } else {
        $response = array('success' => false,
            'msg' => array()
        );
        foreach($errors as $error) {
            $eachError[] =  $error.'<br>';
        }
        array_push($response['msg'], $eachError);
        echo json_encode($response);
        die(); //Ensure no more processing is done
    }
}




?>