<?php
require_once ("include/SessionStarter.php");

require_once ('lib/response.php');

//Creating User Class
class User
{		
		var $userID;
		var $username;
		var $password;
        var $group;
}
//Make DB connection
require_once($_SESSION['site_folder'].'/data/include/DBConnection.class.php');
$db = dbConn::getConnection();
//Query BD
if(isset($_GET['start']))
    $offset = $_GET['start'];
else
    $offset = 0;

$limit = $_GET['limit'];

$result =$db->query("SELECT * FROM users OFFSET $offset LIMIT $limit");
$totalquery = $db->query("SELECT COUNT(*) FROM users");
$total = $totalquery->fetch(PDO::FETCH_ASSOC);
//$total =($total[0]);
$query_array=array();
$i=0;
//Iterate all Select
while($row = $result->fetch(PDO::FETCH_ASSOC))
  {
    //Create New User instance
    $user = new User();
    //Fetch User Info
    $user->userID=$row['user_id'];
    $user->username=$row['username'];
    $user->password=$row['password'];
    $user->group=$row['user_group'];
    
    //Add User to ARRAY
    $query_array[$i]=$user;
    $i++;
  }

//Creating Json Array needed for Extjs Proxy
$res = new Response();
$res->success = true;
$res->message = "Loaded data";
$res->total = $total;
$res->data = $query_array;
//Printing json ARRAY
print_r($res->to_json());


?>