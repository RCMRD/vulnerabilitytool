<?php
require_once("include/SessionStarter.php");
//Import Response Class
require_once ('lib/response.php');

//Creating Photo Class
class Photo {
		var $gid;
		var $name;
        var $description;
		var $latitude;
        var $longitude;
        var $date;
        var $photo;
}
//Make DB connection
require_once('../../data/include/DBConnection.class.php');


$db = dbConn::getConnection();

//Query BD
if(isset($_GET['start']))
    $offset = $_GET['start'];
else
    $offset = 0;

$limit = $_GET['limit'];

$result = $db->query("SELECT * FROM malawi_field_photos ORDER BY gid DESC OFFSET $offset LIMIT $limit");

$totalquery = $db->query("SELECT COUNT(*) FROM malawi_field_photos");
$total = $totalquery->fetch(PDO::FETCH_ASSOC);
//$total =($total[0]);
$query_array=array();
$i=0;


//Iterate all Select

while($row = $result->fetch(PDO::FETCH_ASSOC)) {
    //Create New Photo instance
    $photo = new Photo();
    //Fetch Photo Info
    $photo->gid=$row['gid'];
    $photo->name=$row['name'];
    $photo->description=$row['description'];
    $photo->longitude=$row['longitude'];
    $photo->latitude=$row['latitude'];
    $photo->date=$row['date'];
    $photo->photo=$row['photo'];
    //Add Photo to ARRAY
    $query_array[$i]=$photo;
    $i++;
  }
//mysql_close($con);

//Creating Json Array needed for Extjs Proxy
$res = new Response();
$res->success = true;
$res->message = "Loaded data";
$res->total = $total;
$res->data = $query_array;
//Printing json ARRAY
print_r($res->to_json());


?>