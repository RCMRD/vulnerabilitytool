SELECT
ntile,
CAST(avg(overall_vu) AS INTEGER) AS avgAmount,
CAST(max(overall_vu) AS INTEGER)  AS maxAmount,
CAST(min(overall_vu) AS INTEGER)  AS minAmount 
FROM (SELECT overall_vu, ntile(6) OVER (ORDER BY overall_vu) AS ntile FROM vulnerability_index where overall_vu >= 0) x WHERE ntile = 2
GROUP BY ntile
ORDER BY ntile;


SELECT 
ntile,
CAST(avg(overall_vu) AS INTEGER) AS avgAmount,
CAST(max(overall_vu) AS INTEGER)  AS maxAmount,
concat( CAST(min(overall_vu) AS double precision),'-',  CAST(max(overall_vu) AS double precision)) as range
FROM (SELECT overall_vu, ntile(5) OVER (ORDER BY overall_vu) AS ntile FROM vulnerability_index  where overall_vu >= 0) x
GROUP BY ntile
ORDER BY ntile;

SELECT
CAST(max(overall_vu) AS INTEGER)  AS maxAmount
FROM (SELECT overall_vu, ntile(5) OVER (ORDER BY overall_vu) AS ntile FROM vulnerability_index where overall_vu >= 0) x
GROUP BY ntile
ORDER BY ntile;


SELECT Count(category) FROM session_id_e33_s44_a23_c where category = 'Very High';

SELECT
CAST(max(overall_vu) AS DOUBLE PRECISION)  AS maxAmount
FROM
(SELECT overall_vu, (ntile(5) OVER (ORDER BY overall_vu)) AS ntile FROM vulnerability_index  WHERE overall_vu >= 0) x WHERE ntile = 2
GROUP BY ntile
ORDER BY ntile;


select vul_index_custom, category from session_id_e33_s44_a23_c limit 100


select ntile(5) OVER(ORDER BY vul_index_custom) as qantiles from session_id_e33_s44_a23_c;


select gid, vul_index_custom, geom, ntile(5)
over(order by vul_index_custom) from session_id_e33_s44_a23_b
where vul_index_custom >=0 
order by gid;


select gid, vul_index_custom, geom, 
       (case when vul_index_custom >= 0
       then ntile(5) over (order by vul_index_custom) 
        end) as category
from session_id_e33_s44_a23_b order by gid; 


IF (vul_index_custom >= 0)
THEN
select gid, vul_index_custom, geom, ntile(5)
over(order by vul_index_custom) as category from session_id_e33_s44_a23_b
where vul_index_custom >=0 
order by gid;
ELSE 
  select gid, vul_index_custom, geom, category from session_id_e33_s44_a23_b
END IF;

select gid, vul_index_custom, geom,
(select 
(case ntile(5) over(order by vul_index_custom)
WHEN 1 then 'Very Low'
WHEN 2 then 'Low'
END)
) 
 as category from session_id_e33_s44_a23_b
where vul_index_custom >=0 
order by gid;