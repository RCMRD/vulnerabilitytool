
CREATE OR REPLACE VIEW vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12 AS 
 SELECT e.gid, e.value AS exposure, s.value AS sensitivity, 
    a.value AS lack_of_adaptive_capacity, 
    e.value * 0.24::double precision + s.value * 0.33::double precision + a.value * 0.43::double precision AS vul_index_raw, 
    e.geom
   FROM exposure e
   LEFT JOIN sensitivity s ON e.gid = s.gid
   LEFT JOIN adaptive_capacity a ON e.gid = a.gid
  GROUP BY e.gid, s.value, a.value;

  
CREATE OR REPLACE VIEW vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1 AS 
 SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.gid, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.exposure, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.sensitivity, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.lack_of_adaptive_capacity, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.geom, 
    ( SELECT 
                CASE
                    WHEN (vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw - (( SELECT min(vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw) AS min
                       FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12))) <> 0::double precision THEN (vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw - (( SELECT min(vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw) AS min
                       FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12
                      WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw >= 0::double precision))) / ((( SELECT max(vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw) AS max
                       FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12
                      WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw >= 0::double precision)) - (( SELECT min(vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw) AS min
                       FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12
                      WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw >= 0::double precision))) * 100::double precision
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw < 0::double precision THEN (-9999)::double precision
                    ELSE 0::double precision
                END AS "case") AS vul_index_custom
   FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12
  GROUP BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.gid, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.vul_index_raw, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.exposure, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.sensitivity, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.lack_of_adaptive_capacity, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.geom
  ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_12.gid;



CREATE OR REPLACE VIEW vkcl54d84ustoh5l5p449tqu985_e24_s33_a43 AS 
 SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.gid, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.exposure, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.sensitivity, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.lack_of_adaptive_capacity, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_raw, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.geom, 
    vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
    ( SELECT 
                CASE
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom < 0::double precision THEN '-9999'::text
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom < (( SELECT max(x.vul_index_custom) AS maxamount
                       FROM ( SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
                                ntile(5) OVER (ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom) AS ntile
                               FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
                              WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom >= 0::double precision) x
                      WHERE x.ntile = 1
                      GROUP BY x.ntile)) THEN 'Very Low'::text
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom < (( SELECT max(x.vul_index_custom) AS maxamount
                       FROM ( SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
                                ntile(5) OVER (ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom) AS ntile
                               FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
                              WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom >= 0::double precision) x
                      WHERE x.ntile = 2
                      GROUP BY x.ntile)) THEN 'Low'::text
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom < (( SELECT max(x.vul_index_custom) AS maxamount
                       FROM ( SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
                                ntile(5) OVER (ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom) AS ntile
                               FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
                              WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom >= 0::double precision) x
                      WHERE x.ntile = 3
                      GROUP BY x.ntile)) THEN 'Medium'::text
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom < (( SELECT max(x.vul_index_custom) AS maxamount
                       FROM ( SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
                                ntile(5) OVER (ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom) AS ntile
                               FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
                              WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom >= 0::double precision) x
                      WHERE x.ntile = 4
                      GROUP BY x.ntile)) THEN 'High'::text
                    WHEN vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom <= (( SELECT max(x.vul_index_custom) AS maxamount
                       FROM ( SELECT vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, 
                                ntile(5) OVER (ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom) AS ntile
                               FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
                              WHERE vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom >= 0::double precision) x
                      WHERE x.ntile = 5
                      GROUP BY x.ntile)) THEN 'Very High'::text
                    ELSE NULL::text
                END AS "case") AS category
   FROM vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1
  GROUP BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.gid, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_custom, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.vul_index_raw, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.exposure, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.sensitivity, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.lack_of_adaptive_capacity, vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.geom
  ORDER BY vkcl54d84ustoh5l5p449tqu985_e24_s33_a43_1.gid;

