<?php
require_once("../include/SessionStarter.php");
require_once('../include/DBConnection.class.php');

/**
 * Class GetPoints gets all field validation points and output them as geojson
 */

class GetPoints {
    public function getPoints() {
        $geoJSON = array(
            'type'      => 'FeatureCollection',
            'features'  => array()
        );

        $db = dbConn::getConnection();

        $selectPoints = "SELECT * FROM malawi_field_photos";
        $query = $db->query($selectPoints);
        function getBasename ($value) {
            $spilt = explode('/', $value);
            return end($spilt);
        }

        http://52.3.210.28/vulnerabilitytool/assets/images/field_photos/D:/Malawi%20VAI%20Mapping/viz%20tool/Precious%20-%20Field%20Pictures/Karonga.JPG
        while($row = $query->fetch(PDO::FETCH_ASSOC)) {

            $feature = array(  // create the feature part of the geojson.
                'type' => 'Feature',
                'geometry' => array(
                    'type' => 'Point',
                    'coordinates' => array((float)$row['longitude'], (float)$row['latitude'])
                ),
                'properties' => array(
                    'gid'=> $row['gid'],
                    'name'=>$row['name'],
                    'photo'=>getBasename ($row['photo']),
                    'description'=>$row['description'],
                    'longitude'=>$row['longitude'],
                    'latitude'=>$row['latitude'],
                    'date'=>$row['date']
                )
            );

            array_push($geoJSON['features'], $feature);

        }
        header('Content-type: application/json',true);
        //output of the data in json
        echo json_encode($geoJSON, true);
    }
}
$field = new GetPoints();
//$field->getPoints();
?>
