<?php
//require_once 'SessionStarter.php';
$_SESSION['site_folder'] = dirname(dirname(dirname(__FILE__) ));
require_once $_SESSION['site_folder']."/Config.php";

/**
 * db connection class using singleton pattern
*/
class dbConn{

    //variable to hold connection object.
    protected static $db;

    //private construct - class cannot be instanciated externally.
    private function __construct() {
        $config = new Config();

        try {
            // assign PDO object to db variable
            self::$db = new PDO('pgsql:host='.$config->pgsqlHost.';dbname='.$config->pgsqlDb, $config->pgsqlUser, $config->pgsqlPassword);
            self::$db->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            self::$db->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
        }
        catch (PDOException $e) {
        //Output error to user. Remove in production
            //echo "Connection Error: " . $e->getMessage();
        }

    }

    //get connection function. Static method - accessible without instantiation
    public static function getConnection() {
        //Guarantees single instance, if no connection object exists then create one.
        if (!self::$db) {
            //new connection object.
            new dbConn();
           // echo "Connected to new db session.";
        }

        //return connection.
        return self::$db;
    }

    /**
     * Executes an SQL statement, returning a result set as a PDOStatement object
     *
     * @param string $statement
     * @return PDOStatement
     */
    public function query($statement) {
        return self::$db->query($statement);
    }

}

?>
