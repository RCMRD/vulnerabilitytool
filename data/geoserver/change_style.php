
<?php

//$data = '<layer><defaultStyle><name>default_vulnerabilitytool</name>
//            <workspace>malawi_vulnerabilitytool</workspace>
//            </defaultStyle><enabled>true</enabled></layer>';
//$ch = curl_init();
//curl_setopt($ch, CURLOPT_URL,('http://192.168.0.194/geoserver/rest/layers/v2mg9fp9s6cl1vtu2eglsn7p2f1_national_e_e23_s33_a44.xml') );
//curl_setopt($ch, CURLOPT_USERPWD, "admin:geoserver");
//
//curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
//curl_setopt($ch, CURLOPT_POSTFIELDS,$data);
//curl_setopt($ch, CURLOPT_HTTPHEADER, array("Content-Type: text/xml") );
//
//curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
//curl_exec($ch);
//curl_getinfo($ch);
//


    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL,('http://192.168.0.194/geoserver/gwc/rest/layers') );
    curl_setopt($ch, CURLOPT_USERPWD, "admin:geoserver");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
//get xml results
    $result =curl_exec($ch);
    curl_close($ch);
//load the curl xml to array
    $xml = simplexml_load_string($result, "SimpleXMLElement", LIBXML_NOCDATA);
//convert the array to readable json
    $json = json_encode($xml);
//convert the json to a readable array.
    $array =  json_decode($json, TRUE);

//Loop through each array and filter by frost keyword.
$data = '<layer><defaultStyle><name>frostmap</name>
            <workspace>frost</workspace>
            </defaultStyle><enabled>true</enabled></layer>';
$change = curl_init();

    for ($x = 0; $x < count($array['layer']); $x++) {
        foreach ($array['layer'][$x] as $key => $value){
            if (substr( $value, 0, 5 ) === "frost") {//filter by "frost" keyword
                curl_setopt($change, CURLOPT_URL,('http://192.168.0.194/geoserver/rest/layers/'.substr($value, 6).'.xml') );
                curl_setopt($change, CURLOPT_USERPWD, "admin:geoserver");
//curl_setopt($ch, CURLOPT_POST, true);
//curl_setopt($ch, CURLOPT_POSTFIELDS, $data);

                curl_setopt($change, CURLOPT_CUSTOMREQUEST, "PUT");
                curl_setopt($change, CURLOPT_POSTFIELDS,$data);
                curl_setopt($change, CURLOPT_HTTPHEADER, array("Content-Type: text/xml") );
//curl_setopt($ch, CURLOPT_HEADER, false);
                curl_setopt($change, CURLOPT_RETURNTRANSFER, true);
                curl_exec($change);
                curl_getinfo($change);
            }
        }
    }
//output as json.
    //echo json_encode($frostLayers);
?>

