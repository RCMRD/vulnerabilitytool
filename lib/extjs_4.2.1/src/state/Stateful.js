Ext.define("Ext.state.Stateful",{mixins:{observable:"Ext.util.Observable"},requires:["Ext.state.Manager"],stateful:!1,saveDelay:100,constructor:function(n){var t=this;n=n||{};n.stateful!==undefined&&(t.stateful=n.stateful);n.saveDelay!==undefined&&(t.saveDelay=n.saveDelay);t.stateId=t.stateId||n.stateId;t.stateEvents||(t.stateEvents=[]);n.stateEvents&&t.stateEvents.concat(n.stateEvents);this.addEvents("beforestaterestore","staterestore","beforestatesave","statesave");t.mixins.observable.constructor.call(t);t.stateful!==!1&&(t.addStateEvents(t.stateEvents),t.initState())},addStateEvents:function(n){var t=this,r,i,u;if(t.stateful&&t.getStateId())for(typeof n=="string"&&(n=Array.prototype.slice.call(arguments,0)),u=t.stateEventsByName||(t.stateEventsByName={}),r=n.length;r--;)if(i=n[r],!u[i]){u[i]=1;t.on(i,t.onStateChange,t)}},onStateChange:function(){var n=this,i=n.saveDelay,t,r;n.stateful&&(i?(n.stateTask||(t=Ext.state.Stateful,r=t.runner||(t.runner=new Ext.util.TaskRunner),n.stateTask=r.newTask({run:n.saveState,scope:n,interval:i,repeat:1})),n.stateTask.start()):n.saveState())},saveState:function(){var n=this,i=n.stateful&&n.getStateId(),r=n.hasListeners,t;i&&(t=n.getState()||{},r.beforestatesave&&n.fireEvent("beforestatesave",n,t)===!1||(Ext.state.Manager.set(i,t),r.statesave&&n.fireEvent("statesave",n,t)))},getState:function(){return null},applyState:function(n){n&&Ext.apply(this,n)},getStateId:function(){var n=this;return n.stateId||(n.autoGenId?null:n.id)},initState:function(){var n=this,i=n.stateful&&n.getStateId(),r=n.hasListeners,t;i&&(t=Ext.state.Manager.get(i),t&&(t=Ext.apply({},t),r.beforestaterestore&&n.fireEvent("beforestaterestore",n,t)===!1||(n.applyState(t),r.staterestore&&n.fireEvent("staterestore",n,t))))},savePropToState:function(n,t,i){var r=this,u=r[n],f=r.initialConfig;return r.hasOwnProperty(n)&&(!f||f[n]!==u)?(t&&(t[i||n]=u),!0):!1},savePropsToState:function(n,t){var r=this,i,u;if(typeof n=="string")r.savePropToState(n,t);else for(i=0,u=n.length;i<u;++i)r.savePropToState(n[i],t);return t},destroy:function(){var n=this,t=n.stateTask;t&&(t.destroy(),n.stateTask=null);n.clearListeners()}})