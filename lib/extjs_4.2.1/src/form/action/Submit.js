Ext.define("Ext.form.action.Submit",{extend:"Ext.form.action.Action",alternateClassName:"Ext.form.Action.Submit",alias:"formaction.submit",type:"submit",run:function(){var n=this,t=n.form;n.clientValidation===!1||t.isValid()?n.doSubmit():(n.failureType=Ext.form.action.Action.CLIENT_INVALID,t.afterAction(n,!1))},doSubmit:function(){var n=this,t=Ext.apply(n.createCallback(),{url:n.getUrl(),method:n.getMethod(),headers:n.headers}),r=n.form,u=n.jsonSubmit||r.jsonSubmit,f=u?"jsonData":"params",i;r.hasUpload()?(i=n.buildForm(),t.form=i.formEl,t.isUpload=!0):t[f]=n.getParams(u);Ext.Ajax.request(t);i&&n.cleanup(i)},cleanup:function(n){for(var r=n.formEl,f=n.uploadEls,u=n.uploadFields,e=u.length,i,t=0;t<e;++t)i=u[t],i.clearOnSubmit||i.restoreInput(f[t]);r&&Ext.removeNode(r)},getParams:function(n){var t=!1,i=this.callParent(),r=this.form.getValues(t,t,this.submitEmptyText!==t,n);return Ext.apply({},r,i)},buildForm:function(){for(var t=this,s=[],f,h,w=t.form,c=t.getParams(),i=[],v=[],y=w.getFields().items,l=y.length,e,r,u,o,p,a,n=0;n<l;++n)e=y[n],e.rendered&&e.isFileUpload()&&i.push(e);for(r in c)if(c.hasOwnProperty(r))if(u=c[r],Ext.isArray(u))for(p=u.length,o=0;o<p;o++)s.push(t.getFieldConfig(r,u[o]));else s.push(t.getFieldConfig(r,u));for(f={tag:"form",action:t.getUrl(),method:t.getMethod(),target:t.target||"_self",style:"display:none",cn:s},i.length&&(f.encoding=f.enctype="multipart/form-data"),h=Ext.DomHelper.append(Ext.getBody(),f),l=i.length,n=0;n<l;++n)a=i[n].extractFileInput(),h.appendChild(a),v.push(a);return{formEl:h,uploadFields:i,uploadEls:v}},getFieldConfig:function(n,t){return{tag:"input",type:"hidden",name:n,value:Ext.String.htmlEncode(t)}},onSuccess:function(n){var i=this.form,r=!0,t=this.processResponse(n);t===!0||t.success||(t.errors&&i.markInvalid(t.errors),this.failureType=Ext.form.action.Action.SERVER_INVALID,r=!1);i.afterAction(this,r)},handleResponse:function(n){var s=this.form,e=s.errorReader,f,t,i,o,r,u;if(e){if(f=e.read(n),r=f.records,t=[],r)for(i=0,o=r.length;i<o;i++)t[i]=r[i].data;t.length<1&&(t=null);u={success:f.success,errors:t}}else try{u=Ext.decode(n.responseText)}catch(h){u={success:!1,errors:[]}}return u}})