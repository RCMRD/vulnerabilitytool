Ext.define("Ext.form.field.Trigger",{extend:"Ext.form.field.Text",alias:["widget.triggerfield","widget.trigger"],requires:["Ext.dom.Helper","Ext.util.ClickRepeater","Ext.layout.component.field.Trigger"],alternateClassName:["Ext.form.TriggerField","Ext.form.TwinTriggerField","Ext.form.Trigger"],childEls:[{name:"triggerCell",select:"."+Ext.baseCSSPrefix+"trigger-cell"},{name:"triggerEl",select:"."+Ext.baseCSSPrefix+"form-trigger"},"triggerWrap","inputCell"],triggerBaseCls:Ext.baseCSSPrefix+"form-trigger",triggerWrapCls:Ext.baseCSSPrefix+"form-trigger-wrap",triggerNoEditCls:Ext.baseCSSPrefix+"trigger-noedit",hideTrigger:!1,editable:!0,readOnly:!1,repeatTriggerClick:!1,autoSize:Ext.emptyFn,monitorTab:!0,mimicing:!1,triggerIndexRe:/trigger-index-(\d+)/,extraTriggerCls:"",componentLayout:"triggerfield",initComponent:function(){this.wrapFocusCls=this.triggerWrapCls+"-focus";this.callParent(arguments)},getSubTplMarkup:function(n){var t=this,i=n.childElCls,r=t.callParent(arguments);return'<table id="'+t.id+'-triggerWrap" class="'+Ext.baseCSSPrefix+"form-trigger-wrap"+i+'" cellpadding="0" cellspacing="0"><tbody><tr><td id="'+t.id+'-inputCell" class="'+Ext.baseCSSPrefix+"form-trigger-input-cell"+i+'">'+r+"<\/td>"+t.getTriggerMarkup()+"<\/tr><\/tbody><\/table>"},getSubTplData:function(){var n=this,r=n.callParent(),t=n.readOnly===!0,i=n.editable!==!1;return Ext.apply(r,{editableCls:t||!i?" "+n.triggerNoEditCls:"",readOnly:!i||t})},getLabelableRenderData:function(){var n=this,t=n.triggerWrapCls,i=n.callParent(arguments);return Ext.applyIf(i,{triggerWrapCls:t,triggerMarkup:n.getTriggerMarkup()})},getTriggerMarkup:function(){var n=this,t=0,f=n.readOnly||n.hideTrigger,r,u=n.triggerBaseCls,i=[],e=Ext.dom.Element.unselectableCls,o="width:"+n.triggerWidth+"px;"+(f?"display:none;":""),s=n.extraTriggerCls+" "+Ext.baseCSSPrefix+"trigger-cell "+e;for(n.trigger1Cls||(n.trigger1Cls=n.triggerCls),t=0;(r=n["trigger"+(t+1)+"Cls"])||t<1;t++)i.push({tag:"td",valign:"top",cls:s,style:o,cn:{cls:[Ext.baseCSSPrefix+"trigger-index-"+t,u,r].join(" "),role:"button"}});return i[0].cn.cls+=" "+u+"-first",Ext.DomHelper.markup(i)},disableCheck:function(){return!this.disabled},beforeRender:function(){var n=this,i=n.triggerBaseCls,t;n.triggerWidth||(t=Ext.getBody().createChild({style:"position: absolute;",cls:Ext.baseCSSPrefix+"form-trigger"}),Ext.form.field.Trigger.prototype.triggerWidth=t.getWidth(),t.remove());n.callParent();i!=Ext.baseCSSPrefix+"form-trigger"&&n.addChildEls({name:"triggerEl",select:"."+i});n.lastTriggerStateFlags=n.getTriggerStateFlags()},onRender:function(){var n=this;n.callParent(arguments);n.doc=Ext.getDoc();n.initTrigger()},getTriggerWidth:function(){var n=this,t=0;return!n.triggerWrap||n.hideTrigger||n.readOnly||(t=n.triggerEl.getCount()*n.triggerWidth),t},setHideTrigger:function(n){n!=this.hideTrigger&&(this.hideTrigger=n,this.updateLayout())},setEditable:function(n){n!=this.editable&&(this.editable=n,this.updateLayout())},setReadOnly:function(n){var t=this,i=t.readOnly;t.callParent(arguments);n!=i&&t.updateLayout()},initTrigger:function(){var n=this,o=n.triggerWrap,i=n.triggerEl,r=n.disableCheck,u,s,f,t,e;for(n.repeatTriggerClick?n.triggerRepeater=new Ext.util.ClickRepeater(o,{preventDefault:!0,handler:n.onTriggerWrapClick,listeners:{mouseup:n.onTriggerWrapMouseup,scope:n},scope:n}):n.mon(o,{click:n.onTriggerWrapClick,mouseup:n.onTriggerWrapMouseup,scope:n}),i.setVisibilityMode(Ext.Element.DISPLAY),i.addClsOnOver(n.triggerBaseCls+"-over",r,n),u=i.elements,s=u.length,t=0;t<s;t++)f=u[t],e=t+1,f.addClsOnOver(n["trigger"+e+"Cls"]+"-over",r,n),f.addClsOnClick(n["trigger"+e+"Cls"]+"-click",r,n);i.addClsOnClick(n.triggerBaseCls+"-click",r,n)},onDestroy:function(){var n=this;Ext.destroyMembers(n,"triggerRepeater","triggerWrap","triggerEl");delete n.doc;n.callParent()},onFocus:function(){var n=this;if(n.callParent(arguments),!n.mimicing&&(n.bodyEl.addCls(n.wrapFocusCls),n.mimicing=!0,n.mon(n.doc,"mousedown",n.mimicBlur,n,{delay:10}),n.monitorTab))n.on("specialkey",n.checkTab,n)},checkTab:function(n,t){this.ignoreMonitorTab||t.getKey()!=t.TAB||this.triggerBlur()},getTriggerStateFlags:function(){var t=this,n=0;return t.readOnly&&(n+=1),t.editable&&(n+=2),t.hideTrigger&&(n+=4),n},onBlur:Ext.emptyFn,mimicBlur:function(n){this.isDestroyed||this.bodyEl.contains(n.target)||!this.validateBlur(n)||this.triggerBlur(n)},triggerBlur:function(n){var t=this;t.mimicing=!1;t.mun(t.doc,"mousedown",t.mimicBlur,t);t.monitorTab&&t.inputEl&&t.un("specialkey",t.checkTab,t);Ext.form.field.Trigger.superclass.onBlur.call(t,n);t.bodyEl&&t.bodyEl.removeCls(t.wrapFocusCls)},validateBlur:function(){return!0},onTriggerWrapClick:function(){var n=this,i,r,u,t;t=arguments[n.triggerRepeater?1:0];!t||n.readOnly||n.disabled||(i=t.getTarget("."+n.triggerBaseCls,null),r=i&&i.className.match(n.triggerIndexRe),r&&(u=n["onTrigger"+(parseInt(r[1],10)+1)+"Click"]||n.onTriggerClick,u&&u.call(n,t)))},onTriggerWrapMouseup:Ext.emptyFn,onTriggerClick:Ext.emptyFn})