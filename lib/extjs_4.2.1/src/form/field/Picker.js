Ext.define("Ext.form.field.Picker",{extend:"Ext.form.field.Trigger",alias:"widget.pickerfield",alternateClassName:"Ext.form.Picker",requires:["Ext.util.KeyNav"],matchFieldWidth:!0,pickerAlign:"tl-bl?",openCls:Ext.baseCSSPrefix+"pickerfield-open",editable:!0,initComponent:function(){this.callParent();this.addEvents("expand","collapse","select")},initEvents:function(){var n=this;n.callParent();n.keyNav=new Ext.util.KeyNav(n.inputEl,{down:n.onDownArrow,esc:{handler:n.onEsc,scope:n,defaultEventAction:!1},scope:n,forceKeyDown:!0});n.editable||n.mon(n.inputEl,"click",n.onTriggerClick,n);Ext.isGecko&&n.inputEl.dom.setAttribute("autocomplete","off")},onEsc:function(n){Ext.isIE&&n.preventDefault();this.isExpanded&&(this.collapse(),n.stopEvent())},onDownArrow:function(){this.isExpanded||this.onTriggerClick()},expand:function(){var n=this,i,r,t;if(n.rendered&&!n.isExpanded&&!n.isDestroyed){n.expanding=!0;i=n.bodyEl;r=n.getPicker();t=n.collapseIf;r.show();n.isExpanded=!0;n.alignPicker();i.addCls(n.openCls);n.mon(Ext.getDoc(),{mousewheel:t,mousedown:t,scope:n});Ext.EventManager.onWindowResize(n.alignPicker,n);n.fireEvent("expand",n);n.onExpand();delete n.expanding}},onExpand:Ext.emptyFn,alignPicker:function(){var n=this,t=n.getPicker();n.isExpanded&&(n.matchFieldWidth&&t.setWidth(n.bodyEl.getWidth()),t.isFloating()&&n.doAlign())},doAlign:function(){var n=this,t=n.picker,r="-above",i;n.picker.alignTo(n.triggerWrap,n.pickerAlign,n.pickerOffset);i=t.el.getY()<n.inputEl.getY();n.bodyEl[i?"addCls":"removeCls"](n.openCls+r);t[i?"addCls":"removeCls"](t.baseCls+r)},collapse:function(){if(this.isExpanded&&!this.isDestroyed){var n=this,i=n.openCls,t=n.picker,r=Ext.getDoc(),u=n.collapseIf,f="-above";t.hide();n.isExpanded=!1;n.bodyEl.removeCls([i,i+f]);t.el.removeCls(t.baseCls+f);r.un("mousewheel",u,n);r.un("mousedown",u,n);Ext.EventManager.removeResizeListener(n.alignPicker,n);n.fireEvent("collapse",n);n.onCollapse()}},onCollapse:Ext.emptyFn,collapseIf:function(n){var t=this;t.isDestroyed||n.within(t.bodyEl,!1,!0)||n.within(t.picker.el,!1,!0)||t.isEventWithinPickerLoadMask(n)||t.collapse()},getPicker:function(){var n=this;return n.picker||(n.picker=n.createPicker())},createPicker:Ext.emptyFn,onTriggerClick:function(){var n=this;n.readOnly||n.disabled||(n.isExpanded?n.collapse():n.expand(),n.inputEl.focus())},triggerBlur:function(){var n=this.picker;this.callParent(arguments);n&&n.isVisible()&&n.hide()},mimicBlur:function(n){var t=this,i=t.picker;i&&(n.within(i.el,!1,!0)||t.isEventWithinPickerLoadMask(n))||t.callParent(arguments)},onDestroy:function(){var n=this,t=n.picker;Ext.EventManager.removeResizeListener(n.alignPicker,n);Ext.destroy(n.keyNav);t&&(delete t.pickerField,t.destroy());n.callParent()},isEventWithinPickerLoadMask:function(n){var t=this.picker.loadMask;return t?n.within(t.maskEl,!1,!0)||n.within(t.el,!1,!0):!1}})