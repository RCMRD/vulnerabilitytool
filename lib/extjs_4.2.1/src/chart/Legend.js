Ext.define("Ext.chart.Legend",{requires:["Ext.chart.LegendItem"],visible:!0,update:!0,position:"bottom",x:0,y:0,labelColor:"#000",labelFont:"12px Helvetica, sans-serif",boxStroke:"#000",boxStrokeWidth:1,boxFill:"#FFF",itemSpacing:10,padding:5,width:0,height:0,boxZIndex:100,constructor:function(n){var t=this;n&&Ext.apply(t,n);t.items=[];t.isVertical="left|right|float".indexOf(t.position)!==-1;t.origX=t.x;t.origY=t.y},create:function(){var n=this,i=n.chart.series.items,t,r,u;if(n.createBox(),n.rebuild!==!1&&n.createItems(),!n.created&&n.isDisplayed())for(n.created=!0,t=0,r=i.length;t<r;t++){u=i[t];u.on("titlechange",n.redraw,n)}},redraw:function(){var n=this;n.create();n.updatePosition()},isDisplayed:function(){return this.visible&&this.chart.series.findIndex("showInLegend",!0)!==-1},createItems:function(){var n=this,u=n.chart.series.items,h=n.items,f,t,e,i,o,r,s;for(n.removeItems(),t=0,e=u.length;t<e;t++)if(r=u[t],r.showInLegend)for(f=[].concat(r.yField),i=0,o=f.length;i<o;i++)s=n.createLegendItem(r,i),h.push(s);n.alignItems()},removeItems:function(){var r=this,n=r.items,i=n?n.length:0,t;if(i)for(t=0;t<i;t++)n[t].destroy();n.length=[]},alignItems:function(){var n=this,i=n.padding,r=n.isVertical,u=Math.floor,t,f,e,o,s;t=n.updateItemDimensions();f=t.maxWidth;e=t.maxHeight;o=t.totalWidth;s=t.totalHeight;n.width=u((r?f:o)+i*2);n.height=u((r?s:e)+i*2)},updateItemDimensions:function(){for(var i=this,l=i.items,a=i.padding,b=i.itemSpacing,f=0,e=0,o=0,s=0,v=i.isVertical,y=Math.floor,p=Math.max,n=0,r,h,c,u,t=0,w=l.length;t<w;t++)r=l[t],h=r.getBBox(),c=h.width,u=h.height,n=t===0?0:b,r.x=a+y(v?0:o+n),r.y=a+y(v?s+n:0)+u/2,o+=n+c,s+=n+u,f=p(f,c),e=p(e,u);return{totalWidth:o,totalHeight:s,maxWidth:f,maxHeight:e}},createLegendItem:function(n,t){var i=this;return new Ext.chart.LegendItem({legend:i,series:n,surface:i.chart.surface,yFieldIndex:t})},getBBox:function(){var n=this;return{x:Math.round(n.x)-n.boxStrokeWidth/2,y:Math.round(n.y)-n.boxStrokeWidth/2,width:n.width+n.boxStrokeWidth,height:n.height+n.boxStrokeWidth}},createBox:function(){var n=this,i,t;if(n.boxSprite&&n.boxSprite.destroy(),t=n.getBBox(),isNaN(t.width)||isNaN(t.height)){n.boxSprite=!1;return}i=n.boxSprite=n.chart.surface.add(Ext.apply({type:"rect",stroke:n.boxStroke,"stroke-width":n.boxStrokeWidth,fill:n.boxFill,zIndex:n.boxZIndex},t));i.redraw()},calcPosition:function(){var i=this,r,u,e=i.width,o=i.height,s=i.chart,f=s.chartBBox,n=s.insetPadding,h=f.width-n*2,c=f.height-n*2,l=f.x+n,a=f.y+n,v=s.surface,t=Math.floor;switch(i.position){case"left":r=n;u=t(a+c/2-o/2);break;case"right":r=t(v.width-e)-n;u=t(a+c/2-o/2);break;case"top":r=t(l+h/2-e/2);u=n;break;case"bottom":r=t(l+h/2-e/2);u=t(v.height-o)-n;break;default:r=t(i.origX)+n;u=t(i.origY)+n}return{x:r,y:u}},updatePosition:function(){var n=this,u=n.items,r,t,f,i;if(n.isDisplayed()){for(r=n.calcPosition(),n.x=r.x,n.y=r.y,t=0,f=u.length;t<f;t++)u[t].updatePosition();i=n.getBBox();isNaN(i.width)||isNaN(i.height)?n.boxSprite&&n.boxSprite.hide(!0):(n.boxSprite||n.createBox(),n.boxSprite.setAttributes(i,!0),n.boxSprite.show(!0))}},toggle:function(n){var t=this,i=0,r=t.items,u=r.length;for(t.boxSprite&&(n?t.boxSprite.show(!0):t.boxSprite.hide(!0));i<u;++i)n?r[i].show(!0):r[i].hide(!0);t.visible=n}})