Ext.define("Ext.chart.series.Scatter",{extend:"Ext.chart.series.Cartesian",requires:["Ext.chart.axis.Axis","Ext.chart.Shape","Ext.fx.Anim"],type:"scatter",alias:"series.scatter",constructor:function(n){this.callParent(arguments);var t=this,f=t.chart.shadow,r=t.chart.surface,i,u;if(Ext.apply(t,n,{style:{},markerConfig:{},shadowAttributes:[{"stroke-width":6,"stroke-opacity":.05,stroke:"rgb(0, 0, 0)"},{"stroke-width":4,"stroke-opacity":.1,stroke:"rgb(0, 0, 0)"},{"stroke-width":2,"stroke-opacity":.15,stroke:"rgb(0, 0, 0)"}]}),t.group=r.getGroup(t.seriesId),f)for(i=0,u=t.shadowAttributes.length;i<u;i++)t.shadowGroups.push(r.getGroup(t.seriesId+"-shadows"+i))},getBounds:function(){var t=this,l=t.chart,e=l.getChartStore(),a=l.axes,v=t.getAxesForXAndYFields(),y=v.xAxis,p=v.yAxis,u,h,c,i,r,o,s,n,f;return t.setBBox(),u=t.bbox,(n=a.get(y))&&(f=n.applyData(),i=f.from,o=f.to),(n=a.get(p))&&(f=n.applyData(),r=f.from,s=f.to),t.xField&&!Ext.isNumber(i)&&(n=t.getMinMaxXValues(),i=n[0],o=n[1]),t.yField&&!Ext.isNumber(r)&&(n=t.getMinMaxYValues(),r=n[0],s=n[1]),isNaN(i)?(i=0,o=e.getCount()-1,h=u.width/(e.getCount()-1)):h=u.width/(o-i),isNaN(r)?(r=0,s=e.getCount()-1,c=u.height/(e.getCount()-1)):c=u.height/(s-r),{bbox:u,minX:i,minY:r,xScale:h,yScale:c}},getPaths:function(){for(var n=this,f=n.chart,y=f.shadow,p=f.getChartStore(),l=p.data.items,u,w=n.group,e=n.bounds=n.getBounds(),s=n.bbox,b=e.xScale,k=e.yScale,d=e.minX,g=e.minY,nt=s.x,tt=s.y,it=s.height,rt=n.items=[],v=[],h,c,i,t,o,r=0,a=l.length;r<a;r++){if(u=l[r],i=u.get(n.xField),t=u.get(n.yField),typeof t=="undefined"||typeof t=="string"&&!t||i==null||t==null){Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("[Ext.chart.series.Scatter]  Skipping a store element with a value which is either undefined or null  at ",u,i,t);continue}typeof i!="string"&&(typeof i!="object"||Ext.isDate(i))||(i=r);typeof t!="string"&&(typeof t!="object"||Ext.isDate(t))||(t=r);h=nt+(i-d)*b;c=tt+it-(t-g)*k;v.push({x:h,y:c});n.items.push({series:n,value:[i,t],point:[h,c],storeItem:u});f.animate&&f.resizing&&(o=w.getAt(r),o&&(n.resetPoint(o),y&&n.resetShadow(o)))}return v},resetPoint:function(n){var t=this.bbox;n.setAttributes({translate:{x:(t.x+t.width)/2,y:(t.y+t.height)/2}},!0)},resetShadow:function(n){for(var u=this,f=n.shadows,e=u.shadowAttributes,o=u.shadowGroups.length,t=u.bbox,i,r=0;r<o;r++)i=Ext.apply({},e[r]),i.translate?(i.translate.x+=(t.x+t.width)/2,i.translate.y+=(t.y+t.height)/2):i.translate={x:(t.x+t.width)/2,y:(t.y+t.height)/2},f[r].setAttributes(i,!0)},createPoint:function(n,t){var r=this,u=r.chart,f=r.group,i=r.bbox;return Ext.chart.Shape[t](u.surface,Ext.apply({},{x:0,y:0,group:f,translate:{x:(i.x+i.width)/2,y:(i.y+i.height)/2}},n))},createShadow:function(n,t,i){var e=this,c=e.chart,o=e.shadowGroups,l=e.shadowAttributes,a=o.length,r=e.bbox,f,s,h,u;for(n.shadows=h=[],f=0;f<a;f++)u=Ext.apply({},l[f]),u.translate?(u.translate.x+=(r.x+r.width)/2,u.translate.y+=(r.y+r.height)/2):Ext.apply(u,{translate:{x:(r.x+r.width)/2,y:(r.y+r.height)/2}}),Ext.apply(u,t),s=Ext.chart.Shape[i](c.surface,Ext.apply({},{x:0,y:0,group:o[f]},u)),h.push(s)},drawSeries:function(){var n=this,a=n.chart,f=a.getChartStore(),v=n.group,b=a.shadow,k=n.shadowGroups,p=n.shadowAttributes,w=k.length,i,c,o,l,t,s,r,y,h,e,u;if(s=Ext.apply(n.markerStyle,n.markerConfig),y=s.type||"circle",delete s.type,!f||!f.getCount()){n.hide();n.items=[];return}for(n.unHighlightItem(),n.cleanHighlights(),c=n.getPaths(),l=c.length,t=0;t<l;t++){if(o=c[t],i=v.getAt(t),Ext.apply(o,s),i||(i=n.createPoint(o,y),b&&n.createShadow(i,s,y)),h=i.shadows,a.animate){e=n.renderer(i,f.getAt(t),{translate:o},t,f);i._to=e;n.onAnimate(i,{to:e});for(r=0;r<w;r++){u=Ext.apply({},p[r]);e=n.renderer(h[r],f.getAt(t),Ext.apply({},{hidden:!1,translate:{x:o.x+(u.translate?u.translate.x:0),y:o.y+(u.translate?u.translate.y:0)}},u),t,f);n.onAnimate(h[r],{to:e})}}else for(e=n.renderer(i,f.getAt(t),{translate:o},t,f),i._to=e,i.setAttributes(e,!0),r=0;r<w;r++)u=Ext.apply({},p[r]),e=n.renderer(h[r],f.getAt(t),Ext.apply({},{hidden:!1,translate:{x:o.x+(u.translate?u.translate.x:0),y:o.y+(u.translate?u.translate.y:0)}},u),t,f),h[r].setAttributes(e,!0);n.items[t].sprite=i}for(l=v.getCount(),t=c.length;t<l;t++)v.getAt(t).hide(!0);n.renderLabels();n.renderCallouts()},onCreateLabel:function(n,t){var i=this,u=i.labelsGroup,f=i.label,e=Ext.apply({},f,i.seriesLabelStyle),r=i.bbox;return i.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:u,x:Number(t.point[0]),y:r.y+r.height/2},e))},onPlaceLabel:function(n,t,i,r,u,f,e){var y=this,k=y.chart,nt=k.resizing,d=y.label,tt=d.renderer,it=d.field,o=y.bbox,s=Number(i.point[0]),h=Number(i.point[1]),g=i.sprite.attr.radius,w,c,l,a,p,v,b;if(n.setAttributes({text:tt(t.get(it),n,t,i,r,u,f,e),hidden:!0},!0),c=i.sprite.getBBox(),c.width=c.width||g*2,c.height=c.height||g*2,w=n.getBBox(),l=w.width/2,a=w.height/2,u=="rotate"?(p=c.width/2+l+a/2,s+p+l>o.x+o.width?s-=p:s+=p,n.setAttributes({rotation:{x:s,y:h,degrees:-45}},!0)):(u=="under"||u=="over")&&(n.setAttributes({rotation:{degrees:0}},!0),s<o.x+l?s=o.x+l:s+l>o.x+o.width&&(s=o.x+o.width-l),v=c.height/2+a,h=h+(u=="over"?-v:v),h<o.y+a?h+=2*v:h+a>o.y+o.height&&(h-=2*v)),k.animate)if(nt)if(b=i.sprite.getActiveAnimation(),b)b.on("afteranimate",function(){n.setAttributes({x:s,y:h},!0);n.show(!0)});else n.show(!0);else y.onAnimate(n,{to:{x:s,y:h}});else n.setAttributes({x:s,y:h},!0),n.show(!0)},onPlaceCallout:function(n,t,i){var h=this,w=h.chart,k=w.surface,d=w.resizing,g=h.callouts,nt=h.items,e=i.point,u,f=n.label.getBBox(),p=30,r=3,c,l,v,y,b,a=h.bbox,o,s;if(u=[Math.cos(Math.PI/4),-Math.sin(Math.PI/4)],o=e[0]+u[0]*p,s=e[1]+u[1]*p,c=o+(u[0]>0?0:-(f.width+2*r)),l=s-f.height/2-r,v=f.width+2*r,y=f.height+2*r,(c<a[0]||c+v>a[0]+a[2])&&(u[0]*=-1),(l<a[1]||l+y>a[1]+a[3])&&(u[1]*=-1),o=e[0]+u[0]*p,s=e[1]+u[1]*p,c=o+(u[0]>0?0:-(f.width+2*r)),l=s-f.height/2-r,v=f.width+2*r,y=f.height+2*r,w.animate){h.onAnimate(n.lines,{to:{path:["M",e[0],e[1],"L",o,s,"Z"]}},!0);h.onAnimate(n.box,{to:{x:c,y:l,width:v,height:y}},!0);h.onAnimate(n.label,{to:{x:o+(u[0]>0?r:-(f.width+r)),y:s}},!0)}else n.lines.setAttributes({path:["M",e[0],e[1],"L",o,s,"Z"]},!0),n.box.setAttributes({x:c,y:l,width:v,height:y},!0),n.label.setAttributes({x:o+(u[0]>0?r:-(f.width+r)),y:s},!0);for(b in n)n[b].show(!0)},onAnimate:function(n){return n.show(),this.callParent(arguments)},isItemInPoint:function(n,t,i){var r,u=10,f=Math.abs;return r=i.point,r[0]-u<=n&&r[0]+u>=n&&r[1]-u<=t&&r[1]+u>=t}})