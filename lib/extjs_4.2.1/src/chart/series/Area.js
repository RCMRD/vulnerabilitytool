Ext.define("Ext.chart.series.Area",{extend:"Ext.chart.series.Cartesian",alias:"series.area",requires:["Ext.chart.axis.Axis","Ext.draw.Color","Ext.fx.Anim"],type:"area",stacked:!0,style:{},constructor:function(n){this.callParent(arguments);var t=this,i=t.chart.surface;n.highlightCfg=Ext.Object.merge({},{lineWidth:3,stroke:"#55c",opacity:.8,color:"#f00"},n.highlightCfg);Ext.apply(t,n,{__excludes:[]});t.highlight&&(t.highlightSprite=i.add({type:"path",path:["M",0,0],zIndex:1e3,opacity:.3,lineWidth:5,hidden:!0,stroke:"#444"}));t.group=i.getGroup(t.seriesId)},shrink:function(n,t,i){for(var h=n.length,o=Math.floor(h/i),u,s=0,e=this.areas.length,f=[],c=[],l=[],r=0;r<e;++r)f[r]=0;for(u=0;u<h;++u){for(s+=+n[u],r=0;r<e;++r)f[r]+=+t[u][r];if(u%o==0){for(c.push(s/o),r=0;r<e;++r)f[r]/=o;for(l.push(f),s=0,r=0,f=[];r<e;++r)f[r]=0}}return{x:c,y:l}},getBounds:function(){var n=this,p=n.chart,ht=p.getChartStore(),w=ht.data.items,f,b,k,it=[].concat(n.yField),rt=it.length,e=[],v=[],y=Infinity,o=y,i=y,d=-y,s=-y,ut=Math,vt=ut.min,yt=ut.max,ft=n.getAxesForXAndYFields(),ct=ft.xAxis,lt=ft.yAxis,r,h,c,u,et,ot,l,g,a,at,st,nt,tt,t;for(n.setBBox(),u=n.bbox,(t=p.axes.get(ct))&&(t.type==="Time"&&(h=!0),r=t.applyData(),o=r.from,d=r.to),(t=p.axes.get(lt))&&(r=t.applyData(),i=r.from,s=r.to),n.xField&&!Ext.isNumber(o)&&(t=n.getMinMaxXValues(),h=!0,o=t[0],d=t[1]),n.yField&&!Ext.isNumber(i)&&(t=n.getMinMaxYValues(),i=t[0],s=t[1]),Ext.isNumber(i)||(i=0),Ext.isNumber(s)||(s=0),b=w.length,b>0&&h&&(c=w[0].get(n.xField),typeof c!="number"&&(c=+c,isNaN(c)&&(h=!1))),f=0;f<b;f++){for(k=w[f],l=k.get(n.xField),g=[],typeof l!="number"&&(l=h?+l:f),e.push(l),at=0,a=0;a<rt;a++)n.__excludes[a]||(tt=k.get(it[a]),typeof tt=="number"&&g.push(tt));v.push(g)}return et=u.width/(d-o||1),ot=u.height/(s-i||1),st=e.length,st>u.width&&n.areas&&(nt=n.shrink(e,v,u.width),e=nt.x,v=nt.y),{bbox:u,minX:o,minY:i,xValues:e,yValues:v,xScale:et,yScale:ot,areasLen:rt}},getPaths:function(){for(var e=this,nt=e.chart,tt=nt.getChartStore(),w=!0,i=e.getBounds(),f=i.bbox,l=e.items=[],h=[],u,y=0,c=[],r,o,b,k,p,n,d,g,s,v,a=i.xValues.length,t=0;t<a;t++)for(b=i.xValues[t],k=i.yValues[t],r=f.x+(b-i.minX)*i.xScale,v===undefined&&(v=r),p=0,y=0,n=0;n<i.areasLen;n++)e.__excludes[n]||(h[n]||(h[n]=[]),g=k[y],p+=g,o=f.y+f.height-(p-i.minY)*i.yScale,c[n]?(c[n].push("L",r,o),h[n].push(["L",r,o])):(c[n]=["M",r,o],h[n].push(["L",r,o])),l[n]||(l[n]={pointsUp:[],pointsDown:[],series:e}),l[n].pointsUp.push([r,o]),y++);for(n=0;n<i.areasLen;n++)if(!e.__excludes[n]){if(s=c[n],n==0||w)w=!1,s.push("L",r,f.y+f.height,"L",v,f.y+f.height,"Z");else{for(u=h[d],u.reverse(),s.push("L",r,u[0][2]),t=0;t<a;t++)s.push(u[t][0],u[t][1],u[t][2]),l[n].pointsDown[a-t-1]=[u[t][1],u[t][2]];s.push("L",v,s[2],"Z")}d=n}return{paths:c,areasLen:i.areasLen}},drawSeries:function(){var n=this,c=n.chart,f=c.getChartStore(),a=c.surface,v=c.animate,y=n.group,e=Ext.apply(n.seriesStyle,n.style),i=n.colorArrayStyle,r=i&&i.length||0,p=n.themeIdx,t,o,s,l,h,u;if(n.unHighlightItem(),n.cleanHighlights(),!f||!f.getCount()||n.seriesIsHidden){n.hide();n.items=[];return}for(s=n.getPaths(),n.areas||(n.areas=[]),t=0;t<s.areasLen;t++)n.__excludes[t]||(u=p+t,n.areas[t]||(n.items[t].sprite=n.areas[t]=a.add(Ext.apply({},{type:"path",group:y,path:s.paths[t],stroke:e.stroke||i[u%r],fill:i[u%r]},e||{}))),o=n.areas[t],l=s.paths[t],v?(h=n.renderer(o,!1,{path:l,fill:i[t%r],stroke:e.stroke||i[t%r]},t,f),n.animation=n.onAnimate(o,{to:h})):(h=n.renderer(o,!1,{path:l,hidden:!1,fill:i[u%r],stroke:e.stroke||i[u%r]},t,f),n.areas[t].setAttributes(h,!0)));n.renderLabels();n.renderCallouts()},onAnimate:function(n){return n.show(),this.callParent(arguments)},onCreateLabel:function(){return null},onPlaceLabel:function(n,t,i,r,u,f,e){var s=this,p=s.chart,w=p.resizing,y=s.label,b=y.renderer,k=y.field,o=s.bbox,c=Number(i.point[r][0]),h=Number(i.point[r][1]),v,a,l;if(n.setAttributes({text:b(t.get(k[e]),n,t,i,r,u,f,e),hidden:!0},!0),v=n.getBBox(),a=v.width/2,l=v.height/2,c<o.x+a?c=o.x+a:c+a>o.x+o.width&&(c=o.x+o.width-a),h=h-l,h<o.y+l?h+=2*l:h+l>o.y+o.height&&(h-=2*l),s.chart.animate&&!s.chart.resizing){n.show(!0);s.onAnimate(n,{to:{x:c,y:h}})}else if(n.setAttributes({x:c,y:h},!0),w&&s.animation)s.animation.on("afteranimate",function(){n.show(!0)});else n.show(!0)},onPlaceCallout:function(n,t,i,r){var b=this,ut=b.chart,et=ut.surface,ot=ut.resizing,st=b.callouts,tt=b.items,s=r==0?!1:tt[r-1].point,h=r==tt.length-1?!1:tt[r+1].point,f=i.point,it,rt,u,k,v,y,e=n&&n.label?n.label.getBBox():{width:0,height:0},d=30,o=3,p,w,g,nt,ft,c=b.clipRect,l,a;if(e.width&&e.height){s||(s=f);h||(h=f);k=(h[1]-s[1])/(h[0]-s[0]);v=(f[1]-s[1])/(f[0]-s[0]);y=(h[1]-f[1])/(h[0]-f[0]);rt=Math.sqrt(1+k*k);it=[1/rt,k/rt];u=[-it[1],it[0]];v>0&&y<0&&u[1]<0||v<0&&y>0&&u[1]>0?(u[0]*=-1,u[1]*=-1):(Math.abs(v)<Math.abs(y)&&u[0]<0||Math.abs(v)>Math.abs(y)&&u[0]>0)&&(u[0]*=-1,u[1]*=-1);l=f[0]+u[0]*d;a=f[1]+u[1]*d;p=l+(u[0]>0?0:-(e.width+2*o));w=a-e.height/2-o;g=e.width+2*o;nt=e.height+2*o;(p<c[0]||p+g>c[0]+c[2])&&(u[0]*=-1);(w<c[1]||w+nt>c[1]+c[3])&&(u[1]*=-1);l=f[0]+u[0]*d;a=f[1]+u[1]*d;p=l+(u[0]>0?0:-(e.width+2*o));w=a-e.height/2-o;g=e.width+2*o;nt=e.height+2*o;n.lines.setAttributes({path:["M",f[0],f[1],"L",l,a,"Z"]},!0);n.box.setAttributes({x:p,y:w,width:g,height:nt},!0);n.label.setAttributes({x:l+(u[0]>0?o:-(e.width+o)),y:a},!0);for(ft in n)n[ft].show(!0)}},isItemInPoint:function(n,t,i,r){for(var l=this,e=i.pointsUp,o=i.pointsDown,a=Math.abs,s=!1,h=!1,v=Infinity,f,u=0,c=e.length;u<c;u++)if(f=[e[u][0],e[u][1]],s=!1,h=u==c-1,v>a(n-f[0])&&(v=a(n-f[0]),s=!0,h&&++u),!s||s&&h){if(f=e[u-1],t>=f[1]&&(!o.length||t<=o[u-1][1]))return i.storeIndex=u-1,i.storeField=l.yField[r],i.storeItem=l.chart.getChartStore().getAt(u-1),i._points=o.length?[f,o[u-1]]:[f],!0;break}return!1},highlightSeries:function(){var n,t,i;this._index!==undefined&&(n=this.areas[this._index],n.__highlightAnim&&(n.__highlightAnim.paused=!0),n.__highlighted=!0,n.__prevOpacity=n.__prevOpacity||n.attr.opacity||1,n.__prevFill=n.__prevFill||n.attr.fill,n.__prevLineWidth=n.__prevLineWidth||n.attr.lineWidth,i=Ext.draw.Color.fromString(n.__prevFill),t={lineWidth:(n.__prevLineWidth||0)+2},i?t.fill=i.getLighter(.2).toString():t.opacity=Math.max(n.__prevOpacity-.3,0),this.chart.animate?n.__highlightAnim=new Ext.fx.Anim(Ext.apply({target:n,to:t},this.chart.animate)):n.setAttributes(t,!0))},unHighlightSeries:function(){var n;this._index!==undefined&&(n=this.areas[this._index],n.__highlightAnim&&(n.__highlightAnim.paused=!0),n.__highlighted&&(n.__highlighted=!1,n.__highlightAnim=new Ext.fx.Anim({target:n,to:{fill:n.__prevFill,opacity:n.__prevOpacity,lineWidth:n.__prevLineWidth}})))},highlightItem:function(n){var i=this,t,r;if(!n){this.highlightSeries();return}t=n._points;r=t.length==2?["M",t[0][0],t[0][1],"L",t[1][0],t[1][1]]:["M",t[0][0],t[0][1],"L",t[0][0],i.bbox.y+i.bbox.height];i.highlightSprite.setAttributes({path:r,hidden:!1},!0)},unHighlightItem:function(n){n||this.unHighlightSeries();this.highlightSprite&&this.highlightSprite.hide(!0)},hideAll:function(n){var t=this;n=(isNaN(t._index)?n:t._index)||0;t.__excludes[n]=!0;t.areas[n].hide(!0);t.redraw()},showAll:function(n){var t=this;n=(isNaN(t._index)?n:t._index)||0;t.__excludes[n]=!1;t.areas[n].show(!0);t.redraw()},redraw:function(){var n=this,t;t=n.chart.legend.rebuild;n.chart.legend.rebuild=!1;n.chart.redraw();n.chart.legend.rebuild=t},hide:function(){if(this.areas){var i=this,n=i.areas,t,r;if(n&&n.length){for(t=0,r=n.length;t<r;++t)n[t]&&n[t].hide(!0);i.hideLabels()}}},getLegendColor:function(n){var t=this;return n+=t.themeIdx,t.colorArrayStyle[n%t.colorArrayStyle.length]}})