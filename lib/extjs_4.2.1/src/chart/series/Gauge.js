Ext.define("Ext.chart.series.Gauge",{extend:"Ext.chart.series.Series",type:"gauge",alias:"series.gauge",rad:Math.PI/180,highlightDuration:150,angleField:!1,needle:!1,donut:!1,showInLegend:!1,style:{},constructor:function(n){this.callParent(arguments);var t=this,r=t.chart,u=r.surface,o=r.store,e=r.shadow,i,f;if(Ext.apply(t,n,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":1,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:2}},{"stroke-width":4,"stroke-opacity":1,stroke:"rgb(150, 150, 150)",translate:{x:.9,y:1.5}},{"stroke-width":2,"stroke-opacity":1,stroke:"rgb(100, 100, 100)",translate:{x:.6,y:1}}]}),t.group=u.getGroup(t.seriesId),e)for(i=0,f=t.shadowAttributes.length;i<f;i++)t.shadowGroups.push(u.getGroup(t.seriesId+"-shadows"+i));u.customAttributes.segment=function(n){return t.getSegment(n)}},initialize:function(){var n=this,r=n.chart.getChartStore(),i=r.data.items,t=n.label,u=i.length;n.yField=[];t&&t.field&&u>0&&n.yField.push(i[0].get(t.field))},getSegment:function(n){var l=this,a=l.rad,t=Math.cos,i=Math.sin,v=Math.abs,r=l.centerX,u=l.centerY,f=0,y=0,p=0,w=0,e=0,b=0,k=0,d=0,nt=.01,ut=n.endRho-n.startRho,o=n.startAngle,s=n.endAngle,tt=(o+s)/2*a,it=n.margin||0,g=v(s-o)>180,h=Math.min(o,s)*a,c=Math.max(o,s)*a,rt=!1;return r+=it*t(tt),u+=it*i(tt),f=r+n.startRho*t(h),e=u+n.startRho*i(h),y=r+n.endRho*t(h),b=u+n.endRho*i(h),p=r+n.startRho*t(c),k=u+n.startRho*i(c),w=r+n.endRho*t(c),d=u+n.endRho*i(c),v(f-p)<=nt&&v(e-k)<=nt&&(rt=!0),rt?{path:[["M",f,e],["L",y,b],["A",n.endRho,n.endRho,0,+g,1,w,d],["Z"]]}:{path:[["M",f,e],["L",y,b],["A",n.endRho,n.endRho,0,+g,1,w,d],["L",p,k],["A",n.startRho,n.startRho,0,+g,0,f,e],["Z"]]}},calcMiddle:function(n){var t=this,r=t.rad,i=n.slice,s=t.centerX,h=t.centerY,u=i.startAngle,f=i.endAngle,v=Math.max("rho"in i?i.rho:t.radius,t.label.minMargin),y=+t.donut,e=Math.min(u,f)*r,c=Math.max(u,f)*r,o=-(e+(c-e)/2),l=s+(n.endRho+n.startRho)/2*Math.cos(o),a=h-(n.endRho+n.startRho)/2*Math.sin(o);n.middle={x:l,y:a}},drawSeries:function(){var n=this,g=n.chart,y=g.getChartStore(),rt=n.group,ut=n.chart.animate,b=n.chart.axes.get(0),k=b&&b.minimum||n.minimum||0,ft=b&&b.maximum||n.maximum||0,ct=n.angleField||n.field||n.xField,lt=g.surface,c=g.chartBBox,vt=n.rad,h=+n.donut,et=[],nt=n.seriesStyle,yt=n.seriesLabelStyle,e=n.colorArrayStyle,tt=e&&e.length||0,l=Math.cos,a=Math.sin,r,o,s,u,p,f,v,it,ot,w,i,st,at,t,d,ht;if(Ext.apply(nt,n.style||{}),n.setBBox(),at=n.bbox,n.colorSet&&(e=n.colorSet,tt=e.length),!y||!y.getCount()||n.seriesIsHidden){n.hide();n.items=[];return}for(o=n.centerX=c.x+c.width/2,s=n.centerY=c.y+c.height,n.radius=Math.min(o-c.x,s-c.y),n.slices=p=[],n.items=et=[],n.value||(w=y.getAt(0),n.value=w.get(ct)),v=n.value,n.needle?(d={series:n,value:v,startAngle:-180,endAngle:0,rho:n.radius},t=-180*(1-(v-k)/(ft-k)),p.push(d)):(t=-180*(1-(v-k)/(ft-k)),d={series:n,value:v,startAngle:-180,endAngle:t,rho:n.radius},ht={series:n,value:n.maximum-v,startAngle:t,endAngle:0,rho:n.radius},p.push(d,ht)),i=0,ot=p.length;i<ot;i++)if(u=p[i],f=rt.getAt(i),r=Ext.apply({segment:{startAngle:u.startAngle,endAngle:u.endAngle,margin:0,rho:u.rho,startRho:u.rho*+h/100,endRho:u.rho}},Ext.apply(nt,e&&{fill:e[i%tt]}||{})),it=Ext.apply({},r.segment,{slice:u,series:n,storeItem:w,index:i}),et[i]=it,f||(st=Ext.apply({type:"path",group:rt},Ext.apply(nt,e&&{fill:e[i%tt]}||{})),f=lt.add(Ext.apply(st,r))),u.sprite=u.sprite||[],it.sprite=f,u.sprite.push(f),ut){r=n.renderer(f,w,r,i,y);f._to=r;n.onAnimate(f,{to:r})}else r=n.renderer(f,w,Ext.apply(r,{hidden:!1}),i,y),f.setAttributes(r,!0);if(n.needle){if(t=t*Math.PI/180,n.needleSprite)if(ut)n.onAnimate(n.needleSprite,{to:{path:["M",o+n.radius*+h/100*l(t),s+-Math.abs(n.radius*+h/100*a(t)),"L",o+n.radius*l(t),s+-Math.abs(n.radius*a(t))]}});else n.needleSprite.setAttributes({type:"path",path:["M",o+n.radius*+h/100*l(t),s+-Math.abs(n.radius*+h/100*a(t)),"L",o+n.radius*l(t),s+-Math.abs(n.radius*a(t))]});else n.needleSprite=n.chart.surface.add({type:"path",path:["M",o+n.radius*+h/100*l(t),s+-Math.abs(n.radius*+h/100*a(t)),"L",o+n.radius*l(t),s+-Math.abs(n.radius*a(t))],"stroke-width":4,stroke:"#222"});n.needleSprite.setAttributes({hidden:!1},!0)}delete n.value},setValue:function(n){this.value=n;this.drawSeries()},onCreateLabel:function(){},onPlaceLabel:function(){},onPlaceCallout:function(){},onAnimate:function(n){return n.show(),this.callParent(arguments)},isItemInPoint:function(n,t,i,r){var u=this,f=u.centerX,e=u.centerY,o=Math.abs,s=o(n-f),h=o(t-e),a=i.startAngle,v=i.endAngle,c=Math.sqrt(s*s+h*h),l=Math.atan2(t-e,n-f)/u.rad;return r===0&&l>=a&&l<v&&c>=i.startRho&&c<=i.endRho},getLegendColor:function(n){var t=this.colorSet||this.colorArrayStyle;return t[n%t.length]}})