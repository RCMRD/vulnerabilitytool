Ext.define("Ext.chart.series.Bar",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.BarSeries","Ext.chart.BarChart","Ext.chart.StackedBarChart"],requires:["Ext.chart.axis.Axis","Ext.fx.Anim"],type:"bar",alias:"series.bar",column:!1,style:{},gutter:38.2,groupGutter:38.2,xPadding:0,yPadding:10,constructor:function(n){this.callParent(arguments);var t=this,r=t.chart.surface,f=t.chart.shadow,i,u;if(n.highlightCfg=Ext.Object.merge({lineWidth:3,stroke:"#55c",opacity:.8,color:"#f00"},n.highlightCfg),Ext.apply(t,n,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":.05,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:1.2}},{"stroke-width":4,"stroke-opacity":.1,stroke:"rgb(150, 150, 150)",translate:{x:.9,y:.9}},{"stroke-width":2,"stroke-opacity":.15,stroke:"rgb(100, 100, 100)",translate:{x:.6,y:.6}}]}),t.group=r.getGroup(t.seriesId+"-bars"),f)for(i=0,u=t.shadowAttributes.length;i<u;i++)t.shadowGroups.push(r.getGroup(t.seriesId+"-shadows"+i))},getPadding:function(){var r=this,t=r.xPadding,i=r.yPadding,n={};return Ext.isNumber(t)?(n.left=t,n.right=t):Ext.isObject(t)?(n.left=t.left,n.right=t.right):(n.left=0,n.right=0),n.width=n.left+n.right,Ext.isNumber(i)?(n.bottom=i,n.top=i):Ext.isObject(i)?(n.bottom=i.bottom,n.top=i.top):(n.bottom=0,n.top=0),n.height=n.bottom+n.top,n},getBarGirth:function(){var n=this,u=n.chart.getChartStore(),f=n.column,e=u.getCount(),i=n.gutter/100,r,t;return n.style&&n.style.width?n.style.width:(r=n.getPadding(),t=f?"width":"height",(n.chart.chartBBox[t]-r[t])/(e*(i+1)-i))},getGutters:function(){var t=this,i=t.column,n=t.getPadding(),r=t.getBarGirth()/2,u=Math.ceil((i?n.left:n.bottom)+r),f=Math.ceil((i?n.right:n.top)+r);return{lower:u,upper:f,verticalAxis:!i}},getBounds:function(){var n=this,ut=n.chart,dt=ut.getChartStore(),d=dt.data.items,t,g,nt,ft=[].concat(n.yField),et,ot=ft.length,tt=ot,it=n.groupGutter/100,h=n.column,o=n.getPadding(),st=n.stacked,ht=n.getBarGirth(),vt=h?"width":"height",p=Math,gt=p.min,yt=p.max,ct=p.abs,pt=n.getAxesForXAndYFields(),ni=pt.yAxis,s,w,wt,bt,rt,c,lt,l,u,i,f,a,v,b,y,r,k,e,kt,at;if(n.setBBox(!0),u=n.bbox,n.__excludes)for(e=0,r=n.__excludes.length;e<r;e++)n.__excludes[e]&&tt--;if(a=ut.axes.get(ni),a&&(c=a.applyData(),i=c.from,f=c.to),n.yField&&!Ext.isNumber(i)&&(v=n.getMinMaxYValues(),i=v[0],f=v[1]),Ext.isNumber(i)||(i=0),Ext.isNumber(f)||(f=0),b=(h?u.height-o.height:u.width-o.width)/(f-i),lt=ht,l=ht/((st?1:tt)*(it+1)-it),vt in n.style&&(l=gt(l,n.style[vt]),lt=l*((st?1:tt)*(it+1)-it)),y=h?u.y+u.height-o.bottom:u.x+o.left,st){for(r=[[],[]],t=0,g=d.length;t<g;t++)for(nt=d[t],r[0][t]=r[0][t]||0,r[1][t]=r[1][t]||0,e=0;e<ot;e++)n.__excludes&&n.__excludes[e]||(k=nt.get(ft[e]),r[+(k>0)][t]+=ct(k));r[+(f>0)].push(ct(f));r[+(i>0)].push(ct(i));at=yt.apply(p,r[0]);kt=yt.apply(p,r[1]);b=(h?u.height-o.height:u.width-o.width)/(kt+at);y=y+at*b*(h?-1:1)}else i/f<0&&(y=y-i*b*(h?-1:1));if(n.boundColumn)for(a=ut.axes.get(pt.xAxis),a&&(c=a.applyData(),s=c.from,w=c.to),n.xField&&!Ext.isNumber(s)&&(v=n.getMinMaxYValues(),s=v[0],w=v[1]),Ext.isNumber(s)||(s=0),Ext.isNumber(w)||(w=0),rt=n.getGutters(),wt=(u.width-(rt.lower+rt.upper))/(w-s||1),bt=u.x+rt.lower,et=[],t=0,g=d.length;t<g;t++)nt=d[t],k=nt.get(n.xField),et[t]=bt+(k-s)*wt-l/2;return{bars:ft,barsLoc:et,bbox:u,shrunkBarWidth:lt,barsLen:ot,groupBarsLen:tt,barWidth:ht,groupBarWidth:l,scale:b,zero:y,padding:o,signed:i/f<0,minY:i,maxY:f}},getPaths:function(){for(var t=this,p=t.chart,ni=p.getChartStore(),tt=ni.data.items,w,r=t.bounds=t.getBounds(),c=t.items=[],ti=Ext.isArray(t.yField)?t.yField:[t.yField],vt=t.gutter/100,yt=t.groupGutter/100,ii=p.animate,l=t.column,ri=t.group,ui=p.shadow,it=t.shadowGroups,oi=t.shadowAttributes,pt=it.length,wt=r.bbox,b=r.barWidth,bt=r.shrunkBarWidth,kt=t.getPadding(),o=t.stacked,k=r.barsLen,rt=t.colorArrayStyle,fi=rt&&rt.length||0,ei=t.themeIdx,ut=Math,ft=ut.max,si=ut.min,d=ut.abs,f,s,u,et,ot,a,g,st,n,ht,e,ct,lt,h,v,at,dt,nt,gt,i=0,y=tt.length;i<y;i++){for(w=tt[i],a=r.zero,g=r.zero,et=0,ot=0,ct=lt=0,st=!1,f=0,e=0;f<k;f++)if(!t.__excludes||!t.__excludes[f]){if(s=w.get(r.bars[f]),s>=0?ct+=s:lt+=s,u=Math.round((s-ft(r.minY,0))*r.scale),gt=ei+(k>1?f:0),n={fill:rt[gt%fi]},l?Ext.apply(n,{height:u,width:ft(r.groupBarWidth,0),x:t.boundColumn?r.barsLoc[i]:wt.x+kt.left+(b-bt)*.5+i*b*(1+vt)+e*r.groupBarWidth*(1+yt)*!o,y:a-u}):(dt=y-1-i,Ext.apply(n,{height:ft(r.groupBarWidth,0),width:u+(a==r.zero),x:a+(a!=r.zero),y:wt.y+kt.top+(b-bt)*.5+dt*b*(1+vt)+e*r.groupBarWidth*(1+yt)*!o+1})),u<0&&(l?(n.y=g,n.height=d(u)):(n.x=g+u,n.width=d(u))),o&&(u<0?g+=u*(l?-1:1):a+=u*(l?-1:1),et+=d(u),u<0&&(ot+=d(u))),n.x=Math.floor(n.x)+1,nt=Math.floor(n.y),Ext.isIE8m&&n.y>nt&&nt--,n.y=nt,n.width=Math.floor(n.width),n.height=Math.floor(n.height),c.push({series:t,yField:ti[f],storeItem:w,value:[w.get(t.xField),s],attr:n,point:l?[n.x+n.width/2,s>=0?n.y:n.y+n.height]:[s>=0?n.x+n.width:n.x,n.y+n.height/2]}),ii&&p.resizing){if(ht=l?{x:n.x,y:r.zero,width:n.width,height:0}:{x:r.zero,y:n.y,width:0,height:n.height},ui&&(o&&!st||!o))for(st=!0,h=0;h<pt;h++)v=it[h].getAt(o?i:i*k+f),v&&v.setAttributes(ht,!0);at=ri.getAt(i*k+f);at&&at.setAttributes(ht,!0)}e++}o&&c.length&&(c[i*e].totalDim=et,c[i*e].totalNegDim=ot,c[i*e].totalPositiveValues=ct,c[i*e].totalNegativeValues=lt)}if(o&&e==0)for(i=0,y=tt.length;i<y;i++)for(h=0;h<pt;h++)v=it[h].getAt(i),v&&v.hide(!0)},renderShadows:function(n,t,i,r){var u=this,l=u.chart,d=l.surface,g=l.animate,s=u.stacked,a=u.shadowGroups,nt=u.shadowAttributes,tt=a.length,p=l.getChartStore(),it=u.column,w=u.items,b=[],k=r.zero,o,f,e,h,v,y,c;if(s&&n%r.groupBarsLen==0||!s)for(y=n/r.groupBarsLen,o=0;o<tt;o++){if(f=Ext.apply({},nt[o]),e=a[o].getAt(s?y:n),Ext.copyTo(f,t,"x,y,width,height"),e||(e=d.add(Ext.apply({type:"rect",group:a[o]},Ext.apply({},i,f)))),s&&(h=w[n].totalDim,v=w[n].totalNegDim,it?(f.y=k+v-h-1,f.height=h):(f.x=k-v,f.width=h)),c=u.renderer(e,p.getAt(y),f,n,p),c.hidden=!!t.hidden,g)u.onAnimate(e,{to:c});else e.setAttributes(c,!0);b.push(e)}return b},drawSeries:function(){var n=this,h=n.chart,e=h.getChartStore(),rt=h.surface,ut=h.animate,ft=n.stacked,et=n.column,g=h.axes,nt=n.getAxesForXAndYFields(),v=nt.xAxis,st=nt.yAxis,w=h.shadow,b=n.shadowGroups,tt=b.length,y=n.group,ot=n.seriesStyle,c,o,t,i,k,r,l,f,d,s,u,a,p,it;if(!e||!e.getCount()||n.seriesIsHidden){n.hide();n.items=[];return}for(u=Ext.apply({},this.style,ot),delete u.fill,delete u.x,delete u.y,delete u.width,delete u.height,n.unHighlightItem(),n.cleanHighlights(),n.boundColumn=v&&Ext.Array.contains(n.axis,v)&&g.get(v)&&g.get(v).isNumericAxis,n.getPaths(),s=n.bounds,c=n.items,k=et?{y:s.zero,height:0}:{x:s.zero,width:0},o=c.length,t=0;t<o;t++){if(r=y.getAt(t),a=c[t].attr,w&&(c[t].shadows=n.renderShadows(t,a,k,s)),r||(p=Ext.apply({},k,a),p=Ext.apply(p,u||{}),r=rt.add(Ext.apply({},{type:"rect",group:y},p))),ut){if(l=n.renderer(r,e.getAt(t),a,t,e),r._to=l,it=n.onAnimate(r,{to:Ext.apply(l,u)}),w&&ft&&t%s.barsLen==0)for(i=t/s.barsLen,f=0;f<tt;f++)it.on("afteranimate",function(){this.show(!0)},b[f].getAt(i))}else l=n.renderer(r,e.getAt(t),Ext.apply(a,{hidden:!1}),t,e),r.setAttributes(Ext.apply(l,u),!0);c[t].sprite=r}for(o=y.getCount(),i=t;i<o;i++)y.getAt(i).hide(!0);if(n.stacked&&(t=e.getCount()),w)for(f=0;f<tt;f++)for(d=b[f],o=d.getCount(),i=t;i<o;i++)d.getAt(i).hide(!0);n.renderLabels()},onCreateLabel:function(){var n=this,t=n.chart.surface,i=n.labelsGroup,r=n.label,u=Ext.apply({},r,n.seriesLabelStyle||{});return t.add(Ext.apply({type:"text",group:i},u||{}))},onPlaceLabel:function(n,t,i,r,u,f,e){var w=this,ht=w.bounds,y=ht.groupBarWidth,ut=w.column,ct=w.chart,d=ct.chartBBox,vt=ct.resizing,bt=i.value[0],ft=i.value[1],o=i.attr,et=w.label,g=w.stacked,yt=et.stackedDisplay,s=et.orientation=="vertical",pt=[].concat(et.field),wt=et.renderer,nt,tt,a,h,it=ht.zero,rt="insideStart",k="insideEnd",v="outside",lt="over",at="under",p=4,b=2,kt=ht.signed,c,l,ot,st;if(u==rt||u==k||u==v){if(g&&u==v){n.hide(!0);return}if(n.setAttributes({style:undefined}),nt=Ext.isNumber(e)?wt(t.get(pt[e]),n,t,i,r,u,f,e):"",n.setAttributes({text:nt}),tt=w.getLabelSize(nt,n.attr.style),a=tt.width,h=tt.height,ut){if(!a||!h||g&&o.height<h){n.hide(!0);return}if(c=o.x+(s?y/2:(y-a)/2),u==v&&(st=ft>=0?o.y-d.y:d.y+d.height-o.y-o.height,st<h+b&&(u=k)),g||u==v||h+b>o.height&&(u=v),!l)if(l=o.y,ft>=0)switch(u){case rt:l+=o.height+(s?-b:-h/2);break;case k:l+=s?h+p:h/2;break;case v:l+=s?-b:-h/2}else switch(u){case rt:l+=s?h+b:h/2;break;case k:l+=s?o.height-b:o.height-h/2;break;case v:l+=s?o.height+h+b:o.height+h/2}}else{if(!a||!h||g&&!o.width){n.hide(!0);return}if(l=o.y+(s?(y+h)/2:y/2),u==v&&(st=ft>=0?d.x+d.width-o.x-o.width:o.x-d.x,st<a+p&&(u=k)),u!=v&&!s&&a+p>o.width)if(g){if(h>o.width){n.hide(!0);return}c=o.x+o.width/2;l=o.y+o.height-(o.height-a)/2;s=!0}else u=v;if(!c)if(c=o.x,ft>=0)switch(u){case rt:c+=s?a/2:p;break;case k:c+=o.width+(s?-a/2:-a-p);break;case v:c+=o.width+(s?a/2:p)}else switch(u){case rt:c+=o.width+(s?-a/2:-a-p);break;case k:c+=s?a/2:p;break;case v:c+=s?-a/2:-a-p}}}else if((u==lt||u==at)&&g&&yt){nt=n.attr.text;n.setAttributes({style:Ext.applyIf(n.attr&&n.attr.style||{},{"font-weight":"bold","font-size":"14px"})});tt=w.getLabelSize(nt,n.attr.style);a=tt.width;h=tt.height;switch(u){case lt:ut?(c=o.x+(s?y/2:(y-a)/2),l=it-(i.totalDim-i.totalNegDim)-h/2-b):(c=it+(i.totalDim-i.totalNegDim)+p,l=o.y+(s?(y+h)/2:y/2));break;case at:ut?(c=o.x+(s?y/2:(y-a)/2),l=it+i.totalNegDim+h/2):(c=it-i.totalNegDim-a-p,l=o.y+(s?(y+h)/2:y/2))}}if(c==undefined||l==undefined){n.hide(!0);return}if(n.isOutside=u==v,n.setAttributes({text:nt}),ot={x:c,y:l},s&&(ot.rotate={x:c,y:l,degrees:270}),f&&vt&&(ut?(c=o.x+o.width/2,l=it):(c=it,l=o.y+o.height/2),n.setAttributes({x:c,y:l},!0),s&&n.setAttributes({rotate:{x:c,y:l,degrees:270}},!0)),f)w.onAnimate(n,{to:ot});else n.setAttributes(Ext.apply(ot,{hidden:!1}),!0)},getLabelSize:function(n,t){var i=this.testerLabel,e=this.label,s=Ext.apply({},e,t,this.seriesLabelStyle||{}),o=e.orientation==="vertical",r,u,f;return i||(i=this.testerLabel=this.chart.surface.add(Ext.apply({type:"text",opacity:0},s))),i.setAttributes({style:t,text:n},!0),r=i.getBBox(),u=r.width,f=r.height,{width:o?f:u,height:o?u:f}},onAnimate:function(n){return n.show(),this.callParent(arguments)},isItemInPoint:function(n,t,i){var r=i.sprite.getBBox();return r.x<=n&&r.y<=t&&r.x+r.width>=n&&r.y+r.height>=t},hideAll:function(n){var r=this.chart.axes,i=r.items,u=i.length,t=0;for(n=(isNaN(this._index)?n:this._index)||0,this.__excludes||(this.__excludes=[]),this.__excludes[n]=!0,this.drawSeries(),t;t<u;t++)i[t].drawAxis()},showAll:function(n){var r=this.chart.axes,i=r.items,u=i.length,t=0;for(n=(isNaN(this._index)?n:this._index)||0,this.__excludes||(this.__excludes=[]),this.__excludes[n]=!1,this.drawSeries(),t;t<u;t++)i[t].drawAxis()},getLegendColor:function(n){var t=this,i=t.colorArrayStyle.length;return t.style&&t.style.fill?t.style.fill:t.colorArrayStyle[n%i]},highlightItem:function(){this.callParent(arguments);this.renderLabels()},unHighlightItem:function(){this.callParent(arguments);this.renderLabels()},cleanHighlights:function(){this.callParent(arguments);this.renderLabels()}})