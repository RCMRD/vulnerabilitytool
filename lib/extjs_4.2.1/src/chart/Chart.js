Ext.define("Ext.chart.Chart",{extend:"Ext.draw.Component",alias:"widget.chart",mixins:{themeManager:"Ext.chart.theme.Theme",mask:"Ext.chart.Mask",navigation:"Ext.chart.Navigation",bindable:"Ext.util.Bindable",observable:"Ext.util.Observable"},uses:["Ext.chart.series.Series"],requires:["Ext.util.MixedCollection","Ext.data.StoreManager","Ext.chart.Legend","Ext.chart.theme.Base","Ext.chart.theme.Theme","Ext.util.DelayedTask"],viewBox:!1,animate:!1,legend:!1,insetPadding:10,background:!1,constructor:function(n){var t=this,i;n=Ext.apply({},n);t.initTheme(n.theme||t.theme);t.gradients&&Ext.apply(n,{gradients:t.gradients});t.background&&Ext.apply(n,{background:t.background});n.animate&&(i={easing:"ease",duration:500},n.animate=Ext.isObject(n.animate)?Ext.applyIf(n.animate,i):i);t.mixins.observable.constructor.call(t,n);n.enableMask&&t.mixins.mask.constructor.call(t);t.mixins.navigation.constructor.call(t);t.callParent([n])},getChartStore:function(){return this.substore||this.store},initComponent:function(){var n=this,t,i;n.callParent();n.addEvents("itemmousedown","itemmouseup","itemmouseover","itemmouseout","itemclick","itemdblclick","itemdragstart","itemdrag","itemdragend","beforerefresh","refresh");Ext.applyIf(n,{zoom:{width:1,height:1,x:0,y:0}});n.maxGutters={left:0,right:0,bottom:0,top:0};n.store=Ext.data.StoreManager.lookup(n.store);t=n.axes;n.axes=new Ext.util.MixedCollection(!1,function(n){return n.position});t&&n.axes.addAll(t);i=n.series;n.series=new Ext.util.MixedCollection(!1,function(n){return n.seriesId||(n.seriesId=Ext.id(null,"ext-chart-series-"))});i&&n.series.addAll(i);n.legend!==!1&&(n.legend=new Ext.chart.Legend(Ext.applyIf({chart:n},n.legend)));n.on({mousemove:n.onMouseMove,mouseleave:n.onMouseLeave,mousedown:n.onMouseDown,mouseup:n.onMouseUp,click:n.onClick,dblclick:n.onDblClick,scope:n})},afterComponentLayout:function(n,t,i,r){var u=this;Ext.isNumber(n)&&Ext.isNumber(t)&&(n!==i||t!==r?(u.curWidth=n,u.curHeight=t,u.redraw(!0),u.needsRedraw=!1):u.needsRedraw&&(u.redraw(),u.needsRedraw=!1));this.callParent(arguments)},redraw:function(n){var i=this,o=i.series.items,h=o.length,f=i.axes.items,e=f.length,s=0,t,r,c=i.chartBBox={x:0,y:0,height:i.curHeight,width:i.curWidth},u=i.legend,l;for(i.surface.setSize(c.width,c.height),t=0;t<h;t++)r=o[t],l=r.initialized?r:i.initializeSeries(r,t,s),l.onRedraw(),Ext.isArray(r.yField)?s+=r.yField.length:++s;for(t=0;t<e;t++)r=f[t],r.initialized||i.initializeAxis(r);for(t=0;t<e;t++)f[t].processView();for(t=0;t<e;t++)f[t].drawAxis(!0);for(u!==!1&&u.visible&&(u.update||!u.created)&&u.create(),i.alignAxes(),u!==!1&&u.visible&&u.updatePosition(),i.getMaxGutters(),i.resizing=!!n,t=0;t<e;t++)f[t].drawAxis();for(t=0;t<h;t++)i.drawCharts(o[t]);i.resizing=!1},afterRender:function(){var n=this;if(n.callParent(arguments),n.categoryNames&&n.setCategoryNames(n.categoryNames),n.bindStore(n.store,!0),n.refresh(),n.surface.engine==="Vml"){n.on("added",n.onAddedVml,n);n.mon(n.hierarchyEventSource,"added",n.onContainerAddedVml,n)}},onAddedVml:function(){this.needsRedraw=!0},onContainerAddedVml:function(n){this.isDescendantOf(n)&&(this.needsRedraw=!0)},getEventXY:function(n){var f=this,t=this.surface.getRegion(),i=n.getXY(),r=i[0]-t.left,u=i[1]-t.top;return[r,u]},onClick:function(n){this.handleClick("itemclick",n)},onDblClick:function(n){this.handleClick("itemdblclick",n)},handleClick:function(n,t){for(var e=this,r=e.getEventXY(t),o=e.series.items,i,f,u=0,s=o.length;u<s;u++)i=o[u],Ext.draw.Draw.withinBox(r[0],r[1],i.bbox)&&i.getItemForPoint&&(f=i.getItemForPoint(r[0],r[1]),f&&i.fireEvent(n,f))},onMouseDown:function(n){var t=this,r=t.getEventXY(n),e=t.series.items,u,o,i,f;for(t.enableMask&&t.mixins.mask.onMouseDown.call(t,n),u=0,o=e.length;u<o;u++)i=e[u],Ext.draw.Draw.withinBox(r[0],r[1],i.bbox)&&i.getItemForPoint&&(f=i.getItemForPoint(r[0],r[1]),f&&i.fireEvent("itemmousedown",f))},onMouseUp:function(n){var t=this,r=t.getEventXY(n),e=t.series.items,u,o,i,f;for(t.enableMask&&t.mixins.mask.onMouseUp.call(t,n),u=0,o=e.length;u<o;u++)i=e[u],Ext.draw.Draw.withinBox(r[0],r[1],i.bbox)&&i.getItemForPoint&&(f=i.getItemForPoint(r[0],r[1]),f&&i.fireEvent("itemmouseup",f))},onMouseMove:function(n){var u=this,f=u.getEventXY(n),o=u.series.items,e,s,t,i,r,h,c;for(u.enableMask&&u.mixins.mask.onMouseMove.call(u,n),e=0,s=o.length;e<s;e++)t=o[e],Ext.draw.Draw.withinBox(f[0],f[1],t.bbox)?t.getItemForPoint&&(i=t.getItemForPoint(f[0],f[1]),r=t._lastItemForPoint,h=t._lastStoreItem,c=t._lastStoreField,(i!==r||i&&(i.storeItem!=h||i.storeField!=c))&&(r&&(t.fireEvent("itemmouseout",r),delete t._lastItemForPoint,delete t._lastStoreField,delete t._lastStoreItem),i&&(t.fireEvent("itemmouseover",i),t._lastItemForPoint=i,t._lastStoreItem=i.storeItem,t._lastStoreField=i.storeField))):(r=t._lastItemForPoint,r&&(t.fireEvent("itemmouseout",r),delete t._lastItemForPoint,delete t._lastStoreField,delete t._lastStoreItem))},onMouseLeave:function(n){var t=this,r=t.series.items,i,u,f;for(t.enableMask&&t.mixins.mask.onMouseLeave.call(t,n),i=0,u=r.length;i<u;i++)f=r[i],delete f._lastItemForPoint},delayRefresh:function(){var n=this;n.refreshTask||(n.refreshTask=new Ext.util.DelayedTask(n.refresh,n));n.refreshTask.delay(n.refreshBuffer)},refresh:function(){var n=this;if(n.rendered&&n.curWidth!==undefined&&n.curHeight!==undefined){if(!n.isVisible(!0)){n.refreshPending||(n.setShowListeners("mon"),n.refreshPending=!0);return}n.fireEvent("beforerefresh",n)!==!1&&(n.redraw(),n.fireEvent("refresh",n))}},onShow:function(){var n=this;n.callParent(arguments);n.refreshPending&&(n.delayRefresh(),n.setShowListeners("mun"));delete n.refreshPending},setShowListeners:function(n){var t=this;t[n](t.hierarchyEventSource,{scope:t,single:!0,show:t.forceRefresh,expand:t.forceRefresh})},doRefresh:function(){this.setSubStore(null);this.refresh()},forceRefresh:function(n){var t=this;t.isDescendantOf(n)&&t.refreshPending&&(t.setShowListeners("mun"),t.delayRefresh());delete t.refreshPending},bindStore:function(n,t){var i=this;i.mixins.bindable.bindStore.apply(i,arguments);i.store&&!t&&i.refresh()},getStoreListeners:function(){var t=this.doRefresh,n=this.delayRefresh;return{refresh:t,add:n,bulkremove:n,update:n,clear:t}},setSubStore:function(n){this.substore=n},initializeAxis:function(n){var f=this,e=f.chartBBox,u=e.width,r=e.height,o=e.x,s=e.y,i=f.themeAttrs,t={chart:f};i&&(t.axisStyle=Ext.apply({},i.axis),t.axisLabelLeftStyle=Ext.apply({},i.axisLabelLeft),t.axisLabelRightStyle=Ext.apply({},i.axisLabelRight),t.axisLabelTopStyle=Ext.apply({},i.axisLabelTop),t.axisLabelBottomStyle=Ext.apply({},i.axisLabelBottom),t.axisTitleLeftStyle=Ext.apply({},i.axisTitleLeft),t.axisTitleRightStyle=Ext.apply({},i.axisTitleRight),t.axisTitleTopStyle=Ext.apply({},i.axisTitleTop),t.axisTitleBottomStyle=Ext.apply({},i.axisTitleBottom));switch(n.position){case"top":Ext.apply(t,{length:u,width:r,x:o,y:s});break;case"bottom":Ext.apply(t,{length:u,width:r,x:o,y:r});break;case"left":Ext.apply(t,{length:r,width:u,x:o,y:r});break;case"right":Ext.apply(t,{length:r,width:u,x:u,y:r})}n.chart?Ext.apply(n,t):(Ext.apply(t,n),n=f.axes.replace(Ext.createByAlias("axis."+n.type.toLowerCase(),t)));n.initialized=!0},getInsets:function(){var t=this,n=t.insetPadding;return{top:n,right:n,bottom:n,left:n}},calculateInsets:function(){function l(n){var t=s.findIndex("position",n);return t<0?null:s.getAt(t)}var i=this,e=i.legend,s=i.axes,h=["top","right","bottom","left"],r,u,c,n,o,f,t;for(r=i.getInsets(),u=0,c=h.length;u<c;u++)n=h[u],o=n==="left"||n==="right",f=l(n),e!==!1&&e.position===n&&(t=e.getBBox(),r[n]+=(o?t.width:t.height)+i.insetPadding),f&&f.bbox&&(t=f.bbox,r[n]+=o?t.width:t.height);return r},alignAxes:function(){var r=this,o=r.axes.items,t,n,f,s,i,u,e;for(t=r.calculateInsets(),n={x:t.left,y:t.top,width:r.curWidth-t.left-t.right,height:r.curHeight-t.top-t.bottom},r.chartBBox=n,f=0,s=o.length;f<s;f++)i=o[f],u=i.position,e=u==="left"||u==="right",i.x=u==="right"?n.x+n.width:n.x,i.y=u==="top"?n.y:n.y+n.height,i.width=e?n.width:n.height,i.length=e?n.height:n.width},initializeSeries:function(n,t,r){var h=this,f=h.themeAttrs,l,a,e,o,c,s=[],y=(n instanceof Ext.chart.series.Series).i=0,v,u;if(!n.initialized){if(u={chart:h,seriesId:n.seriesId},f){if(e=f.seriesThemes,c=f.markerThemes,l=Ext.apply({},f.series),a=Ext.apply({},f.marker),u.seriesStyle=Ext.apply(l,e[r%e.length]),u.seriesLabelStyle=Ext.apply({},f.seriesLabel),u.markerStyle=Ext.apply(a,c[r%c.length]),f.colors)u.colorArrayStyle=f.colors;else{for(s=[],v=e.length;i<v;i++)o=e[i],(o.fill||o.stroke)&&s.push(o.fill||o.stroke);s.length&&(u.colorArrayStyle=s)}u.seriesIdx=t;u.themeIdx=r}y?Ext.applyIf(n,u):(Ext.applyIf(u,n),n=h.series.replace(Ext.createByAlias("series."+n.type.toLowerCase(),u)))}return n.initialize&&n.initialize(),n.initialized=!0,n},getMaxGutters:function(){for(var e=this,o=e.series.items,n,i=0,r=0,u=0,f=0,t=0,s=o.length;t<s;t++)n=o[t].getGutters(),n&&(n.verticalAxis?(u=Math.max(u,n.lower),f=Math.max(f,n.upper)):(i=Math.max(i,n.lower),r=Math.max(r,n.upper)));e.maxGutters={left:i,right:r,bottom:u,top:f}},drawAxis:function(n){n.drawAxis()},drawCharts:function(n){n.triggerafterrender=!1;n.drawSeries();this.animate||n.fireEvent("afterrender")},save:function(n){return Ext.draw.Surface.save(this.surface,n)},destroy:function(){Ext.destroy(this.surface);this.bindStore(null);this.callParent(arguments)}})