Ext.define("Ext.chart.Mask",{requires:["Ext.chart.MaskLayer"],constructor:function(n){var t=this;if(t.addEvents("select"),n&&Ext.apply(t,n),t.enableMask)t.on("afterrender",function(){var n=new Ext.chart.MaskLayer({renderTo:t.el,hidden:!0});n.el.on({mousemove:function(n){t.onMouseMove(n)},mouseup:function(n){t.onMouseUp(n)}});n.initDraggable();t.maskType=t.mask;t.mask=n;t.maskSprite=t.surface.add({type:"path",path:["M",0,0],zIndex:1001,opacity:.6,hidden:!0,stroke:"#00f",cursor:"crosshair"})},t,{single:!0})},onMouseUp:function(n){var t=this,r=t.bbox||t.chartBBox,i;t.maskMouseDown=!1;t.mouseDown=!1;t.mouseMoved&&(t.handleMouseEvent(n),t.mouseMoved=!1,i=t.maskSelection,t.fireEvent("select",t,{x:i.x-r.x,y:i.y-r.y,width:i.width,height:i.height}))},onMouseDown:function(n){this.handleMouseEvent(n)},onMouseMove:function(n){this.handleMouseEvent(n)},handleMouseEvent:function(n){var t=this,e=t.maskType,c=t.bbox||t.chartBBox,o=c.x,s=c.y,l=Math,v=l.floor,y=l.abs,p=l.min,w=l.max,f=v(s+c.height),u=v(o+c.width),i=n.getPageX()-t.el.getX(),r=n.getPageY()-t.el.getY(),h=t.maskMouseDown,a;i=w(i,o);r=w(r,s);i=p(i,u);r=p(r,f);n.type==="mousedown"?(t.mouseDown=!0,t.mouseMoved=!1,t.maskMouseDown={x:i,y:r}):(t.mouseMoved=t.mouseDown,h&&t.mouseDown?(e=="horizontal"?(r=s,h.y=f):e=="vertical"&&(i=o,h.x=u),u=h.x-i,f=h.y-r,a=["M",i,r,"l",u,0,0,f,-u,0,"z"],t.maskSelection={x:(u>0?i:i+u)+t.el.getX(),y:(f>0?r:r+f)+t.el.getY(),width:y(u),height:y(f)},t.mask.updateBox(t.maskSelection),t.mask.show(),t.maskSprite.setAttributes({hidden:!0},!0)):(a=e=="horizontal"?["M",i,s,"L",i,f]:e=="vertical"?["M",o,r,"L",u,r]:["M",i,s,"L",i,f,"M",o,r,"L",u,r],t.maskSprite.setAttributes({path:a,"stroke-width":e===!0?1:1,hidden:!1},!0)))},onMouseLeave:function(){var n=this;n.mouseMoved=!1;n.mouseDown=!1;n.maskMouseDown=!1;n.mask.hide();n.maskSprite.hide(!0)}})