Ext.define("Ext.chart.LegendItem",{extend:"Ext.draw.CompositeSprite",requires:["Ext.chart.Shape"],hiddenSeries:!1,label:undefined,x:0,y:0,zIndex:500,boldRe:/bold\s\d{1,}.*/i,constructor:function(n){this.callParent(arguments);this.createLegend(n)},createLegend:function(n){var t=this,r=t.series,i=n.yFieldIndex;t.label=t.createLabel(n);t.createSeriesMarkers(n);t.setAttributes({hidden:!1},!0);t.yFieldIndex=i;t.on("mouseover",t.onMouseOver,t);t.on("mouseout",t.onMouseOut,t);t.on("mousedown",t.onMouseDown,t);r.visibleInLegend(i)||(t.hiddenSeries=!0,t.label.setAttributes({opacity:.5},!0));t.updatePosition({x:0,y:0})},getLabelText:function(){function t(n){var t=i[n];return Ext.isArray(t)?t[r]:t}var n=this,i=n.series,r=n.yFieldIndex;return t("title")||t("yField")},createLabel:function(){var n=this,t=n.legend;return n.add("label",n.surface.add({type:"text",x:20,y:0,zIndex:(n.zIndex||0)+2,fill:t.labelColor,font:t.labelFont,text:n.getLabelText(),style:{cursor:"pointer"}}))},createSeriesMarkers:function(n){var i=this,u=n.yFieldIndex,t=i.series,r=t.type,s=i.surface,f=i.zIndex,e,o;r==="line"||r==="scatter"?(r==="line"&&(e=Ext.apply(t.seriesStyle,t.style),i.drawLine(.5,.5,16.5,.5,f,e,u)),(t.showMarkers||r==="scatter")&&(o=Ext.apply(t.markerStyle,t.markerConfig||{},{fill:t.getLegendColor(u)}),i.drawMarker(8.5,.5,f,o))):i.drawFilledBox(12,12,f,u)},drawLine:function(n,t,i,r,u,f,e){var o=this,h=o.surface,s=o.series;return o.add("line",h.add({type:"path",path:"M"+n+","+t+"L"+i+","+r,zIndex:(u||0)+2,"stroke-width":s.lineWidth,"stroke-linejoin":"round","stroke-dasharray":s.dash,stroke:f.stroke||s.getLegendColor(e)||"#000",style:{cursor:"pointer"}}))},drawMarker:function(n,t,i,r){var u=this,f=u.surface,e=u.series;return u.add("marker",Ext.chart.Shape[r.type](f,{fill:r.fill,x:n,y:t,zIndex:(i||0)+2,radius:r.radius||r.size,style:{cursor:"pointer"}}))},drawFilledBox:function(n,t,i,r){var u=this,f=u.surface,e=u.series;return u.add("box",f.add({type:"rect",zIndex:(i||0)+2,x:0,y:0,width:n,height:t,fill:e.getLegendColor(r),style:{cursor:"pointer"}}))},onMouseOver:function(){var n=this;n.label.setStyle({"font-weight":"bold"});n.series._index=n.yFieldIndex;n.series.highlightItem()},onMouseOut:function(){var n=this,t=n.legend,i=n.boldRe;n.label.setStyle({"font-weight":t.labelFont&&i.test(t.labelFont)?"bold":"normal"});n.series._index=n.yFieldIndex;n.series.unHighlightItem()},onMouseDown:function(){var n=this,t=n.yFieldIndex;n.hiddenSeries?(n.series.showAll(t),n.label.setAttributes({opacity:1},!0)):(n.series.hideAll(t),n.label.setAttributes({opacity:.5},!0));n.hiddenSeries=!n.hiddenSeries;n.legend.chart.redraw()},updatePosition:function(n){var t=this,u=t.items,f=u.length,r=0,i;for(n||(n=t.legend);r<f;r++){i=u[r];switch(i.type){case"text":i.setAttributes({x:20+n.x+t.x,y:n.y+t.y},!0);break;case"rect":i.setAttributes({translate:{x:n.x+t.x,y:n.y+t.y-6}},!0);break;default:i.setAttributes({translate:{x:n.x+t.x,y:n.y+t.y}},!0)}}}})