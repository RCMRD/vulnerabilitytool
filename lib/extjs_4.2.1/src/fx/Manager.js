Ext.define("Ext.fx.Manager",{singleton:!0,requires:["Ext.util.MixedCollection","Ext.fx.target.Element","Ext.fx.target.ElementCSS","Ext.fx.target.CompositeElement","Ext.fx.target.CompositeElementCSS","Ext.fx.target.Sprite","Ext.fx.target.CompositeSprite","Ext.fx.target.Component"],mixins:{queue:"Ext.fx.Queue"},constructor:function(){var n=this;n.items=new Ext.util.MixedCollection;n.mixins.queue.constructor.call(n);n.taskRunner=new Ext.util.TaskRunner},interval:16,forceJS:!0,createTarget:function(n){var r=this,i=!r.forceJS&&Ext.supports.Transitions,t;if(r.useCSS3=i,n){if(n.tagName||Ext.isString(n)||n.isFly)n=Ext.get(n),t=new Ext.fx.target["Element"+(i?"CSS":"")](n);else if(n.dom)t=new Ext.fx.target["Element"+(i?"CSS":"")](n);else if(n.isComposite)t=new Ext.fx.target["CompositeElement"+(i?"CSS":"")](n);else if(n.isSprite)t=new Ext.fx.target.Sprite(n);else if(n.isCompositeSprite)t=new Ext.fx.target.CompositeSprite(n);else if(n.isComponent)t=new Ext.fx.target.Component(n);else return n.isAnimTarget?n:null;return r.targets.add(t),t}return null},addAnim:function(n){var t=this,r=t.items,i=t.task;r.add(n.id,n);!i&&r.length&&(i=t.task={run:t.runner,interval:t.interval,scope:t},t.taskRunner.start(i))},removeAnim:function(n){var t=this,i=t.items,r=t.task;i.removeAtKey(n.id);r&&!i.length&&(t.taskRunner.stop(r),delete t.task)},runner:function(){var n=this,r=n.items.getRange(),t=0,u=r.length,i;for(n.targetArr={},n.timestamp=new Date;t<u;t++)i=r[t],i.isReady()&&n.startAnim(i);for(t=0;t<u;t++)i=r[t],i.isRunning()?n.runAnim(i):!n.useCSS3;n.applyPendingAttrs()},startAnim:function(n){n.start(this.timestamp)},runAnim:function(n){if(n){var r=this,u=r.useCSS3&&n.target.type=="element",f=r.timestamp-n.startTime,e=f>=n.duration,t,i;if(t=this.collectTargetData(n,f,u,e),u){n.target.setAttr(t.anims[n.id].attributes,!0);r.collectTargetData(n,n.duration,u,e);n.paused=!0;t=n.target.target;n.target.isComposite&&(t=n.target.target.last());i={};i[Ext.supports.CSS3TransitionEnd]=n.lastFrame;i.scope=n;i.single=!0;t.on(i)}}},collectTargetData:function(n,t,i,r){var f=n.target.getId(),u=this.targetArr[f];return u||(u=this.targetArr[f]={id:f,el:n.target,anims:{}}),u.anims[n.id]={id:n.id,anim:n,elapsed:t,isLastFrame:r,attributes:[{duration:n.duration,easing:i&&n.reverse?n.easingFn.reverse().toCSS3():n.easing,attrs:n.runAnim(t)}]},u},applyPendingAttrs:function(){var i=this.targetArr,t,r,n,u,f;for(r in i)if(i.hasOwnProperty(r)){t=i[r];for(f in t.anims)t.anims.hasOwnProperty(f)&&(n=t.anims[f],u=n.anim,n.attributes&&u.isRunning()&&(t.el.setAttr(n.attributes,!1,n.isLastFrame),n.isLastFrame&&u.lastFrame()))}}})