Ext.define("Ext.dd.DragDropManager",{singleton:!0,requires:["Ext.util.Region"],uses:["Ext.tip.QuickTipManager"],alternateClassName:["Ext.dd.DragDropMgr","Ext.dd.DDM"],ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:!0,stopPropagation:!0,initialized:!1,locked:!1,init:function(){this.initialized=!0},POINT:0,INTERSECT:1,mode:0,notifyOccluded:!1,dragCls:Ext.baseCSSPrefix+"dd-drag-current",_execOnAll:function(n,t){var r,u,i;for(r in this.ids)for(u in this.ids[r])(i=this.ids[r][u],this.isTypeOfDD(i))&&i[n].apply(i,t)},_onLoad:function(){this.init();var n=Ext.EventManager;n.on(document,"mouseup",this.handleMouseUp,this,!0);n.on(document,"mousemove",this.handleMouseMove,this,!0);n.on(window,"unload",this._onUnload,this,!0);n.on(window,"resize",this._onResize,this,!0)},_onResize:function(){this._execOnAll("resetConstraints",[])},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},isLocked:function(){return this.locked},locationCache:{},useCache:!0,clickPixelThresh:3,clickTimeThresh:350,dragThreshMet:!1,clickTimeout:null,startX:0,startY:0,regDragDrop:function(n,t){this.initialized||this.init();this.ids[t]||(this.ids[t]={});this.ids[t][n.id]=n},removeDDFromGroup:function(n,t){this.ids[t]||(this.ids[t]={});var i=this.ids[t];i&&i[n.id]&&delete i[n.id]},_remove:function(n){for(var t in n.groups)t&&this.ids[t]&&this.ids[t][n.id]&&delete this.ids[t][n.id];delete this.handleIds[n.id]},regHandle:function(n,t){this.handleIds[n]||(this.handleIds[n]={});this.handleIds[n][t]=t},isDragDrop:function(n){return this.getDDById(n)?!0:!1},getRelated:function(n,t){var r=[],u,f,i;for(u in n.groups)for(f in this.ids[u])(i=this.ids[u][f],this.isTypeOfDD(i))&&(!t||i.isTarget)&&(r[r.length]=i);return r},isLegalTarget:function(n,t){for(var r=this.getRelated(n,!0),i=0,u=r.length;i<u;++i)if(r[i].id==t.id)return!0;return!1},isTypeOfDD:function(n){return n&&n.__ygDragDrop},isHandle:function(n,t){return this.handleIds[n]&&this.handleIds[n][t]},getDDById:function(n){var i,t;for(i in this.ids)if(t=this.ids[i][n],t instanceof Ext.dd.DDTarget)return t;return null},handleMouseDown:function(n,t){var i=this,r;Ext.quickTipsActive&&Ext.tip.QuickTipManager.ddDisable();i.dragCurrent&&i.handleMouseUp(n);i.currentTarget=n.getTarget();i.dragCurrent=t;r=t.getEl();Ext.isIE9m&&r.setCapture&&r.setCapture();i.startX=n.getPageX();i.startY=n.getPageY();i.deltaX=i.startX-r.offsetLeft;i.deltaY=i.startY-r.offsetTop;i.dragThreshMet=!1;i.clickTimeout=setTimeout(function(){i.startDrag(i.startX,i.startY)},i.clickTimeThresh)},startDrag:function(n,t){var i=this,r=i.dragCurrent,u;clearTimeout(i.clickTimeout);r&&(r.b4StartDrag(n,t),r.startDrag(n,t),u=r.getDragEl(),u&&Ext.fly(u).addCls(i.dragCls));i.dragThreshMet=!0},handleMouseUp:function(n){var t=this;(Ext.quickTipsActive&&Ext.tip.QuickTipManager.ddEnable(),t.dragCurrent)&&(Ext.isIE&&document.releaseCapture&&document.releaseCapture(),clearTimeout(t.clickTimeout),t.dragThreshMet&&t.fireEvents(n,!0),t.stopDrag(n),t.stopEvent(n))},stopEvent:function(n){this.stopPropagation&&n.stopPropagation();this.preventDefault&&n.preventDefault()},stopDrag:function(n){var t=this,i=t.dragCurrent,r;if(i){t.dragThreshMet&&(r=i.getDragEl(),r&&Ext.fly(r).removeCls(t.dragCls),i.b4EndDrag(n),i.endDrag(n));t.dragCurrent.onMouseUp(n)}t.dragCurrent=null;t.dragOvers={}},handleMouseMove:function(n){var t=this,i=t.dragCurrent,r,u;if(!i)return!0;if(t.dragThreshMet||(r=Math.abs(t.startX-n.getPageX()),u=Math.abs(t.startY-n.getPageY()),(r>t.clickPixelThresh||u>t.clickPixelThresh)&&t.startDrag(t.startX,t.startY)),t.dragThreshMet){i.b4Drag(n);i.onDrag(n);i.moveOnly||t.fireEvents(n,!1)}return t.stopEvent(n),!0},fireEvents:function(n,t){var f=this,u=f.dragCurrent,a,w,b=n.getPoint(),r,y,c=[],k=[],o=[],h=[],s=[],l=[],p,d,i,e,v;if(u&&!u.isLocked()){f.notifyOccluded||Ext.supports.PointerEvents&&!Ext.isIE10m&&!Ext.isOpera||u.deltaX<0||u.deltaY<0||(a=u.getDragEl(),w=a.style.top,a.style.top="-10000px",p=n.getXY(),n.target=document.elementFromPoint(p[0],p[1]),a.style.top=w);for(i in f.dragOvers)(r=f.dragOvers[i],f.isTypeOfDD(r))&&(f.notifyOccluded?this.isOverTarget(b,r,f.mode)||o.push(r):n.within(r.getEl())||o.push(r),k[i]=!0,delete f.dragOvers[i]);for(v in u.groups)if("string"==typeof v)for(i in f.ids[v])if(r=f.ids[v][i],f.isTypeOfDD(r)&&(y=r.getEl())&&r.isTarget&&!r.isLocked()&&Ext.fly(y).isVisible(!0)&&(r!=u||u.ignoreSelf===!1))if(f.notifyOccluded)(r.zIndex=f.getZIndex(y))!==-1&&(d=!0),c.push(r);else if(n.within(r.getEl())){c.push(r);break}for(d&&Ext.Array.sort(c,f.byZIndex),i=0,e=c.length;i<e;i++)if(r=c[i],f.isOverTarget(b,r,f.mode)&&(t?s.push(r):(k[r.id]?h.push(r):l.push(r),f.dragOvers[r.id]=r),!f.notifyOccluded))break;if(f.mode){if(o.length){u.b4DragOut(n,o);u.onDragOut(n,o)}if(l.length)u.onDragEnter(n,l);if(h.length){u.b4DragOver(n,h);u.onDragOver(n,h)}if(s.length){u.b4DragDrop(n,s);u.onDragDrop(n,s)}}else{for(i=0,e=o.length;i<e;++i){u.b4DragOut(n,o[i].id);u.onDragOut(n,o[i].id)}for(i=0,e=l.length;i<e;++i)u.onDragEnter(n,l[i].id);for(i=0,e=h.length;i<e;++i){u.b4DragOver(n,h[i].id);u.onDragOver(n,h[i].id)}for(i=0,e=s.length;i<e;++i){u.b4DragDrop(n,s[i].id);u.onDragDrop(n,s[i].id)}}if(t&&!s.length)u.onInvalidDrop(n)}},getZIndex:function(n){var r=document.body,t,i=-1;for(n=Ext.getDom(n);n!==r;)isNaN(t=Number(Ext.fly(n).getStyle("zIndex")))||(i=t),n=n.parentNode;return i},byZIndex:function(n,t){return n.zIndex<t.zIndex},getBestMatch:function(n){var t=null,u=n.length,r,i;if(u==1)t=n[0];else for(r=0;r<u;++r)if(i=n[r],i.cursorIsOver){t=i;break}else(!t||t.overlap.getArea()<i.overlap.getArea())&&(t=i);return t},refreshCache:function(n){var i,u,t,r;for(i in n)if("string"==typeof i)for(u in this.ids[i])t=this.ids[i][u],this.isTypeOfDD(t)&&(r=this.getLocation(t),r?this.locationCache[t.id]=r:delete this.locationCache[t.id])},verifyEl:function(n){if(n){var t;if(Ext.isIE)try{t=n.offsetParent}catch(i){}else t=n.offsetParent;if(t)return!0}return!1},getLocation:function(n){if(!this.isTypeOfDD(n))return null;if(n.getRegion)return n.getRegion();var i=n.getEl(),t,r,f,u,e,o,s,h,c;try{t=Ext.Element.getXY(i)}catch(l){}return t?(r=t[0],f=r+i.offsetWidth,u=t[1],e=u+i.offsetHeight,o=u-n.padding[0],s=f+n.padding[1],h=e+n.padding[2],c=r-n.padding[3],new Ext.util.Region(o,s,h,c)):null},isOverTarget:function(n,t,i){var u=this.locationCache[t.id],r,f,e,s,o;return(u&&this.useCache||(u=this.getLocation(t),this.locationCache[t.id]=u),!u)?!1:(t.cursorIsOver=u.contains(n),r=this.dragCurrent,!r||!r.getTargetCoord||!i&&!r.constrainX&&!r.constrainY)?t.cursorIsOver:(t.overlap=null,f=r.getTargetCoord(n.x,n.y),e=r.getDragEl(),s=new Ext.util.Region(f.y,f.x+e.offsetWidth,f.y+e.offsetHeight,f.x),o=s.intersect(u),o?(t.overlap=o,i?!0:t.cursorIsOver):!1)},_onUnload:function(){Ext.dd.DragDropManager.unregAll()},unregAll:function(){this.dragCurrent&&(this.stopDrag(),this.dragCurrent=null);this._execOnAll("unreg",[]);for(var n in this.elementCache)delete this.elementCache[n];this.elementCache={};this.ids={}},elementCache:{},getElWrapper:function(n){var t=this.elementCache[n];return t&&t.el||(t=this.elementCache[n]=new this.ElementWrapper(Ext.getDom(n))),t},getElement:function(n){return Ext.getDom(n)},getCss:function(n){var t=Ext.getDom(n);return t?t.style:null},ElementWrapper:function(n){this.el=n||null;this.id=this.el&&n.id;this.css=this.el&&n.style},getPosX:function(n){return Ext.Element.getX(n)},getPosY:function(n){return Ext.Element.getY(n)},swapNode:function(n,t){if(n.swapNode)n.swapNode(t);else{var i=t.parentNode,r=t.nextSibling;r==n?i.insertBefore(n,t):t==n.nextSibling?i.insertBefore(t,n):(n.parentNode.replaceChild(t,n),i.insertBefore(n,r))}},getScroll:function(){var u=window.document,n=u.documentElement,r=u.body,t=0,i=0;return Ext.isGecko4?(t=window.scrollYOffset,i=window.scrollXOffset):n&&(n.scrollTop||n.scrollLeft)?(t=n.scrollTop,i=n.scrollLeft):r&&(t=r.scrollTop,i=r.scrollLeft),{top:t,left:i}},getStyle:function(n,t){return Ext.fly(n).getStyle(t)},getScrollTop:function(){return this.getScroll().top},getScrollLeft:function(){return this.getScroll().left},moveToEl:function(n,t){var i=Ext.Element.getXY(t);Ext.Element.setXY(n,i)},numericSort:function(n,t){return n-t},_timeoutCount:0,_addListeners:function(){document?this._onLoad():this._timeoutCount<=2e3&&(setTimeout(this._addListeners,10),document&&document.body&&(this._timeoutCount+=1))},handleWasClicked:function(n,t){if(this.isHandle(t,n.id))return!0;for(var i=n.parentNode;i;){if(this.isHandle(t,i.id))return!0;i=i.parentNode}return!1}},function(){this._addListeners()})