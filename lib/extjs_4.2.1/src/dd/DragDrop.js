Ext.define("Ext.dd.DragDrop",{requires:["Ext.dd.DragDropManager"],constructor:function(n,t,i){n&&this.init(n,t,i)},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:!1,lock:function(){this.locked=!0},moveOnly:!1,unlock:function(){this.locked=!1},isTarget:!0,padding:null,_domRef:null,__ygDragDrop:!0,constrainX:!1,constrainY:!1,minX:0,maxX:0,minY:0,maxY:0,maintainOffset:!1,xTicks:null,yTicks:null,primaryButtonOnly:!0,available:!1,hasOuterHandles:!1,b4StartDrag:function(){},startDrag:function(){},b4Drag:function(){},onDrag:function(){},onDragEnter:function(){},b4DragOver:function(){},onDragOver:function(){},b4DragOut:function(){},onDragOut:function(){},b4DragDrop:function(){},onDragDrop:function(){},onInvalidDrop:function(){},b4EndDrag:function(){},endDrag:function(){},b4MouseDown:function(){},onMouseDown:function(){},onMouseUp:function(){},onAvailable:function(){},defaultPadding:{left:0,right:0,top:0,bottom:0},constrainTo:function(n,t){Ext.isNumber(t)&&(t={left:t,right:t,top:t,bottom:t});t=t||this.defaultPadding;var r=Ext.get(this.getEl()).getBox(),u=Ext.get(n),h=u.getScroll(),i,f=u.dom,e,o,s;f==document.body?i={x:h.left,y:h.top,width:Ext.Element.getViewWidth(),height:Ext.Element.getViewHeight()}:(e=u.getXY(),i={x:e[0],y:e[1],width:f.clientWidth,height:f.clientHeight});o=r.y-i.y;s=r.x-i.x;this.resetConstraints();this.setXConstraint(s-(t.left||0),i.width-s-r.width-(t.right||0),this.xTickSize);this.setYConstraint(o-(t.top||0),i.height-o-r.height-(t.bottom||0),this.yTickSize)},getEl:function(){return this._domRef||(this._domRef=Ext.getDom(this.id)),this._domRef},getDragEl:function(){return Ext.getDom(this.dragElId)},init:function(n,t,i){this.initTarget(n,t,i);Ext.EventManager.on(this.id,"mousedown",this.handleMouseDown,this)},initTarget:function(n,t,i){this.config=i||{};this.DDMInstance=Ext.dd.DragDropManager;this.groups={};typeof n!="string"&&(n=Ext.id(n));this.id=n;this.addToGroup(t?t:"default");this.handleElId=n;this.setDragElId(n);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();this.handleOnAvailable()},applyConfig:function(){this.padding=this.config.padding||[0,0,0,0];this.isTarget=this.config.isTarget!==!1;this.maintainOffset=this.config.maintainOffset;this.primaryButtonOnly=this.config.primaryButtonOnly!==!1},handleOnAvailable:function(){this.available=!0;this.resetConstraints();this.onAvailable()},setPadding:function(n,t,i,r){this.padding=t||0===t?i||0===i?[n,t,i,r]:[n,t,n,t]:[n,n,n,n]},setInitPosition:function(n,t){var r=this.getEl(),u,f,i;this.DDMInstance.verifyEl(r)&&(u=n||0,f=t||0,i=Ext.Element.getXY(r),this.initPageX=i[0]-u,this.initPageY=i[1]-f,this.lastPageX=i[0],this.lastPageY=i[1],this.setStartPosition(i))},setStartPosition:function(n){var t=n||Ext.Element.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=t[0];this.startPageY=t[1]},addToGroup:function(n){this.groups[n]=!0;this.DDMInstance.regDragDrop(this,n)},removeFromGroup:function(n){this.groups[n]&&delete this.groups[n];this.DDMInstance.removeDDFromGroup(this,n)},setDragElId:function(n){this.dragElId=n},setHandleElId:function(n){typeof n!="string"&&(n=Ext.id(n));this.handleElId=n;this.DDMInstance.regHandle(this.id,n)},setOuterHandleElId:function(n){typeof n!="string"&&(n=Ext.id(n));Ext.EventManager.on(n,"mousedown",this.handleMouseDown,this);this.setHandleElId(n);this.hasOuterHandles=!0},unreg:function(){Ext.EventManager.un(this.id,"mousedown",this.handleMouseDown,this);this._domRef=null;this.DDMInstance._remove(this)},destroy:function(){this.unreg()},isLocked:function(){return this.DDMInstance.isLocked()||this.locked},handleMouseDown:function(n){var t=this;if((!t.primaryButtonOnly||n.button==0)&&!t.isLocked()&&(t.DDMInstance.refreshCache(t.groups),(t.hasOuterHandles||t.DDMInstance.isOverTarget(n.getPoint(),t))&&t.clickValidator(n))){t.setStartPosition();t.b4MouseDown(n);t.onMouseDown(n);t.DDMInstance.handleMouseDown(n,t);t.DDMInstance.stopEvent(n)}},clickValidator:function(n){var t=n.getTarget();return this.isValidHandleChild(t)&&(this.id==this.handleElId||this.DDMInstance.handleWasClicked(t,this.id))},addInvalidHandleType:function(n){var t=n.toUpperCase();this.invalidHandleTypes[t]=t},addInvalidHandleId:function(n){typeof n!="string"&&(n=Ext.id(n));this.invalidHandleIds[n]=n},addInvalidHandleClass:function(n){this.invalidHandleClasses.push(n)},removeInvalidHandleType:function(n){var t=n.toUpperCase();delete this.invalidHandleTypes[t]},removeInvalidHandleId:function(n){typeof n!="string"&&(n=Ext.id(n));delete this.invalidHandleIds[n]},removeInvalidHandleClass:function(n){for(var t=0,i=this.invalidHandleClasses.length;t<i;++t)this.invalidHandleClasses[t]==n&&delete this.invalidHandleClasses[t]},isValidHandleChild:function(n){var t=!0,r,i,u;try{r=n.nodeName.toUpperCase()}catch(f){r=n.nodeName}for(t=t&&!this.invalidHandleTypes[r],t=t&&!this.invalidHandleIds[n.id],i=0,u=this.invalidHandleClasses.length;t&&i<u;++i)t=!Ext.fly(n).hasCls(this.invalidHandleClasses[i]);return t},setXTicks:function(n,t){this.xTicks=[];this.xTickSize=t;for(var r={},i=this.initPageX;i>=this.minX;i=i-t)r[i]||(this.xTicks[this.xTicks.length]=i,r[i]=!0);for(i=this.initPageX;i<=this.maxX;i=i+t)r[i]||(this.xTicks[this.xTicks.length]=i,r[i]=!0);Ext.Array.sort(this.xTicks,this.DDMInstance.numericSort)},setYTicks:function(n,t){this.yTicks=[];this.yTickSize=t;for(var r={},i=this.initPageY;i>=this.minY;i=i-t)r[i]||(this.yTicks[this.yTicks.length]=i,r[i]=!0);for(i=this.initPageY;i<=this.maxY;i=i+t)r[i]||(this.yTicks[this.yTicks.length]=i,r[i]=!0);Ext.Array.sort(this.yTicks,this.DDMInstance.numericSort)},setXConstraint:function(n,t,i){this.leftConstraint=n;this.rightConstraint=t;this.minX=this.initPageX-n;this.maxX=this.initPageX+t;i&&this.setXTicks(this.initPageX,i);this.constrainX=!0},clearConstraints:function(){this.constrainX=!1;this.constrainY=!1;this.clearTicks()},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0},setYConstraint:function(n,t,i){this.topConstraint=n;this.bottomConstraint=t;this.minY=this.initPageY-n;this.maxY=this.initPageY+t;i&&this.setYTicks(this.initPageY,i);this.constrainY=!0},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var n=this.maintainOffset?this.lastPageX-this.initPageX:0,t=this.maintainOffset?this.lastPageY-this.initPageY:0;this.setInitPosition(n,t)}else this.setInitPosition();this.constrainX&&this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize);this.constrainY&&this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)},getTick:function(n,t){if(t){if(t[0]>=n)return t[0];for(var r,f,e,i=0,u=t.length;i<u;++i)if(r=i+1,t[r]&&t[r]>=n)return f=n-t[i],e=t[r]-n,e>f?t[i]:t[r];return t[t.length-1]}return n},toString:function(){return"DragDrop "+this.id}})