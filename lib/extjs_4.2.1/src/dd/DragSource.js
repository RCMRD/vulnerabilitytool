Ext.define("Ext.dd.DragSource",{extend:"Ext.dd.DDProxy",requires:["Ext.dd.StatusProxy","Ext.dd.DragDropManager"],dropAllowed:Ext.baseCSSPrefix+"dd-drop-ok",dropNotAllowed:Ext.baseCSSPrefix+"dd-drop-nodrop",animRepair:!0,repairHighlightColor:"c3daf9",constructor:function(n,t){this.el=Ext.get(n);this.dragData||(this.dragData={});Ext.apply(this,t);this.proxy||(this.proxy=new Ext.dd.StatusProxy({id:this.el.id+"-drag-status-proxy",animRepair:this.animRepair}));this.callParent([this.el.dom,this.ddGroup||this.group,{dragElId:this.proxy.id,resizeFrame:!1,isTarget:!1,scroll:this.scroll===!0}]);this.dragging=!1},getDragData:function(){return this.dragData},onDragEnter:function(n,t){var i=Ext.dd.DragDropManager.getDDById(t),r;this.cachedTarget=i;this.beforeDragEnter(i,n,t)!==!1&&(i.isNotifyTarget?(r=i.notifyEnter(this,n,this.dragData),this.proxy.setStatus(r)):this.proxy.setStatus(this.dropAllowed),this.afterDragEnter&&this.afterDragEnter(i,n,t))},beforeDragEnter:function(){return!0},onDragOver:function(n,t){var i=this.cachedTarget||Ext.dd.DragDropManager.getDDById(t),r;this.beforeDragOver(i,n,t)!==!1&&(i.isNotifyTarget&&(r=i.notifyOver(this,n,this.dragData),this.proxy.setStatus(r)),this.afterDragOver&&this.afterDragOver(i,n,t))},beforeDragOver:function(){return!0},onDragOut:function(n,t){var i=this.cachedTarget||Ext.dd.DragDropManager.getDDById(t);this.beforeDragOut(i,n,t)!==!1&&(i.isNotifyTarget&&i.notifyOut(this,n,this.dragData),this.proxy.reset(),this.afterDragOut&&this.afterDragOut(i,n,t));this.cachedTarget=null},beforeDragOut:function(){return!0},onDragDrop:function(n,t){var i=this.cachedTarget||Ext.dd.DragDropManager.getDDById(t);if(this.beforeDragDrop(i,n,t)!==!1){if(i.isNotifyTarget)if(i.notifyDrop(this,n,this.dragData)!==!1)this.onValidDrop(i,n,t);else this.onInvalidDrop(i,n,t);else this.onValidDrop(i,n,t);this.afterDragDrop&&this.afterDragDrop(i,n,t)}delete this.cachedTarget},beforeDragDrop:function(){return!0},onValidDrop:function(n,t,i){this.hideProxy();this.afterValidDrop&&this.afterValidDrop(n,t,i)},getRepairXY:function(){return this.el.getXY()},onInvalidDrop:function(n,t,i){var r=this;t||(t=n,n=null,i=t.getTarget().id);r.beforeInvalidDrop(n,t,i)!==!1&&(r.cachedTarget&&(r.cachedTarget.isNotifyTarget&&r.cachedTarget.notifyOut(r,t,r.dragData),r.cacheTarget=null),r.proxy.repair(r.getRepairXY(t,r.dragData),r.afterRepair,r),r.afterInvalidDrop&&r.afterInvalidDrop(t,i))},afterRepair:function(){var n=this;Ext.enableFx&&n.el.highlight(n.repairHighlightColor);n.dragging=!1},beforeInvalidDrop:function(){return!0},handleMouseDown:function(n){if(!this.dragging){var t=this.getDragData(n);t&&this.onBeforeDrag(t,n)!==!1&&(this.dragData=t,this.proxy.stop(),this.callParent(arguments))}},onBeforeDrag:function(){return!0},onStartDrag:Ext.emptyFn,alignElWithMouse:function(){return this.proxy.ensureAttachedToBody(!0),this.callParent(arguments)},startDrag:function(n,t){this.proxy.reset();this.proxy.hidden=!1;this.dragging=!0;this.proxy.update("");this.onInitDrag(n,t);this.proxy.show()},onInitDrag:function(n,t){var i=this.el.dom.cloneNode(!0);i.id=Ext.id();this.proxy.update(i);this.onStartDrag(n,t);return!0},getProxy:function(){return this.proxy},hideProxy:function(){this.proxy.hide();this.proxy.reset(!0);this.dragging=!1},triggerCacheRefresh:function(){Ext.dd.DDM.refreshCache(this.groups)},b4EndDrag:function(){},endDrag:function(n){this.onEndDrag(this.dragData,n)},onEndDrag:function(){},autoOffset:function(){this.setDelta(-12,-20)},destroy:function(){this.callParent();Ext.destroy(this.proxy)}})