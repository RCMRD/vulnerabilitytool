Ext.define("Ext.window.Window",{extend:"Ext.panel.Panel",alternateClassName:"Ext.Window",requires:["Ext.util.ComponentDragger","Ext.util.Region","Ext.EventManager"],alias:"widget.window",baseCls:Ext.baseCSSPrefix+"window",resizable:!0,draggable:!0,constrain:!1,constrainHeader:!1,plain:!1,minimizable:!1,maximizable:!1,minHeight:50,minWidth:50,expandOnShow:!0,collapsible:!1,closable:!0,hidden:!0,autoRender:!0,hideMode:"offsets",floating:!0,itemCls:Ext.baseCSSPrefix+"window-item",initialAlphaNum:/^[a-z0-9]/,overlapHeader:!0,ignoreHeaderBorderManagement:!0,alwaysFramed:!0,isRootCfg:{isRoot:!0},isWindow:!0,initComponent:function(){var n=this;n.frame=!1;n.callParent();n.addEvents("resize","maximize","minimize","restore");n.plain&&n.addClsWithUI("plain");n.modal&&(n.ariaRole="dialog");n.addStateEvents(["maximize","restore","resize","dragend"])},getElConfig:function(){var t=this,n;return n=t.callParent(),n.tabIndex=-1,n},getState:function(){var n=this,t=n.callParent()||{},i=!!n.maximized,r=n.ghostBox,u;return t.maximized=i,u=i?n.restorePos:r?[r.x,r.y]:n.getPosition(),Ext.apply(t,{size:i?n.restoreSize:n.getSize(),pos:u}),t},applyState:function(n){var t=this;n&&(t.maximized=n.maximized,t.maximized?(t.hasSavedRestore=!0,t.restoreSize=n.size,t.restorePos=n.pos):Ext.apply(t,{width:n.size.width,height:n.size.height,x:n.pos[0],y:n.pos[1]}))},onRender:function(){var n=this;if(n.callParent(arguments),n.focusEl=n.el,n.maximizable)n.header.on({scope:n,dblclick:n.toggleMaximize})},afterRender:function(){var n=this,i=n.header,t;if(n.callParent(),n.maximized&&(n.maximized=!1,n.maximize(),i&&i.removeCls(i.indicateDragCls)),n.closable){t=n.getKeyMap();t.on(27,n.onEsc,n)}else t=n.keyMap;t&&n.hidden&&t.disable()},initDraggable:function(){this.initSimpleDraggable()},initResizable:function(){this.callParent(arguments);this.maximized&&this.resizer.disable()},onEsc:function(n,t){Ext.FocusManager&&Ext.FocusManager.enabled&&Ext.FocusManager.focusedCmp!==this||(t.stopEvent(),this.close())},beforeDestroy:function(){var n=this;n.rendered&&(delete this.animateTarget,n.hide(),Ext.destroy(n.keyMap));n.callParent()},addTools:function(){var n=this;n.callParent();n.minimizable&&n.addTool({type:"minimize",handler:Ext.Function.bind(n.minimize,n,[])});n.maximizable&&(n.addTool({type:"maximize",handler:Ext.Function.bind(n.maximize,n,[])}),n.addTool({type:"restore",handler:Ext.Function.bind(n.restore,n,[]),hidden:!0}))},getFocusEl:function(){return this.getDefaultFocus()},getDefaultFocus:function(){var n=this,i,t=n.defaultButton||n.defaultFocus,r;return t!==undefined&&(Ext.isNumber(t)?i=n.query("button")[t]:Ext.isString(t)?(r=t,r.match(n.initialAlphaNum)&&(i=n.down("#"+r)),i||(i=n.down(r))):t.focus&&(i=t)),i||n.el},onFocus:function(){var n=this,t;Ext.FocusManager&&Ext.FocusManager.enabled||(t=n.getDefaultFocus())===n?n.callParent(arguments):t.focus()},onShow:function(){var n=this;n.callParent(arguments);n.expandOnShow&&n.expand(!1);n.syncMonitorWindowResize();n.keyMap&&n.keyMap.enable()},doClose:function(){var n=this;n.hidden?(n.fireEvent("close",n),n.closeAction=="destroy"&&this.destroy()):n.hide(n.animateTarget,n.doClose,n)},afterHide:function(){var n=this;n.syncMonitorWindowResize();n.keyMap&&n.keyMap.disable();n.callParent(arguments)},onWindowResize:function(){var n=this,t;n.maximized?n.fitContainer():(t=n.getSizeModel(),(t.width.natural||t.height.natural)&&n.updateLayout(),n.doConstrain())},minimize:function(){return this.fireEvent("minimize",this),this},resumeHeaderLayout:function(n){this.header.resumeLayouts(n?this.isRootCfg:null)},afterCollapse:function(){var n=this,t=n.header,i=n.tools;t&&n.maximizable&&(t.suspendLayouts(),i.maximize.hide(),i.restore.hide(),this.resumeHeaderLayout(!0));n.resizer&&n.resizer.disable();n.callParent(arguments)},afterExpand:function(){var n=this,i=n.header,r=n.tools,t;i&&(i.suspendLayouts(),n.maximized?(r.restore.show(),t=!0):n.maximizable&&(r.maximize.show(),t=!0),this.resumeHeaderLayout(t));n.resizer&&n.resizer.enable();n.callParent(arguments)},maximize:function(n){var t=this,i=t.header,r=t.tools,u;return t.maximized||(t.expand(!1),t.hasSavedRestore||(t.restoreSize=t.getSize(),t.restorePos=t.getPosition(!0)),i&&(i.suspendLayouts(),r.maximize&&(r.maximize.hide(),u=!0),r.restore&&(r.restore.show(),u=!0),t.collapseTool&&(t.collapseTool.hide(),u=!0),t.resumeHeaderLayout(u)),t.maximized=!0,t.el.disableShadow(),t.dd&&(t.dd.disable(),i&&i.removeCls(i.indicateDragCls)),t.resizer&&t.resizer.disable(),t.el.addCls(Ext.baseCSSPrefix+"window-maximized"),t.container.addCls(Ext.baseCSSPrefix+"window-maximized-ct"),t.syncMonitorWindowResize(),t.fitContainer(n=n||!!t.animateTarget?{callback:function(){t.fireEvent("maximize",t)}}:null),n||t.fireEvent("maximize",t)),t},restore:function(n){var t=this,r=t.tools,i=t.header,f=t.restoreSize,u;return t.maximized&&(t.hasSavedRestore=null,t.removeCls(Ext.baseCSSPrefix+"window-maximized"),i&&(i.suspendLayouts(),r.restore&&(r.restore.hide(),u=!0),r.maximize&&(r.maximize.show(),u=!0),t.collapseTool&&(t.collapseTool.show(),u=!0),t.resumeHeaderLayout(u)),t.maximized=!1,f.x=t.restorePos[0],f.y=t.restorePos[1],t.setBox(f,n=n||!!t.animateTarget?{callback:function(){t.el.enableShadow(!0);t.fireEvent("restore",t)}}:null),t.restorePos=t.restoreSize=null,t.dd&&(t.dd.enable(),i&&i.addCls(i.indicateDragCls)),t.resizer&&t.resizer.enable(),t.container.removeCls(Ext.baseCSSPrefix+"window-maximized-ct"),t.syncMonitorWindowResize(),n||(t.el.enableShadow(!0),t.fireEvent("restore",t))),t},syncMonitorWindowResize:function(){var n=this,t=n._monitoringResize,i=n.monitorResize||n.constrain||n.constrainHeader||n.maximized,r=n.hidden||n.destroying||n.isDestroyed;if(i&&!r){if(!t){Ext.EventManager.onWindowResize(n.onWindowResize,n,{delay:1});n._monitoringResize=!0}}else t&&(Ext.EventManager.removeResizeListener(n.onWindowResize,n),n._monitoringResize=!1)},toggleMaximize:function(){return this[this.maximized?"restore":"maximize"]()}})