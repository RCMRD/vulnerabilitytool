Ext.define("Ext.picker.Month",{extend:"Ext.Component",requires:["Ext.XTemplate","Ext.util.ClickRepeater","Ext.Date","Ext.button.Button"],alias:"widget.monthpicker",alternateClassName:"Ext.MonthPicker",childEls:["bodyEl","prevEl","nextEl","buttonsEl","monthEl","yearEl"],renderTpl:['<div id="{id}-bodyEl" class="{baseCls}-body">','<div id="{id}-monthEl" class="{baseCls}-months">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" hidefocus="on" class="{parent.baseCls}-item-inner" href="#">{.}<\/a>',"<\/div>","<\/tpl>","<\/div>",'<div id="{id}-yearEl" class="{baseCls}-years">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" href="#" hidefocus="on" ><\/a>',"<\/div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" href="#" hidefocus="on" ><\/a>',"<\/div>","<\/div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" href="#">{.}<\/a>',"<\/div>","<\/tpl>","<\/div>",'<div class="'+Ext.baseCSSPrefix+'clear"><\/div>',"<\/div>",'<tpl if="showButtons">','<div id="{id}-buttonsEl" class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}<\/div>","<\/tpl>"],okText:"OK",cancelText:"Cancel",baseCls:Ext.baseCSSPrefix+"monthpicker",showButtons:!0,measureWidth:35,measureMaxHeight:20,smallCls:Ext.baseCSSPrefix+"monthpicker-small",totalYears:10,yearOffset:5,monthOffset:6,initComponent:function(){var n=this;n.selectedCls=n.baseCls+"-selected";n.addEvents("cancelclick","monthclick","monthdblclick","okclick","select","yearclick","yeardblclick");n.small&&n.addCls(n.smallCls);n.setValue(n.value);n.activeYear=n.getYear((new Date).getFullYear()-4,-4);n.showButtons&&(n.okBtn=new Ext.button.Button({text:n.okText,handler:n.onOkClick,scope:n}),n.cancelBtn=new Ext.button.Button({text:n.cancelText,handler:n.onCancelClick,scope:n}));this.callParent()},beforeRender:function(){var n=this,t=0,i=[],r=Ext.Date.getShortMonthName,u=n.monthOffset,f=n.monthMargin,e="";for(n.callParent();t<u;++t)i.push(r(t),r(t+u));Ext.isDefined(f)&&(e="margin: 0 "+f+"px;");Ext.apply(n.renderData,{months:i,years:n.getYears(),showButtons:n.showButtons,monthStyle:e})},afterRender:function(){var n=this,t=n.bodyEl,i=n.buttonsEl;n.callParent();n.mon(t,"click",n.onBodyClick,n);n.mon(t,"dblclick",n.onBodyClick,n);n.years=t.select("."+n.baseCls+"-year a");n.months=t.select("."+n.baseCls+"-month a");n.backRepeater=new Ext.util.ClickRepeater(n.prevEl,{handler:Ext.Function.bind(n.adjustYear,n,[-n.totalYears])});n.prevEl.addClsOnOver(n.baseCls+"-yearnav-prev-over");n.nextRepeater=new Ext.util.ClickRepeater(n.nextEl,{handler:Ext.Function.bind(n.adjustYear,n,[n.totalYears])});n.nextEl.addClsOnOver(n.baseCls+"-yearnav-next-over");n.updateBody();Ext.isDefined(n.monthMargin)||(Ext.picker.Month.prototype.monthMargin=n.calculateMonthMargin())},calculateMonthMargin:function(){for(var n=this,u=n.monthEl,i=n.months,r=i.first(),t=r.getMargin("l");t&&n.getLargest()>n.measureMaxHeight;)--t,i.setStyle("margin","0 "+t+"px");return t},getLargest:function(){var n=0;return this.months.each(function(t){var i=t.getHeight();i>n&&(n=i)}),n},setValue:function(n){var t=this,r=t.activeYear,u=t.monthOffset,i;return t.value=n?Ext.isDate(n)?[n.getMonth(),n.getFullYear()]:[n[0],n[1]]:[null,null],t.rendered&&(i=t.value[1],i!==null&&(i<r||i>r+t.yearOffset)&&(t.activeYear=i-t.yearOffset+1),t.updateBody()),t},getValue:function(){return this.value},hasSelection:function(){var n=this.value;return n[0]!==null&&n[1]!==null},getYears:function(){for(var t=this,i=t.yearOffset,r=t.activeYear,f=r+i,n=r,u=[];n<f;++n)u.push(n,n+i);return u},updateBody:function(){var n=this,o=n.years,s=n.months,l=n.getYears(),r=n.selectedCls,a=n.getYear(null),t=n.value[0],h=n.monthOffset,u,f,i,c,e;if(n.rendered){for(o.removeCls(r),s.removeCls(r),f=o.elements,c=f.length,i=0;i<c;i++)e=Ext.fly(f[i]),u=l[i],e.dom.innerHTML=u,u==a&&e.addCls(r);t!==null&&(t=t<h?t*2:(t-h)*2+1,s.item(t).addCls(r))}},getYear:function(n,t){var i=this.value[1];return t=t||0,i===null?n:i+t},onBodyClick:function(n,t){var i=this,r=n.type=="dblclick";if(n.getTarget("."+i.baseCls+"-month")){n.stopEvent();i.onMonthClick(t,r)}else if(n.getTarget("."+i.baseCls+"-year")){n.stopEvent();i.onYearClick(t,r)}},adjustYear:function(n){typeof n!="number"&&(n=this.totalYears);this.activeYear+=n;this.updateBody()},onOkClick:function(){this.fireEvent("okclick",this,this.value)},onCancelClick:function(){this.fireEvent("cancelclick",this)},onMonthClick:function(n,t){var i=this;i.value[0]=i.resolveOffset(i.months.indexOf(n),i.monthOffset);i.updateBody();i.fireEvent("month"+(t?"dbl":"")+"click",i,i.value);i.fireEvent("select",i,i.value)},onYearClick:function(n,t){var i=this;i.value[1]=i.activeYear+i.resolveOffset(i.years.indexOf(n),i.yearOffset);i.updateBody();i.fireEvent("year"+(t?"dbl":"")+"click",i,i.value);i.fireEvent("select",i,i.value)},resolveOffset:function(n,t){return n%2==0?n/2:t+Math.floor(n/2)},beforeDestroy:function(){var n=this;n.years=n.months=null;Ext.destroyMembers(n,"backRepeater","nextRepeater","okBtn","cancelBtn");n.callParent()},finishRenderChildren:function(){var n=this;this.callParent(arguments);this.showButtons&&(n.okBtn.finishRender(),n.cancelBtn.finishRender())},onDestroy:function(){Ext.destroyMembers(this,"okBtn","cancelBtn");this.callParent()}})