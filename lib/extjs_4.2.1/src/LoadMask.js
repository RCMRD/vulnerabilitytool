Ext.define("Ext.LoadMask",{extend:"Ext.Component",alias:"widget.loadmask",mixins:{floating:"Ext.util.Floating",bindable:"Ext.util.Bindable"},uses:["Ext.data.StoreManager"],msg:"Loading...",msgCls:Ext.baseCSSPrefix+"mask-loading",maskCls:Ext.baseCSSPrefix+"mask",useMsg:!0,useTargetEl:!1,baseCls:Ext.baseCSSPrefix+"mask-msg",childEls:["msgEl","msgTextEl"],renderTpl:['<div id="{id}-msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner{childElCls}">','<div id="{id}-msgTextEl" class="',Ext.baseCSSPrefix,"mask-msg-text",'{childElCls}"><\/div>',"<\/div>"],floating:{shadow:"frame"},focusOnToFront:!1,bringParentToFront:!1,constructor:function(n){var i=this,t;arguments.length===2?(Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("Ext.LoadMask: LoadMask now uses a standard 1 arg constructor: use the target config"),t=n,n=arguments[1]):t=n.target;t.isComponent||(Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("Ext.LoadMask: LoadMask for elements has been deprecated, use Ext.dom.Element.mask & Ext.dom.Element.unmask"),t=Ext.get(t),this.isElement=!0);i.ownerCt=t;this.isElement||i.bindComponent(t);i.callParent([n]);i.store&&i.bindStore(i.store,!0)},bindComponent:function(n){var t=this,i={scope:this,resize:t.sizeMask,added:t.onComponentAdded,removed:t.onComponentRemoved};if(n.floating)i.move=t.sizeMask,t.activeOwner=n;else if(n.ownerCt)t.onComponentAdded(n.ownerCt);else t.preventBringToFront=!0;t.mon(n,i);t.mon(t.hierarchyEventSource,{show:t.onContainerShow,hide:t.onContainerHide,expand:t.onContainerExpand,collapse:t.onContainerCollapse,scope:t})},onComponentAdded:function(n){var t=this;delete t.activeOwner;t.floatParent=n;n.floating||(n=n.up("[floating]"));n?(t.activeOwner=n,t.mon(n,"move",t.sizeMask,t)):t.preventBringToFront=!0;n=t.floatParent.ownerCt;t.rendered&&t.isVisible()&&n&&(t.floatOwner=n,t.mon(n,"afterlayout",t.sizeMask,t,{single:!0}))},onComponentRemoved:function(){var n=this,t=n.activeOwner,i=n.floatOwner;t&&n.mun(t,"move",n.sizeMask,n);i&&n.mun(i,"afterlayout",n.sizeMask,n);delete n.activeOwner;delete n.floatOwner},afterRender:function(){this.callParent(arguments);this.container=this.floatParent.getContentTarget()},onContainerShow:function(n){this.isActiveContainer(n)&&this.onComponentShow()},onContainerHide:function(n){this.isActiveContainer(n)&&this.onComponentHide()},onContainerExpand:function(n){this.isActiveContainer(n)&&this.onComponentShow()},onContainerCollapse:function(n){this.isActiveContainer(n)&&this.onComponentHide()},isActiveContainer:function(n){return this.isDescendantOf(n)},onComponentHide:function(){var n=this;n.rendered&&n.isVisible()&&(n.hide(),n.showNext=!0)},onComponentShow:function(){this.showNext&&this.show();delete this.showNext},sizeMask:function(){var n=this,t;n.rendered&&n.isVisible()&&(n.center(),t=n.getMaskTarget(),n.getMaskEl().show().setSize(t.getSize()).alignTo(t,"tl-tl"))},bindStore:function(n){var t=this;t.mixins.bindable.bindStore.apply(t,arguments);n=t.store;n&&n.isLoading()&&t.onBeforeLoad()},getStoreListeners:function(n){var i=this.onLoad,r=this.onBeforeLoad,t={cachemiss:r,cachefilled:i};return n.proxy.isSynchronous||(t.beforeLoad=r,t.load=i),t},onDisable:function(){this.callParent(arguments);this.loading&&this.onLoad()},getOwner:function(){return this.ownerCt||this.floatParent},getMaskTarget:function(){var n=this.getOwner();return this.useTargetEl?n.getTargetEl():n.getEl()},onBeforeLoad:function(){var n=this,t=n.getOwner(),i;n.disabled||(n.loading=!0,t.componentLayoutCounter?n.maybeShow():(i=t.afterComponentLayout,t.afterComponentLayout=function(){t.afterComponentLayout=i;i.apply(t,arguments);n.maybeShow()}))},maybeShow:function(){var n=this,t=n.getOwner();t.isVisible(!0)?n.loading&&t.rendered&&n.show():n.showNext=!0},getMaskEl:function(){var n=this;return n.maskEl||(n.maskEl=n.el.insertSibling({cls:n.maskCls,style:{zIndex:n.el.getStyle("zIndex")-2}},"before"))},onShow:function(){var n=this,t=n.msgEl;n.callParent(arguments);n.loading=!0;n.useMsg?(t.show(),n.msgTextEl.update(n.msg)):t.parent().hide()},hide:function(){if(this.isElement){this.ownerCt.unmask();this.fireEvent("hide",this);return}return delete this.showNext,this.callParent(arguments)},onHide:function(){this.callParent();this.getMaskEl().hide()},show:function(){if(this.isElement){this.ownerCt.mask(this.useMsg?this.msg:"",this.msgCls);this.fireEvent("show",this);return}return this.callParent(arguments)},afterShow:function(){this.callParent(arguments);this.sizeMask()},setZIndex:function(n){var t=this,i=t.activeOwner;return i&&(n=parseInt(i.el.getStyle("zIndex"),10)+1),t.getMaskEl().setStyle("zIndex",n-1),t.mixins.floating.setZIndex.apply(t,arguments)},onLoad:function(){this.loading=!1;this.hide()},onDestroy:function(){var n=this;n.isElement&&n.ownerCt.unmask();Ext.destroy(n.maskEl);n.callParent()}})