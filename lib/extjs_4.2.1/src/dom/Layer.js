Ext.define("Ext.dom.Layer",{extend:"Ext.Element",uses:["Ext.Shadow"],alternateClassName:"Ext.Layer",statics:{shims:[]},isLayer:!0,localXYNames:{get:"getLocalXY",set:"setLocalXY"},constructor:function(n,t){n=n||{};var i=this,o=Ext.DomHelper,r=n.parentEl,u=r?Ext.getDom(r):document.body,f=n.hideMode,e=Ext.baseCSSPrefix+(n.fixed&&!(Ext.isIE6||Ext.isIEQuirks)?"fixed-layer":"layer");i.el=i;t&&(i.dom=Ext.getDom(t));i.dom?(i.addCls(e),i.dom.parentNode||u.appendChild(i.dom)):i.dom=o.append(u,n.dh||{tag:"div",cls:e});n.preventSync&&(i.preventSync=!0);i.id=n.id?i.dom.id=n.id:Ext.id(i.dom);Ext.Element.addToCache(i);n.cls&&i.addCls(n.cls);i.constrain=n.constrain!==!1;f?(i.setVisibilityMode(Ext.Element[f.toUpperCase()]),i.visibilityMode==Ext.Element.ASCLASS&&(i.visibilityCls=n.visibilityCls)):n.useDisplay?i.setVisibilityMode(Ext.Element.DISPLAY):i.setVisibilityMode(Ext.Element.VISIBILITY);n.shadow?(i.shadowOffset=n.shadowOffset||4,i.shadow=new Ext.Shadow({offset:i.shadowOffset,mode:n.shadow,fixed:n.fixed}),i.disableShadow()):i.shadowOffset=0;i.useShim=n.shim!==!1&&Ext.useShims;n.hidden===!0?i.hide():i.show()},getZIndex:function(){return parseInt((this.getShim()||this).getStyle("z-index"),10)},getShim:function(){var n=this,t,i;return n.useShim?(n.shim||(t=n.self.shims.shift(),t||(t=n.createShim(),t.enableDisplayMode("block"),t.hide()),i=n.dom.parentNode,t.dom.parentNode!=i&&i.insertBefore(t.dom,n.dom),n.shim=t),n.shim):null},hideShim:function(){var n=this;n.shim&&(n.shim.setDisplayed(!1),n.self.shims.push(n.shim),delete n.shim)},disableShadow:function(){var n=this;n.shadow&&!n.shadowDisabled&&(n.shadowDisabled=!0,n.shadow.hide(),n.lastShadowOffset=n.shadowOffset,n.shadowOffset=0)},enableShadow:function(n){var t=this;t.shadow&&t.shadowDisabled&&(t.shadowDisabled=!1,t.shadowOffset=t.lastShadowOffset,delete t.lastShadowOffset,n&&t.sync(!0))},sync:function(n){var t=this,r=t.shadow,u,f,e,i,a,o,s,h,c,l;if(!t.preventSync)return!t.updating&&t.isVisible()&&(r||t.useShim)&&(i=t.getShim(),a=t[t.localXYNames.get](),o=a[0],s=a[1],h=t.dom.offsetWidth,c=t.dom.offsetHeight,r&&!t.shadowDisabled?(n&&!r.isVisible()?r.show(t):r.realign(o,s,h,c),i&&(l=i.getStyle("z-index"),l>t.zindex&&t.shim.setStyle("z-index",t.zindex-2),i.show(),r.isVisible()?(u=r.el.getXY(),f=i.dom.style,e=r.el.getSize(),Ext.supports.CSS3BoxShadow&&(e.height+=6,e.width+=4,u[0]-=2,u[1]-=4),f.left=u[0]+"px",f.top=u[1]+"px",f.width=e.width+"px",f.height=e.height+"px"):(i.setSize(h,c),i[t.localXYNames.set](o,s)))):i&&(l=i.getStyle("z-index"),l>t.zindex&&t.shim.setStyle("z-index",t.zindex-2),i.show(),i.setSize(h,c),i[t.localXYNames.set](o,s))),t},remove:function(){this.hideUnders();this.callParent()},beginUpdate:function(){this.updating=!0},endUpdate:function(){this.updating=!1;this.sync(!0)},hideUnders:function(){this.shadow&&this.shadow.hide();this.hideShim()},constrainXY:function(){if(this.constrain){var f=Ext.Element.getViewWidth(),e=Ext.Element.getViewHeight(),n=Ext.getDoc().getScroll(),o=this.getXY(),t=o[0],i=o[1],u=this.shadowOffset,s=this.dom.offsetWidth+u,h=this.dom.offsetHeight+u,r=!1;t+s>f+n.left&&(t=f-s-u,r=!0);i+h>e+n.top&&(i=e-h-u,r=!0);t<n.left&&(t=n.left,r=!0);i<n.top&&(i=n.top,r=!0);r&&(Ext.Layer.superclass.setXY.call(this,[t,i]),this.sync())}return this},getConstrainOffset:function(){return this.shadowOffset},setVisible:function(n,t,i,r,u){var f=this,e;return e=function(){n&&f.sync(!0);r&&r()},n||f.hideUnders(!0),f.callParent([n,t,i,r,u]),t||e(),f},beforeFx:function(){return this.beforeAction(),this.callParent(arguments)},afterFx:function(){this.callParent(arguments);this.sync(this.isVisible())},beforeAction:function(){!this.updating&&this.shadow&&this.shadow.hide()},setLeft:function(){return this.callParent(arguments),this.sync()},setTop:function(){return this.callParent(arguments),this.sync()},setLeftTop:function(){return this.callParent(arguments),this.sync()},setLocalX:function(){return this.callParent(arguments),this.sync()},setLocalXY:function(){return this.callParent(arguments),this.sync()},setLocalY:function(){return this.callParent(arguments),this.sync()},setXY:function(n,t,i,r,u){var f=this;return r=f.createCB(r),f.fixDisplay(),f.beforeAction(),f.callParent([n,t,i,r,u]),t||r(),f},createCB:function(n){var t=this,i=t.shadow&&t.shadow.isVisible();return function(){t.constrainXY();t.sync(i);n&&n()}},setX:function(n,t,i,r,u){return this.setXY([n,this.getY()],t,i,r,u),this},setY:function(n,t,i,r,u){return this.setXY([this.getX(),n],t,i,r,u),this},setSize:function(n,t,i,r,u,f){var e=this;return u=e.createCB(u),e.beforeAction(),e.callParent([n,t,i,r,u,f]),i||u(),e},setWidth:function(n,t,i,r,u){var f=this;return r=f.createCB(r),f.beforeAction(),f.callParent([n,t,i,r,u]),t||r(),f},setHeight:function(n,t,i,r,u){var f=this;return r=f.createCB(r),f.beforeAction(),f.callParent([n,t,i,r,u]),t||r(),f},setBounds:function(n,t,i,r,u,f,e,o){var s=this;return e=s.createCB(e),s.beforeAction(),u?s.callParent([n,t,i,r,u,f,e,o]):(Ext.Layer.superclass.setXY.call(s,[n,t]),Ext.Layer.superclass.setSize.call(s,i,r),e()),s},setZIndex:function(n){var t=this;return t.zindex=n,t.getShim()&&t.shim.setStyle("z-index",n++),t.shadow&&t.shadow.setZIndex(n++),t.setStyle("z-index",n)},onOpacitySet:function(n){var t=this.shadow;t&&t.setOpacity(n)}})