Ext.define("Ext.util.Floating",{uses:["Ext.Layer","Ext.window.Window"],focusOnToFront:!0,shadow:"sides",constrain:!1,constructor:function(n){var t=this;t.fixed=t.fixed&&!(Ext.isIE6||Ext.isIEQuirks);t.el=new Ext.dom.Layer(Ext.apply({preventSync:!0,hideMode:t.hideMode,hidden:t.hidden,shadow:typeof t.shadow!="undefined"?t.shadow:"sides",shadowOffset:t.shadowOffset,constrain:!1,fixed:t.fixed,shim:t.shim===!1?!1:undefined},t.floating),n);!t.modal||Ext.FocusManager&&Ext.FocusManager.enabled||t.mon(t.el,{keydown:t.onKeyDown,scope:t});t.mon(t.el,{mousedown:t.onMouseDown,scope:t});t.floating=!0;t.registerWithOwnerCt();t.initHierarchyEvents()},initHierarchyEvents:function(){var n=this,t=this.syncHidden;n.hasHierarchyEventListeners||(n.mon(n.hierarchyEventSource,{hide:t,collapse:t,show:t,expand:t,added:t,scope:n}),n.hasHierarchyEventListeners=!0)},registerWithOwnerCt:function(){var n=this,i=n.ownerCt,t=n.zIndexParent;t&&t.unregisterFloatingItem(n);t=n.zIndexParent=n.up("[floating]");n.setFloatParent(i||t);delete n.ownerCt;t?t.registerFloatingItem(n):Ext.WindowManager.register(n)},onKeyDown:function(n){var f=this,u,t,i,r;n.getKey()==Ext.EventObject.TAB&&(u=n.shiftKey,t=f.el.query(":focusable"),i=t[0],r=t[t.length-1],i&&r&&n.target===(u?i:r)&&(n.stopEvent(),(u?r:i).focus(!1,!0)))},onMouseDown:function(n){var t=this.focusTask;!this.floating||t&&t.id||this.toFront(!!n.getTarget(":focusable"))},setFloatParent:function(n){var t=this;t.floatParent=n;(t.constrain||t.constrainHeader)&&!t.constrainTo&&(t.constrainTo=n?n.getTargetEl():t.container)},syncShadow:function(){this.floating&&this.el.sync(!0)},onBeforeFloatLayout:function(){this.el.preventSync=!0},onAfterFloatLayout:function(){delete this.el.preventSync;this.syncShadow()},syncHidden:function(){var n=this,r=n.hidden||!n.rendered,i=n.hierarchicallyHidden=n.isHierarchicallyHidden(),t=n.pendingShow;r!==i&&(i?(n.hide(),n.pendingShow=!0):t&&(delete n.pendingShow,t.length?n.show.apply(n,t):n.show()))},setZIndex:function(n){var t=this;return t.el.setZIndex(n),n+=10,t.floatingDescendants&&(n=Math.floor(t.floatingDescendants.setBase(n)/100)*100+1e4),n},doConstrain:function(n){var t=this,i=t.calculateConstrainedPosition(n,null,!0);i&&t.setPosition(i)},toFront:function(n){var t=this,i=t.zIndexParent,r=t.preventFocusOnActivate;return i&&t.bringParentToFront!==!1&&i.toFront(!0),Ext.isDefined(n)||(n=!t.focusOnToFront),n&&(t.preventFocusOnActivate=!0),t.zIndexManager.bringToFront(t,n)&&(n||t.focus(!1,!0)),t.preventFocusOnActivate=r,t},setActive:function(n,t){var i=this;n?(i.el.shadow&&!i.maximized&&i.el.enableShadow(!0),i.preventFocusOnActivate||i.focus(!1,!0),i.fireEvent("activate",i)):(i.isWindow&&t&&t.isWindow&&i.hideShadowOnDeactivate&&i.el.disableShadow(),i.fireEvent("deactivate",i))},toBack:function(){return this.zIndexManager.sendToBack(this),this},center:function(){var n=this,t;return n.isVisible()?(t=n.getAlignToXY(n.container,"c-c"),n.setPagePosition(t)):n.needsCenter=!0,n},onFloatShow:function(){this.needsCenter&&this.center();delete this.needsCenter},fitContainer:function(n){var t=this,i=t.floatParent,r=i?i.getTargetEl():t.container,u=r.getViewSize(!1),f=i||r.dom!==document.body?[0,0]:r.getXY();u.x=f[0];u.y=f[1];t.setBox(u,n)}})