Ext.define("Ext.util.KeyMap",{alternateClassName:"Ext.KeyMap",eventName:"keydown",constructor:function(n){var t=this;if(arguments.length!==1||typeof n=="string"||n.dom||n.tagName||n===document||n.isComponent){t.legacyConstructor.apply(t,arguments);return}Ext.apply(t,n);t.bindings=[];t.target.isComponent||(t.target=Ext.get(t.target));t.binding?t.addBinding(t.binding):n.key&&t.addBinding(n);t.enable()},legacyConstructor:function(n,t,i){var r=this;Ext.apply(r,{target:Ext.get(n),eventName:i||r.eventName,bindings:[]});t&&r.addBinding(t);r.enable()},addBinding:function(n){var t=this,u=n.key,i,r;if(t.processing&&(t.bindings=bindings.slice(0)),Ext.isArray(n)){for(i=0,r=n.length;i<r;i++)t.addBinding(n[i]);return}t.bindings.push(Ext.apply({keyCode:t.processKeys(u)},n))},removeBinding:function(n){var i=this,u=i.bindings,e=u.length,r,t,f;for(i.processing&&(i.bindings=u.slice(0)),f=i.processKeys(n.key),r=0;r<e;++r)if(t=u[r],t.fn===n.fn&&t.scope===n.scope&&n.alt==t.alt&&n.crtl==t.crtl&&n.shift==t.shift&&Ext.Array.equals(t.keyCode,f)){Ext.Array.erase(i.bindings,r,1);return}},processKeys:function(n){var e=!1,r,u,f,i,t;if(Ext.isString(n)){for(u=[],f=n.toUpperCase(),t=0,i=f.length;t<i;++t)u.push(f.charCodeAt(t));n=u;e=!0}if(Ext.isArray(n)||(n=[n]),!e)for(t=0,i=n.length;t<i;++t)r=n[t],Ext.isString(r)&&(n[t]=r.toUpperCase().charCodeAt(0));return n},handleTargetEvent:function(){var n=/input|textarea/i;return function(t){var i=this,u,r,o,f,e;if(i.enabled){if(u=i.bindings,r=0,o=u.length,t=i.processEvent.apply(i||i.processEventScope,arguments),i.ignoreInputFields&&(f=t.target,e=f.contentEditable,n.test(f.tagName)||e===""||e==="true"))return;if(!t.getKey)return t;for(i.processing=!0;r<o;++r)i.processBinding(u[r],t);i.processing=!1}}}(),processEvent:Ext.identityFn,processBinding:function(n,t){if(this.checkModifiers(n,t))for(var r=t.getKey(),o=n.fn||n.handler,s=n.scope||this,u=n.keyCode,f=n.defaultEventAction,h=new Ext.EventObjectImpl(t),i=0,e=u.length;i<e;++i)if(r===u[i]){o.call(s,r,t)!==!0&&f&&h[f]();break}},checkModifiers:function(n,t){for(var f=["shift","ctrl","alt"],i=0,e=f.length,r,u;i<e;++i)if(u=f[i],r=n[u],!(r===undefined||r===t[u+"Key"]))return!1;return!0},on:function(n,t,i){var r,u,f,e;Ext.isObject(n)&&!Ext.isArray(n)?(r=n.key,u=n.shift,f=n.ctrl,e=n.alt):r=n;this.addBinding({key:r,shift:u,ctrl:f,alt:e,fn:t,scope:i})},un:function(n,t,i){var r,u,f,e;Ext.isObject(n)&&!Ext.isArray(n)?(r=n.key,u=n.shift,f=n.ctrl,e=n.alt):r=n;this.removeBinding({key:r,shift:u,ctrl:f,alt:e,fn:t,scope:i})},isEnabled:function(){return this.enabled},enable:function(){var n=this;if(!n.enabled){n.target.on(n.eventName,n.handleTargetEvent,n);n.enabled=!0}},disable:function(){var n=this;n.enabled&&(n.target.removeListener(n.eventName,n.handleTargetEvent,n),n.enabled=!1)},setDisabled:function(n){n?this.disable():this.enable()},destroy:function(n){var t=this,i=t.target;t.bindings=[];t.disable();n===!0&&(i.isComponent?i.destroy():i.remove());delete t.target}})