Ext.define("Ext.util.AbstractMixedCollection",{requires:["Ext.util.Filter"],mixins:{observable:"Ext.util.Observable"},isMixedCollection:!0,generation:0,indexGeneration:0,constructor:function(n,t){var i=this;arguments.length===1&&Ext.isObject(n)?(i.initialConfig=n,Ext.apply(i,n)):(i.allowFunctions=n===!0,t&&(i.getKey=t),i.initialConfig={allowFunctions:i.allowFunctions,getKey:i.getKey});i.items=[];i.map={};i.keys=[];i.indexMap={};i.length=0;i.mixins.observable.constructor.call(i)},allowFunctions:!1,add:function(n,t){var i=this.length;return arguments.length===1?this.insert(i,n):this.insert(i,n,t)},getKey:function(n){return n.id},replace:function(n,t){var i=this,r,u;return(arguments.length==1&&(t=arguments[0],n=i.getKey(t)),r=i.map[n],typeof n=="undefined"||n===null||typeof r=="undefined")?i.add(n,t):(i.generation++,u=i.indexOfKey(n),i.items[u]=t,i.map[n]=t,i.hasListeners.replace&&i.fireEvent("replace",n,r,t),t)},updateKey:function(n,t){var i=this,r=i.map,f=i.indexMap,u=i.indexOfKey(n),e;u>-1&&(e=r[n],delete r[n],delete f[n],r[t]=e,f[t]=u,i.keys[u]=t,i.generation++)},addAll:function(n){var i=this,t;if(arguments.length>1||Ext.isArray(n))i.insert(i.length,arguments.length>1?arguments:n);else for(t in n)n.hasOwnProperty(t)&&(i.allowFunctions||typeof n[t]!="function")&&i.add(t,n[t])},each:function(n,t){for(var u=Ext.Array.push([],this.items),i=0,f=u.length,r;i<f;i++)if(r=u[i],n.call(t||r,r,i,f)===!1)break},eachKey:function(n,t){for(var r=this.keys,f=this.items,i=0,u=r.length;i<u;i++)n.call(t||window,r[i],f[i],i,u)},findBy:function(n,t){for(var u=this.keys,r=this.items,i=0,f=r.length;i<f;i++)if(n.call(t||window,r[i],u[i]))return r[i];return null},find:function(){return Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("Ext.util.MixedCollection: find has been deprecated. Use findBy instead."),this.findBy.apply(this,arguments)},insert:function(n,t,i){var r;return Ext.isIterable(t)?r=this.doInsert(n,t,i):(r=arguments.length>2?this.doInsert(n,[t],[i]):this.doInsert(n,[t]),r=r[0]),r},doInsert:function(n,t,i){var u=this,f,s,r,e=t.length,h=e,y=u.hasListeners.add,c,o={},l,a,v;if(i!=null)u.useLinearSearch=!0;else for(i=t,t=new Array(e),r=0;r<e;r++)t[r]=this.getKey(i[r]);for(u.suspendEvents(),r=0;r<e;r++)f=t[r],s=u.indexOfKey(f),s!==-1&&(s<n&&n--,u.removeAt(s)),f!=null&&(o[f]!=null&&(l=!0,h--),o[f]=r);if(u.resumeEvents(),l){a=t;v=i;t=new Array(h);i=new Array(h);r=0;for(f in o)t[r]=a[o[f]],i[r]=v[o[f]],r++;e=h}for(c=n===u.length&&u.indexGeneration===u.generation,Ext.Array.insert(u.items,n,i),Ext.Array.insert(u.keys,n,t),u.length+=e,u.generation++,c&&(u.indexGeneration=u.generation),r=0;r<e;r++,n++)f=t[r],f!=null&&(u.map[f]=i[r],c&&(u.indexMap[f]=n)),y&&u.fireEvent("add",n,i[r],f);return i},remove:function(n){var t=this,r,i;return i=!t.useLinearSearch&&(r=t.getKey(n))?t.indexOfKey(r):Ext.Array.indexOf(t.items,n),i===-1?!1:t.removeAt(i)},removeAll:function(n){var t=this,i;if(n||t.hasListeners.remove)if(n)for(i=n.length-1;i>=0;--i)t.remove(n[i]);else while(t.length)t.removeAt(0);else t.length=t.items.length=t.keys.length=0,t.map={},t.indexMap={},t.generation++,t.indexGeneration=t.generation},removeAt:function(n){var t=this,r,i;return n<t.length&&n>=0?(t.length--,r=t.items[n],Ext.Array.erase(t.items,n,1),i=t.keys[n],typeof i!="undefined"&&delete t.map[i],Ext.Array.erase(t.keys,n,1),t.hasListeners.remove&&t.fireEvent("remove",r,i),t.generation++,r):!1},removeRange:function(n,t){var i=this,s,u,r,f,e,o;if(n<i.length&&n>=0){for(t||(t=1),f=Math.min(n+t,i.length),t=f-n,o=f===i.length,e=o&&i.indexGeneration===i.generation,r=n;r<f;r++)u=i.keys[r],u!=null&&(delete i.map[u],e&&delete i.indexMap[u]);return s=i.items[r-1],i.length-=t,i.generation++,e&&(i.indexGeneration=i.generation),o?i.items.length=i.keys.length=i.length:(i.items.splice(n,t),i.keys.splice(n,t)),s}return!1},removeAtKey:function(n){var i=this,r=i.keys,t;if(n==null)for(t=r.length-1;t>=0;t--)r[t]==null&&i.removeAt(t);else return i.removeAt(i.indexOfKey(n))},getCount:function(){return this.length},indexOf:function(n){var t=this,i;return n!=null?!t.useLinearSearch&&(i=t.getKey(n))?this.indexOfKey(i):Ext.Array.indexOf(t.items,n):-1},indexOfKey:function(n){return this.map.hasOwnProperty(n)?(this.indexGeneration!==this.generation&&this.rebuildIndexMap(),this.indexMap[n]):-1},rebuildIndexMap:function(){for(var t=this,r=t.indexMap={},i=t.keys,u=i.length,n=0;n<u;n++)r[i[n]]=n;t.indexGeneration=t.generation},get:function(n){var t=this,i=t.map[n],r=i!==undefined?i:typeof n=="number"?t.items[n]:undefined;return typeof r!="function"||t.allowFunctions?r:null},getAt:function(n){return this.items[n]},getByKey:function(n){return this.map[n]},contains:function(n){var t=this,i;return n!=null?!t.useLinearSearch&&(i=t.getKey(n))?this.map[i]!=null:Ext.Array.indexOf(this.items,n)!==-1:!1},containsKey:function(n){return this.map.hasOwnProperty(n)},clear:function(){var n=this;n.generation&&(n.length=0,n.items=[],n.keys=[],n.map={},n.indexMap={},n.generation++,n.indexGeneration=n.generation);n.hasListeners.clear&&n.fireEvent("clear")},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},sum:function(n,t,i,r){var f=this.extractValues(n,t),o=f.length,e=0,u;for(i=i||0,r=r||r===0?r:o-1,u=i;u<=r;u++)e+=f[u];return e},collect:function(n,t,i){for(var e=this.extractValues(n,t),h=e.length,o={},s=[],r,f,u=0;u<h;u++)r=e[u],f=String(r),!i&&Ext.isEmpty(r)||o[f]||(o[f]=!0,s.push(r));return s},extractValues:function(n,t){var i=this.items;return t&&(i=Ext.Array.pluck(i,t)),Ext.Array.pluck(i,n)},hasRange:function(n,t){return t<this.length},getRange:function(n,t){var o=this,u=o.items,i=[],r=u.length,f,e;return r<1?i:(n>t&&(e=!0,f=n,n=t,t=f),n<0&&(n=0),(t==null||t>=r)&&(t=r-1),i=u.slice(n,t+1),e&&i.length&&i.reverse(),i)},filter:function(n,t,i,r){var u=[];return Ext.isString(n)?u.push(new Ext.util.Filter({property:n,value:t,anyMatch:i,caseSensitive:r})):(Ext.isArray(n)||n instanceof Ext.util.Filter)&&(u=u.concat(n)),this.filterBy(Ext.util.Filter.createFilterFn(u))},filterBy:function(n,t){var r=this,u=new r.self(r.initialConfig),e=r.keys,f=r.items,o=f.length,i;for(u.getKey=r.getKey,i=0;i<o;i++)n.call(t||r,f[i],e[i])&&u.add(e[i],f[i]);return u},findIndex:function(n,t,i,r,u){return Ext.isEmpty(t,!1)?-1:(t=this.createValueMatcher(t,r,u),this.findIndexBy(function(i){return i&&t.test(i[n])},null,i))},findIndexBy:function(n,t,i){for(var u=this,e=u.keys,f=u.items,r=i||0,o=f.length;r<o;r++)if(n.call(t||u,f[r],e[r]))return r;return-1},createValueMatcher:function(n,t,i,r){if(!n.exec){var u=Ext.String.escapeRegex;n=String(n);t===!0?n=u(n):(n="^"+u(n),r===!0&&(n+="$"));n=new RegExp(n,i?"":"i")}return n},clone:function(){var n=this,t=new this.self(n.initialConfig);return t.add(n.keys,n.items),t}})