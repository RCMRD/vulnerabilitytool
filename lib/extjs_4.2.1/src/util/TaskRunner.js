Ext.define("Ext.util.TaskRunner",{interval:10,timerId:null,constructor:function(n){var t=this;typeof n=="number"?t.interval=n:n&&Ext.apply(t,n);t.tasks=[];t.timerFn=Ext.Function.bind(t.onTick,t)},newTask:function(n){var t=new Ext.util.TaskRunner.Task(n);return t.manager=this,t},start:function(n){var t=this,i=Ext.Date.now();return n.pending||(t.tasks.push(n),n.pending=!0),n.stopped=!1,n.taskStartTime=i,n.taskRunTime=n.fireOnStart!==!1?0:n.taskStartTime,n.taskRunCount=0,t.firing||(n.fireOnStart!==!1?t.startTimer(0,i):t.startTimer(n.interval,i)),n},stop:function(n){return n.stopped||(n.stopped=!0,n.onStop&&n.onStop.call(n.scope||n,n)),n},stopAll:function(){Ext.each(this.tasks,this.stop,this)},firing:!1,nextExpires:1e99,onTick:function(){var t=this,o=t.tasks,f=Ext.Date.now(),h=1e99,c=o.length,e,i,r,n,s,u;for(t.timerId=null,t.firing=!0,r=0;r<c||r<(c=o.length);++r){if(n=o[r],!(u=n.stopped)){if(e=n.taskRunTime+n.interval,e<=f){s=1;try{s=n.run.apply(n.scope||n,n.args||[++n.taskRunCount])}catch(l){try{Ext.log({msg:l,level:"error"});n.onError&&(s=n.onError.call(n.scope||n,n,l))}catch(a){}}n.taskRunTime=f;s===!1||n.taskRunCount===n.repeat?(t.stop(n),u=!0):(u=n.stopped,e=f+n.interval)}!u&&n.duration&&n.duration<=f-n.taskStartTime&&(t.stop(n),u=!0)}u?(n.pending=!1,i||(i=o.slice(0,r))):(i&&i.push(n),h>e&&(h=e))}i&&(t.tasks=i);t.firing=!1;t.tasks.length&&t.startTimer(h-f,Ext.Date.now());t.fireIdleEvent!==!1&&Ext.EventManager.idleEvent.fire()},startTimer:function(n,t){var i=this,u=t+n,r=i.timerId;r&&i.nextExpires-u>i.interval&&(clearTimeout(r),r=null);r||(n<i.interval&&(n=i.interval),i.timerId=setTimeout(i.timerFn,n),i.nextExpires=u)}},function(){var t=this,n=t.prototype;n.destroy=n.stopAll;Ext.util.TaskManager=Ext.TaskManager=new t;t.Task=new Ext.Class({isTask:!0,stopped:!0,fireOnStart:!1,constructor:function(n){Ext.apply(this,n)},restart:function(n){n!==undefined&&(this.interval=n);this.manager.start(this)},start:function(n){this.stopped&&this.restart(n)},stop:function(){this.manager.stop(this)}});n=t.Task.prototype;n.destroy=n.stop})