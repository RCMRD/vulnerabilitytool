Ext.define("Ext.data.reader.Reader",{requires:["Ext.data.ResultSet","Ext.XTemplate"],alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],mixins:{observable:"Ext.util.Observable"},totalProperty:"total",successProperty:"success",root:"",implicitIncludes:!0,readRecordsOnFailure:!0,isReader:!0,applyDefaults:!0,lastFieldGeneration:null,constructor:function(n){var t=this;t.mixins.observable.constructor.call(t,n);t.fieldCount=0;t.model=Ext.ModelManager.getModel(t.model);t.model&&t.model.prototype.fields&&t.buildExtractors();this.addEvents("exception")},setModel:function(n,t){var i=this;i.model=Ext.ModelManager.getModel(n);n&&i.buildExtractors(!0);t&&i.proxy&&i.proxy.setModel(i.model,!0)},read:function(n){var t;return n&&(t=n.responseText?this.getResponseData(n):this.readRecords(n)),t||this.nullResultSet},readRecords:function(n){var t=this,u,f,e,r,o,i,s;return t.lastFieldGeneration!==t.model.prototype.fields.generation&&t.buildExtractors(!0),t.rawData=n,n=t.getData(n),u=!0,f=0,e=[],t.successProperty&&(i=t.getSuccess(n),(i===!1||i==="false")&&(u=!1)),t.messageProperty&&(s=t.getMessage(n)),(t.readRecordsOnFailure||u)&&(r=Ext.isArray(n)?n:t.getRoot(n),r&&(o=r.length),t.totalProperty&&(i=parseInt(t.getTotal(n),10),isNaN(i)||(o=i)),r&&(e=t.extractData(r),f=e.length)),new Ext.data.ResultSet({total:o||f,count:f,records:e,success:u,message:s})},extractData:function(n){var r=this,s=r.model,f=n.length,e=new Array(f),o,t,u,i;for(!n.length&&Ext.isObject(n)&&(n=[n],f=1),i=0;i<f;i++)t=n[i],t.isModel?e[i]=t:(e[i]=u=new s(undefined,r.getId(t),t,o={}),u.phantom=!1,r.convertRecordData(o,t,u),r.implicitIncludes&&u.associations.length&&r.readAssociated(u,t));return e},readAssociated:function(n,t){for(var o=n.associations.items,u=0,s=o.length,i,f,e,r;u<s;u++)i=o[u],f=this.getAssociatedDataRoot(t,i.associationKeyFunction||i.associationKey||i.name),f&&(r=i.getReader(),r||(e=i.associatedModel.getProxy(),r=e?e.getReader():new this.constructor({model:i.associatedName})),i.read(n,r,f))},getAssociatedDataRoot:function(n,t){return Ext.isFunction(t)?t(n):n[t]},getFields:function(){return this.model.prototype.fields.items},getData:Ext.identityFn,getRoot:Ext.identityFn,getResponseData:function(){Ext.Error.raise("getResponseData must be implemented in the Ext.data.reader.Reader subclass")},onMetaChange:function(n){var t=this,u=n.fields||t.getFields(),i,r;t.metaData=n;t.root=n.root||t.root;t.idProperty=n.idProperty||t.idProperty;t.totalProperty=n.totalProperty||t.totalProperty;t.successProperty=n.successProperty||t.successProperty;t.messageProperty=n.messageProperty||t.messageProperty;r=n.clientIdProperty;t.model?(t.model.setFields(u,t.idProperty,r),t.setModel(t.model,!0)):(i=Ext.define("Ext.data.reader.Json-Model"+Ext.id(),{extend:"Ext.data.Model",fields:u,clientIdProperty:r}),t.idProperty&&(i.idProperty=t.idProperty),t.setModel(i,!0))},getIdProperty:function(){var t=this.model.prototype.idField,n=this.idProperty;return!n&&t&&(n=t.mapping)==null&&(n=t.name),n},buildExtractors:function(n){var t=this,i=t.getIdProperty(),r=t.totalProperty,u=t.successProperty,f=t.messageProperty,e;(n===!0&&delete t.convertRecordData,t.convertRecordData)||(r&&(t.getTotal=t.createAccessor(r)),u&&(t.getSuccess=t.createAccessor(u)),f&&(t.getMessage=t.createAccessor(f)),i?(e=t.createAccessor(i),t.getId=function(n){var i=e.call(t,n);return i===undefined||i===""?null:i}):t.getId=function(){return null},t.convertRecordData=t.buildRecordDataExtractor(),t.lastFieldGeneration=t.model.prototype.fields.generation)},recordDataExtractorTemplate:["var me = this\n","    ,fields = me.model.prototype.fields\n","    ,value\n","    ,internalId\n",'<tpl for="fields">','    ,__field{#} = fields.map["{name}"]\n',"<\/tpl>",";\n","return function(dest, source, record) {\n",'<tpl for="fields">','{% var fieldAccessExpression =  this.createFieldAccessExpression(values, "__field" + xindex, "source");',"   if (fieldAccessExpression) { %}",'    value = {[ this.createFieldAccessExpression(values, "__field" + xindex, "source") ]};\n','<tpl if="hasCustomConvert">','    dest["{name}"] = value === undefined ? __field{#}.convert(__field{#}.defaultValue, record) : __field{#}.convert(value, record);\n','<tpl elseif="defaultValue !== undefined">',"    if (value === undefined) {\n","        if (me.applyDefaults) {\n",'<tpl if="convert">','            dest["{name}"] = __field{#}.convert(__field{#}.defaultValue, record);\n',"<tpl else>",'            dest["{name}"] = __field{#}.defaultValue\n',"<\/tpl>","        };\n","    } else {\n",'<tpl if="convert">','        dest["{name}"] = __field{#}.convert(value, record);\n',"<tpl else>",'        dest["{name}"] = value;\n',"<\/tpl>","    };\n","<tpl else>","    if (value !== undefined) {\n",'<tpl if="convert">','        dest["{name}"] = __field{#}.convert(value, record);\n',"<tpl else>",'        dest["{name}"] = value;\n',"<\/tpl>","    }\n","<\/tpl>","{% } else { %}",'<tpl if="defaultValue !== undefined">','<tpl if="convert">','    dest["{name}"] = __field{#}.convert(__field{#}.defaultValue, record);\n',"<tpl else>",'    dest["{name}"] = __field{#}.defaultValue\n',"<\/tpl>","<\/tpl>","{% } %}","<\/tpl>",'<tpl if="clientIdProp">','    if (record && (internalId = {[ this.createFieldAccessExpression({mapping: values.clientIdProp}, null, "source") ]})) {\n','        record.{["internalId"]} = internalId;\n',"    }\n","<\/tpl>","};"],buildRecordDataExtractor:function(){var n=this,t=n.model.prototype,i={clientIdProp:t.clientIdProperty,fields:t.fields.items};return n.recordDataExtractorTemplate.createFieldAccessExpression=function(){return n.createFieldAccessExpression.apply(n,arguments)},Ext.functionFactory(n.recordDataExtractorTemplate.apply(i)).call(n)},destroyReader:function(){var n=this;delete n.proxy;delete n.model;delete n.convertRecordData;delete n.getId;delete n.getTotal;delete n.getSuccess;delete n.getMessage}},function(){var n=this.prototype;Ext.apply(n,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:!0,message:""}),recordDataExtractorTemplate:new Ext.XTemplate(n.recordDataExtractorTemplate)})})