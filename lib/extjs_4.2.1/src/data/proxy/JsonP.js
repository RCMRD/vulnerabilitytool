Ext.define("Ext.data.proxy.JsonP",{extend:"Ext.data.proxy.Server",alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],requires:["Ext.data.JsonP"],defaultWriterType:"base",callbackKey:"callback",recordParam:"records",autoAppendParams:!0,constructor:function(){this.addEvents("exception");this.callParent(arguments)},doRequest:function(n,t,i){var u=this,r=u.buildRequest(n),f=r.params;return Ext.apply(r,{callbackKey:u.callbackKey,timeout:u.timeout,scope:u,disableCaching:!1,callback:u.createRequestCallback(r,n,t,i)}),u.autoAppendParams&&(r.params={}),r.jsonp=Ext.data.JsonP.request(r),r.params=f,n.setStarted(),u.lastRequest=r,r},createRequestCallback:function(n,t,i,r){var u=this;return function(f,e){delete u.lastRequest;u.processResponse(f,t,n,e,i,r)}},setException:function(n){n.setException(n.request.jsonp.errorType)},buildUrl:function(n){var i=this,o=i.callParent(arguments),s=n.records,u=i.getWriter(),t,r,f,e;if(u&&n.operation.allowWrite()&&(n=u.write(n)),t=n.params,r=t.filters,delete t.filters,r&&r.length)for(e=0;e<r.length;e++)f=r[e],f.value&&(t[f.property]=f.value);return(!u||!u.encode)&&Ext.isArray(s)&&s.length>0&&(t[i.recordParam]=i.encodeRecords(s)),i.autoAppendParams&&(o=Ext.urlAppend(o,Ext.Object.toQueryString(t))),o},abort:function(){var n=this.lastRequest;n&&Ext.data.JsonP.abort(n.jsonp)},encodeRecords:function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(Ext.encode(n[t].getData()));return i}})