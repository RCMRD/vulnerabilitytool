Ext.define("Ext.data.AbstractStore",{requires:["Ext.util.MixedCollection","Ext.data.proxy.Proxy","Ext.data.Operation","Ext.util.Filter"],mixins:{observable:"Ext.util.Observable",sortable:"Ext.util.Sortable"},statics:{create:function(n){return n.isStore||(n.type||(n.type="store"),n=Ext.createByAlias("store."+n.type,n)),n}},onClassExtended:function(n,t,i){var r=t.model,u;typeof r=="string"&&(u=i.onBeforeCreated,i.onBeforeCreated=function(){var n=this,t=arguments;Ext.require(r,function(){u.apply(n,t)})})},remoteSort:!1,remoteFilter:!1,autoLoad:undefined,autoSync:!1,batchUpdateMode:"operation",filterOnLoad:!0,sortOnLoad:!0,implicitModel:!1,defaultProxyType:"memory",isDestroyed:!1,isStore:!0,sortRoot:"data",constructor:function(n){var t=this,u,i,r;if(Ext.apply(t,n),t.removed=[],t.mixins.observable.constructor.apply(t,arguments),i=t.model,t.model=Ext.ModelManager.getModel(t.model),Ext.applyIf(t,{modelDefaults:null}),!t.model&&t.fields&&(t.model=Ext.define("Ext.data.Store.ImplicitModel-"+(t.storeId||Ext.id()),{extend:"Ext.data.Model",fields:t.fields,proxy:t.proxy||t.defaultProxyType}),delete t.fields,t.implicitModel=!0),t.model||t.useModelWarning===!1||(r=[Ext.getClassName(t)||"Store"," created with no model."],typeof i=="string"&&r.push(" The name '",i,"'"," does not correspond to a valid model."),Ext.log.warn(r.join(""))),t.setProxy(t.proxy||t.model.getProxy()),!t.disableMetaChangeEvent)t.proxy.on("metachange",t.onMetaChange,t);t.id&&!t.storeId&&(t.storeId=t.id,delete t.id);t.storeId&&Ext.data.StoreManager.register(t);t.mixins.sortable.initSortable.call(t);u=t.decodeFilters(t.filters);t.filters=new Ext.util.MixedCollection;t.filters.addAll(u)},setProxy:function(n){var t=this;return n instanceof Ext.data.proxy.Proxy?n.setModel(t.model):(Ext.isString(n)&&(n={type:n}),Ext.applyIf(n,{model:t.model}),n=Ext.createByAlias("proxy."+n.type,n)),t.proxy=n,t.proxy},getProxy:function(){return this.proxy},onMetaChange:function(n,t){this.fireEvent("metachange",this,t)},create:function(n,t){var i=this,r=Ext.ModelManager.create(Ext.applyIf(n,i.modelDefaults),i.model.modelName),u;return t=t||{},Ext.applyIf(t,{action:"create",records:[r]}),u=new Ext.data.Operation(t),i.proxy.create(u,i.onProxyWrite,i),r},read:function(){return this.load.apply(this,arguments)},update:function(n){var t=this,i;return n=n||{},Ext.applyIf(n,{action:"update",records:t.getUpdatedRecords()}),i=new Ext.data.Operation(n),t.proxy.update(i,t.onProxyWrite,t)},onProxyWrite:function(n){var t=this,i=n.wasSuccessful(),r=n.getRecords();switch(n.action){case"create":t.onCreateRecords(r,n,i);break;case"update":t.onUpdateRecords(r,n,i);break;case"destroy":t.onDestroyRecords(r,n,i)}i&&(t.fireEvent("write",t,n),t.fireEvent("datachanged",t),t.fireEvent("refresh",t));Ext.callback(n.callback,n.scope||t,[r,n,i])},onCreateRecords:Ext.emptyFn,onUpdateRecords:Ext.emptyFn,onDestroyRecords:function(n,t,i){i&&(this.removed=[])},destroy:function(n){var t=this,i;return n=n||{},Ext.applyIf(n,{action:"destroy",records:t.getRemovedRecords()}),i=new Ext.data.Operation(n),t.proxy.destroy(i,t.onProxyWrite,t)},onBatchOperationComplete:function(n,t){return this.onProxyWrite(t)},onBatchComplete:function(n){var t=this,r=n.operations,u=r.length,i;for(t.suspendEvents(),i=0;i<u;i++)t.onProxyWrite(r[i]);t.resumeEvents();t.fireEvent("datachanged",t);t.fireEvent("refresh",t)},onBatchException:function(){},filterNew:function(n){return n.phantom===!0&&n.isValid()},getNewRecords:function(){return[]},getUpdatedRecords:function(){return[]},getModifiedRecords:function(){return[].concat(this.getNewRecords(),this.getUpdatedRecords())},filterUpdated:function(n){return n.dirty===!0&&n.phantom!==!0&&n.isValid()},getRemovedRecords:function(){return this.removed},filter:function(){},decodeFilters:function(n){Ext.isArray(n)||(n=n===undefined?[]:[n]);for(var u=n.length,r=Ext.util.Filter,t,i=0;i<u;i++)t=n[i],t instanceof r||(Ext.apply(t,{root:"data"}),t.fn&&(t.filterFn=t.fn),typeof t=="function"&&(t={filterFn:t}),n[i]=new r(t));return n},clearFilter:function(){},isFiltered:function(){},filterBy:function(){},sync:function(n){var t=this,i={},u=t.getNewRecords(),f=t.getUpdatedRecords(),e=t.getRemovedRecords(),r=!1;return u.length>0&&(i.create=u,r=!0),f.length>0&&(i.update=f,r=!0),e.length>0&&(i.destroy=e,r=!0),r&&t.fireEvent("beforesync",i)!==!1&&(n=n||{},t.proxy.batch(Ext.apply(n,{operations:i,listeners:t.getBatchListeners()}))),t},getBatchListeners:function(){var n=this,t={scope:n,exception:n.onBatchException};return n.batchUpdateMode=="operation"?t.operationcomplete=n.onBatchOperationComplete:t.complete=n.onBatchComplete,t},save:function(){return this.sync.apply(this,arguments)},load:function(n){var t=this,i;return n=Ext.apply({action:"read",filters:t.filters.items,sorters:t.getSorters()},n),t.lastOptions=n,i=new Ext.data.Operation(n),t.fireEvent("beforeload",t,i)!==!1&&(t.loading=!0,t.proxy.read(i,t.onProxyLoad,t)),t},reload:function(n){return this.load(Ext.apply(this.lastOptions,n))},afterEdit:function(n,t){var i=this,r,u;if(i.autoSync&&!i.autoSyncSuspended){for(r=t.length;r--;)if(n.fields.get(t[r]).persist){u=!0;break}u&&i.sync()}i.onUpdate(n,Ext.data.Model.EDIT,t);i.fireEvent("update",i,n,Ext.data.Model.EDIT,t)},afterReject:function(n){this.onUpdate(n,Ext.data.Model.REJECT,null);this.fireEvent("update",this,n,Ext.data.Model.REJECT,null)},afterCommit:function(n,t){t||(t=null);this.onUpdate(n,Ext.data.Model.COMMIT,t);this.fireEvent("update",this,n,Ext.data.Model.COMMIT,t)},onUpdate:Ext.emptyFn,onIdChanged:function(n,t,i,r){this.fireEvent("idchanged",this,n,t,i,r)},destroyStore:function(){var t,n=this;n.isDestroyed||(n.clearListeners(),n.storeId&&Ext.data.StoreManager.unregister(n),n.clearData(),n.data=n.tree=n.sorters=n.filters=n.groupers=null,n.reader&&n.reader.destroyReader(),n.proxy=n.reader=n.writer=null,n.isDestroyed=!0,n.implicitModel?(t=Ext.getClassName(n.model),Ext.undefine(t),Ext.ModelManager.unregisterType(t)):n.model=null)},getState:function(){var n=this,i,t,e=!!n.groupers,r=[],u=[],f=[];return e&&n.groupers.each(function(n){r[r.length]=n.serialize();i=!0}),n.sorters&&n.sorters.each(function(t){e&&!n.groupers.contains(t)&&(u[u.length]=t.serialize(),i=!0)}),n.filters&&n.statefulFilters&&n.filters.each(function(n){f[f.length]=n.serialize();i=!0}),i?(t={},r.length&&(t.groupers=r),u.length&&(t.sorters=u),f.length&&(t.filters=f),t):void 0},applyState:function(n){var t=this,i=!!t.sorters,r=!!t.groupers,u=!!t.filters,f;r&&n.groupers&&(t.groupers.clear(),t.groupers.addAll(t.decodeGroupers(n.groupers)));i&&n.sorters&&(t.sorters.clear(),t.sorters.addAll(t.decodeSorters(n.sorters)));u&&n.filters&&(t.filters.clear(),t.filters.addAll(t.decodeFilters(n.filters)));i&&r&&t.sorters.insert(0,t.groupers.getRange());t.autoLoad&&(t.remoteSort||t.remoteGroup||t.remoteFilter)&&(t.autoLoad===!0?t.reload():t.reload(t.autoLoad));u&&t.filters.length&&!t.remoteFilter&&(t.filter(),f=t.sortOnFilter);i&&t.sorters.length&&!t.remoteSort&&!f&&t.sort()},doSort:function(n){var t=this;t.remoteSort?t.load():(t.data.sortBy(n),t.fireEvent("datachanged",t),t.fireEvent("refresh",t));t.fireEvent("sort",t,t.sorters.getRange())},clearData:Ext.emptyFn,getCount:Ext.emptyFn,getById:Ext.emptyFn,removeAll:Ext.emptyFn,isLoading:function(){return!!this.loading},suspendAutoSync:function(){this.autoSyncSuspended=!0},resumeAutoSync:function(){this.autoSyncSuspended=!1}})