Ext.define("Ext.data.NodeStore",{extend:"Ext.data.Store",alias:"store.node",requires:["Ext.data.NodeInterface"],isNodeStore:!0,node:null,recursive:!1,rootVisible:!1,isExpandingOrCollapsing:0,constructor:function(n){var t=this,i;n=n||{};Ext.apply(t,n);Ext.isDefined(t.proxy)&&Ext.Error.raise("A NodeStore cannot be bound to a proxy. Instead bind it to a record decorated with the NodeInterface by setting the node config.");t.useModelWarning=!1;n.proxy={type:"proxy"};t.callParent([n]);i=t.node;i&&(t.node=null,t.setNode(i))},getTotalCount:function(){return this.getCount()},setNode:function(n){var t=this;if(t.node&&t.node!=n&&(t.mun(t.node,{expand:t.onNodeExpand,collapse:t.onNodeCollapse,append:t.onNodeAppend,insert:t.onNodeInsert,bulkremove:t.onBulkRemove,remove:t.onNodeRemove,sort:t.onNodeSort,scope:t}),t.node=null),n&&(Ext.data.NodeInterface.decorate(n.self),t.removeAll(),t.rootVisible?t.add(n):n.isExpanded()||t.treeStore.autoLoad===!1||n.expand(),t.mon(n,{expand:t.onNodeExpand,collapse:t.onNodeCollapse,append:t.onNodeAppend,insert:t.onNodeInsert,bulkremove:t.onBulkRemove,remove:t.onNodeRemove,sort:t.onNodeSort,scope:t}),t.node=n,n.isExpanded()&&n.isLoaded()))t.onNodeExpand(n,n.childNodes,!0)},onNodeSort:function(n,t){var i=this;if(i.indexOf(n)!==-1||n===i.node&&!i.rootVisible&&n.isExpanded()){Ext.suspendLayouts();i.onNodeCollapse(n,t,!0);i.onNodeExpand(n,t,!0);Ext.resumeLayouts(!0)}},onNodeExpand:function(n,t,i){var r=this,u=r.indexOf(n)+1,f=[];i||r.fireEvent("beforeexpand",n,t,u);r.handleNodeExpand(n,t,f);r.insert(u,f);i||r.fireEvent("expand",n,t)},handleNodeExpand:function(n,t,i){var u=this,e=t?t.length:0,f,r;if((u.recursive||n===u.node)&&(n===this.node||u.isVisible(n))&&e)for(f=0;f<e;f++)r=t[f],i.push(r),r.isExpanded()&&(r.isLoaded()?u.handleNodeExpand(r,r.childNodes,i):(r.set("expanded",!1),r.expand()))},onBulkRemove:function(n,t){this.onNodeCollapse(n,t,!0)},onNodeCollapse:function(n,t,i,r,u){var f=this,o=f.indexOf(n)+1,e,s,h,c;if(f.recursive||n===f.node){if(i||f.fireEvent("beforecollapse",n,t,o,r,u),t.length&&f.data.contains(t[0])){for(e=n;e.parentNode;)if(h=e.nextSibling,h){c=!0;s=f.indexOf(h);break}else e=e.parentNode;c||(s=f.getCount());f.removeAt(o,s-o)}i||f.fireEvent("collapse",n,t,o)}},onNodeAppend:function(n,t,i){var u=this,f,r;if(u.isVisible(t)){if(i===0)f=n;else{for(r=t.previousSibling;r.isExpanded()&&r.lastChild;)r=r.lastChild;f=r}if(u.insert(u.indexOf(f)+1,t),!t.isLeaf()&&t.isExpanded())if(t.isLoaded())u.onNodeExpand(t,t.childNodes,!0);else u.treeStore.fillCount||(t.set("expanded",!1),t.expand())}},onNodeInsert:function(n,t,i){var r=this,u=this.indexOf(i);if(u!=-1&&r.isVisible(t)&&(r.insert(u,t),!t.isLeaf()&&t.isExpanded()))if(t.isLoaded())r.onNodeExpand(t,t.childNodes,!0);else t.set("expanded",!1),t.expand()},onNodeRemove:function(n,t){var i=this;if(i.indexOf(t)!=-1){if(!t.isLeaf()&&t.isExpanded()){t.parentNode=t.removeContext.parentNode;t.nextSibling=t.removeContext.nextSibling;i.onNodeCollapse(t,t.childNodes,!0);t.parentNode=t.nextSibling=null}i.remove(t)}},isVisible:function(n){for(var t=n.parentNode;t;){if(t===this.node&&t.data.expanded)return!0;if(!t.data.expanded)return!1;t=t.parentNode}return!1}})