Ext.define("Ext.data.Store",{extend:"Ext.data.AbstractStore",alias:"store.store",requires:["Ext.data.StoreManager","Ext.data.Model","Ext.data.proxy.Ajax","Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Ext.data.PageMap","Ext.data.Group"],uses:["Ext.ModelManager","Ext.util.Grouper"],remoteSort:!1,remoteFilter:!1,remoteGroup:!1,groupField:undefined,groupDir:"ASC",trailingBufferZone:25,leadingBufferZone:200,pageSize:undefined,currentPage:1,clearOnPageLoad:!0,loading:!1,sortOnFilter:!0,buffered:!1,purgePageCount:5,clearRemovedOnLoad:!0,defaultPageSize:25,defaultViewSize:100,addRecordsOptions:{addRecords:!0},statics:{recordIdFn:function(n){return n.internalId},recordIndexFn:function(n){return n.index},grouperIdFn:function(n){return n.id||n.property},groupIdFn:function(n){return n.key}},constructor:function(n){n=Ext.apply({},n);var t=this,r=n.groupers||t.groupers,f=n.groupField||t.groupField,u,i;i=n.data||t.data;i&&(t.inlineData=i,delete n.data);!r&&f&&(r=[{property:f,direction:n.groupDir||t.groupDir}],(n.getGroupString||t.getGroupString!==Ext.data.Store.prototype.getGroupString)&&(r[0].getGroupString=function(n){return t.getGroupString(n)}));delete n.groupers;t.groupers=new Ext.util.MixedCollection(!1,Ext.data.Store.grouperIdFn);t.groupers.addAll(t.decodeGroupers(r));t.groups=new Ext.util.MixedCollection(!1,Ext.data.Store.groupIdFn);t.callParent([n]);t.buffered?(t.data=new Ext.data.PageMap({store:t,keyFn:Ext.data.Store.recordIdFn,pageSize:t.pageSize,maxSize:t.purgePageCount,listeners:{clear:t.onPageMapClear,scope:t}}),t.pageRequests={},t.remoteSort=t.remoteGroup=t.remoteFilter=!0,t.sortOnLoad=!1,t.filterOnLoad=!1):(t.data=new Ext.util.MixedCollection({getKey:Ext.data.Store.recordIdFn,maintainIndices:!0}),t.data.pageSize=t.pageSize);t.remoteGroup&&(t.remoteSort=!0);t.sorters.insert(0,t.groupers.getRange());u=t.proxy;i=t.inlineData;t.buffered||t.pageSize||(t.pageSize=t.defaultPageSize);i?(u instanceof Ext.data.proxy.Memory?(u.data=i,t.read()):t.add.apply(t,[i]),t.sorters.items.length&&!t.remoteSort&&t.group(null,null,!0),delete t.inlineData):t.autoLoad&&Ext.defer(t.load,1,t,[typeof t.autoLoad=="object"?t.autoLoad:undefined])},onBeforeSort:function(){var n=this.groupers;n.getCount()>0&&this.sort(n.items,"prepend",!1)},decodeGroupers:function(n){Ext.isArray(n)||(n=n===undefined?[]:[n]);for(var f=n.length,u=Ext.util.Grouper,t,r=[],i=0;i<f;i++)t=n[i],t instanceof u?r.push(t):(Ext.isString(t)&&(t={property:t}),t=Ext.apply({root:"data",direction:"ASC"},t),t.fn&&(t.sorterFn=t.fn),typeof t=="function"&&(t={sorterFn:t}),r.push(new u(t)));return r},group:function(n,t,i){var r=this,u,f;n&&(r.sorters.removeAll(r.groupers.items),Ext.isArray(n)?f=n:Ext.isObject(n)?f=[n]:Ext.isString(n)&&(u=r.groupers.get(n),u?t===undefined?u.toggle():u.setDirection(t):(u={property:n,direction:t||"ASC"},f=[u])),f&&f.length&&(r.groupers.clear(),r.groupers.addAll(r.decodeGroupers(f))),r.sorters.insert(0,r.groupers.items));r.remoteGroup?r.buffered?(r.data.clear(),r.loadPage(1,{groupChange:!0})):r.load({scope:r,callback:i?null:r.fireGroupChange}):(r.doSort(r.generateComparator()),r.constructGroups(),i||r.fireGroupChange())},getGroupField:function(){var n=this.groupers.first(),t;return n&&(t=n.property),t},constructGroups:function(){var t=this,e=this.data.items,o=e.length,u=t.groups,i,r,n,f;if(u.clear(),t.isGrouped())for(r=0;r<o;++r)f=e[r],i=t.getGroupString(f),n=u.get(i),n||(n=new Ext.data.Group({key:i,store:t}),u.add(i,n)),n.add(f)},clearGrouping:function(){for(var n=this,i=n.groupers.items,r=i.length,t=0;t<r;t++)n.sorters.remove(i[t]);n.groupers.clear();n.remoteGroup?n.buffered?(n.data.clear(),n.loadPage(1,{groupChange:!0})):n.load({scope:n,callback:n.fireGroupChange}):(n.groups.clear(),n.sorters.length?n.sort():(n.fireEvent("datachanged",n),n.fireEvent("refresh",n)),n.fireGroupChange())},isGrouped:function(){return this.groupers.getCount()>0},fireGroupChange:function(){this.fireEvent("groupchange",this,this.groupers)},getGroups:function(n){for(var e=this.data.items,s=e.length,o=[],u={},f,i,t,r=0;r<s;r++)f=e[r],i=this.getGroupString(f),t=u[i],t===undefined&&(t={name:i,children:[]},o.push(t),u[i]=t),t.children.push(f);return n?u[n]:o},getGroupsForGrouper:function(n,t){for(var s=n.length,e=[],o,i,u,f,r=0;r<s;r++)u=n[r],i=t.getGroupString(u),i!==o&&(f={name:i,grouper:t,records:[]},e.push(f)),f.records.push(u),o=i;return e},getGroupsForGrouperIndex:function(n,t){var u=this,f=u.groupers,o=f.getAt(t),r=u.getGroupsForGrouper(n,o),e=r.length,i;if(t+1<f.length)for(i=0;i<e;i++)r[i].children=u.getGroupsForGrouperIndex(r[i].records,t+1);for(i=0;i<e;i++)r[i].depth=t;return r},getGroupData:function(n){var t=this;return n!==!1&&t.sort(),t.getGroupsForGrouperIndex(t.data.items,0)},getGroupString:function(n){var t=this.groupers.first();return t?t.getGroupString(n):""},insert:function(n,t){var i=this,e=!1,f,o,r,s=i.modelDefaults,u;if(u=Ext.isIterable(t)?[]:t=[t],o=t.length,o){for(f=0;f<o;f++)r=t[f],r.isModel||(r=i.createModel(r)),u[f]=r,s&&r.set(s),r.join(i),e=e||r.phantom===!0;i.data.insert(n,u);i.snapshot&&i.snapshot.addAll(u);i.requireSort&&(i.suspendEvents(),i.sort(),i.resumeEvents());i.isGrouped()&&i.updateGroupsOnAdd(u);i.fireEvent("add",i,u,n);i.fireEvent("datachanged",i);i.autoSync&&e&&!i.autoSyncSuspended&&i.sync()}return u},updateGroupsOnAdd:function(n){for(var r=this,e=r.groups,o=n.length,u,i,f,t=0;t<o;++t)f=n[t],u=r.getGroupString(f),i=e.getByKey(u),i||(i=e.add(new Ext.data.Group({key:u,store:r}))),i.add(f)},updateGroupsOnRemove:function(n){for(var u=this,f=u.groups,o=n.length,e,t,r,i=0;i<o;++i)r=n[i],e=u.getGroupString(r),t=f.getByKey(e),t&&(t.remove(r),t.records.length===0&&f.remove(t))},updateGroupsOnUpdate:function(n,t){var i=this,h=i.getGroupField(),o=i.getGroupString(n),f=i.groups,e,r,s,u;if(t&&Ext.Array.indexOf(t,h)!==-1){for(i.buffered&&Ext.Error.raise({msg:"Cannot move records between groups in a buffered store record"}),s=f.items,r=0,e=s.length;r<e;++r)if(u=s[r],u.contains(n)){u.remove(n);break}for(u=f.getByKey(o),u||(u=f.add(new Ext.data.Group({key:o,store:i}))),u.add(n),i.data.remove(n),i.data.insert(i.data.findInsertionIndex(n,i.generateComparator()),n),r=0,e=this.getCount();r<e;r++)i.data.items[r].index=r}else f.getByKey(o).setDirty()},add:function(n){var t=this,i,u,r;return(t.buffered&&Ext.Error.raise({msg:"add method may not be called on a buffered store"}),i=Ext.isArray(n)?n:arguments,u=i.length,r=!t.remoteSort&&t.sorters&&t.sorters.items.length,r&&u===1)?[t.addSorted(t.createModel(i[0]))]:(r&&(t.requireSort=!0),i=t.insert(t.data.length,i),delete t.requireSort,i)},addSorted:function(n){var t=this,i=t.data.findInsertionIndex(n,t.generateComparator());return t.insert(i,n),n},createModel:function(n){return n.isModel||(n=Ext.ModelManager.create(n,this.model)),n},onUpdate:function(n,t,i){this.isGrouped()&&this.updateGroupsOnUpdate(n,i)},each:function(n,t){for(var u=this.data.items,f=u.length,r,i=0;i<f;i++)if(r=u[i],n.call(t||r,r,i,f)===!1)break},remove:function(n,t,i){t=t===!0;var u=this,l=!1,y=u.snapshot,c=u.data,f=0,o,s=[],p=[],w=[],a,v,e,r,h,b,k=!i&&u.hasListeners.remove;if(n.isModel?(n=[n],o=1):Ext.isIterable(n)?o=n.length:typeof n=="object"&&(h=!0,f=n.start,o=n.end+1,b=o-f),!h){for(f=0;f<o;++f)r=n[f],typeof r=="number"?(e=r,r=c.getAt(e)):e=u.indexOf(r),r&&e>-1&&s.push({record:r,index:e}),y&&y.remove(r);s=Ext.Array.sort(s,function(n,t){var i=n.index,r=t.index;return i===t.index2?0:i<r?-1:1});f=0;o=s.length}for(;f<o;f++)h?(r=c.getAt(f),e=f):(a=s[f],r=a.record,e=a.index),p.push(r),w.push(e),v=r.phantom!==!0,!t&&v&&(r.removedFrom=e,u.removed.push(r)),r.unjoin(u),e-=f,l=l||v,h||(c.removeAt(e),k&&u.fireEvent("remove",u,r,e,!!t));h&&c.removeRange(n.start,b);i||(u.fireEvent("bulkremove",u,p,w,!!t),u.fireEvent("datachanged",u));!t&&u.autoSync&&l&&!u.autoSyncSuspended&&u.sync()},removeAt:function(n,t){var i=this,r=i.getCount();n<=r&&(arguments.length===1?i.remove([n]):t&&i.remove({start:n,end:Math.min(n+t,r)-1}))},removeAll:function(n){var t=this,r=t.snapshot,i=t.data;r&&r.removeAll(i.getRange());t.buffered?i&&(n&&t.suspendEvent("clear"),i.clear(),n&&t.resumeEvent("clear")):(t.remove({start:0,end:t.getCount()-1},!1,n),n!==!0&&t.fireEvent("clear",t))},load:function(n){var t=this;return(n=n||{},typeof n=="function"&&(n={callback:n}),n.groupers=n.groupers||t.groupers.items,n.page=n.page||t.currentPage,n.start=n.start!==undefined?n.start:(n.page-1)*t.pageSize,n.limit=n.limit||t.pageSize,n.addRecords=n.addRecords||!1,t.buffered)?(n.limit=t.viewSize||t.defaultViewSize,t.loadToPrefetch(n)):t.callParent([n])},reload:function(n){var t=this,i,r,s,h,u,f,e,c,o=t.getCount();if(n||(n={}),t.buffered){if(delete t.totalCount,f=function(){t.rangeCached(i,r)&&(t.loading=!1,t.data.un("pageAdded",f),c=t.data.getRange(i,r),t.fireEvent("load",t,c,!0))},e=Math.ceil((t.leadingBufferZone+t.trailingBufferZone)/2),i=n.start||(o?t.getAt(0).index:0),r=i+(n.count||(o?o:t.pageSize))-1,s=t.getPageFromRecordIndex(Math.max(i-e,0)),h=t.getPageFromRecordIndex(r+e),t.data.clear(!0),t.fireEvent("beforeload",t,n)!==!1){t.loading=!0;t.data.on("pageAdded",f);for(u=s;u<=h;u++)t.prefetchPage(u,n)}}else return t.callParent(arguments)},onProxyLoad:function(n){var t=this,u=n.getResultSet(),i=n.getRecords(),r=n.wasSuccessful();t.isDestroyed||(u&&(t.totalCount=u.total),t.loading=!1,r&&t.loadRecords(i,n),t.hasListeners.load&&t.fireEvent("load",t,i,r),t.hasListeners.read&&t.fireEvent("read",t,i,r),Ext.callback(n.callback,n.scope||t,[i,n,r]))},getNewRecords:function(){return this.data.filterBy(this.filterNew).items},getUpdatedRecords:function(){return this.data.filterBy(this.filterUpdated).items},filter:function(n,t){Ext.isString(n)&&(n={property:n,value:t});for(var i=this,u=i.decodeFilters(n),f=i.sorters.length&&i.sortOnFilter&&!i.remoteSort,e=u.length,r=0;r<e;r++)i.filters.replace(u[r]);n=i.filters.items;n.length&&(i.remoteFilter?(delete i.totalCount,i.buffered?(i.data.clear(),i.loadPage(1)):(i.currentPage=1,i.load())):(i.snapshot=i.snapshot||i.data.clone(),i.data=i.snapshot.filter(n),i.constructGroups(),f?i.sort():(i.fireEvent("datachanged",i),i.fireEvent("refresh",i))),i.fireEvent("filterchange",i,n))},clearFilter:function(n){var t=this;if(t.filters.clear(),t.remoteFilter){if(n)return;delete t.totalCount;t.buffered?(t.data.clear(),t.loadPage(1)):(t.currentPage=1,t.load())}else t.isFiltered()&&(t.data=t.snapshot,delete t.snapshot,t.constructGroups(),n!==!0&&(t.fireEvent("datachanged",t),t.fireEvent("refresh",t)));t.fireEvent("filterchange",t,t.filters.items)},removeFilter:function(n,t){var i=this;!i.remoteFilter&&i.isFiltered()&&(n instanceof Ext.util.Filter?i.filters.remove(n):i.filters.removeAtKey(n),t!==!1?i.filters.length?i.filter():i.clearFilter():i.fireEvent("filterchange",i,i.filters.items))},addFilter:function(n,t){var i=this,u,r,f;for(u=i.decodeFilters(n),f=u.length,r=0;r<f;r++)i.filters.replace(u[r]);t!==!1&&i.filters.length?i.filter():i.fireEvent("filterchange",i,i.filters.items)},isFiltered:function(){var n=this.snapshot;return!!(n&&n!==this.data)},filterBy:function(n,t){var i=this;i.snapshot=i.snapshot||i.data.clone();i.data=i.queryBy(n,t||i);i.fireEvent("datachanged",i);i.fireEvent("refresh",i)},queryBy:function(n,t){var i=this;return(i.snapshot||i.data).filterBy(n,t||i)},query:function(n,t,i,r,u){var e=this,o=e.createFilterFn(n,t,i,r,u),f=e.queryBy(o);return f||(f=new Ext.util.MixedCollection),f},loadData:function(n,t){for(var u=n.length,r=[],i=0;i<u;i++)r.push(this.createModel(n[i]));this.loadRecords(r,t?this.addRecordsOptions:undefined)},loadRawData:function(n,t){var i=this,r=i.proxy.reader.read(n),u=r.records;r.success&&(i.totalCount=r.total,i.loadRecords(u,t?i.addRecordsOptions:undefined))},loadRecords:function(n,t){var i=this,r=0,f=n.length,u,e,o=i.snapshot;if(t&&(u=t.start,e=t.addRecords),e?o&&o.addAll(n):(delete i.snapshot,i.clearData(!0)),i.data.addAll(n),u!==undefined)for(;r<f;r++)n[r].index=u+r,n[r].join(i);else for(;r<f;r++)n[r].join(i);i.suspendEvents();i.filterOnLoad&&!i.remoteFilter&&i.filter();i.sortOnLoad&&!i.remoteSort&&i.sort(undefined,undefined,undefined,!0);i.resumeEvents();i.isGrouped()&&i.constructGroups();i.fireEvent("datachanged",i);i.fireEvent("refresh",i)},loadPage:function(n,t){var i=this;if(i.currentPage=n,t=Ext.apply({page:n,start:(n-1)*i.pageSize,limit:i.pageSize,addRecords:!i.clearOnPageLoad},t),i.buffered)return t.limit=i.viewSize||i.defaultViewSize,i.loadToPrefetch(t);i.read(t)},nextPage:function(n){this.loadPage(this.currentPage+1,n)},previousPage:function(n){this.loadPage(this.currentPage-1,n)},clearData:function(n){var t=this,i,r;if(!t.buffered&&t.data)for(i=t.data.items,r=i.length;r--;)i[r].unjoin(t);t.data&&t.data.clear();(n!==!0||t.clearRemovedOnLoad)&&(t.removed.length=0)},loadToPrefetch:function(n){var t=this,u,e,o,f=n,r=n.start,s=n.start+n.limit-1,i=Math.min(s,n.start+(t.viewSize||n.limit)-1),h=t.getPageFromRecordIndex(Math.max(r-t.trailingBufferZone,0)),c=t.getPageFromRecordIndex(s+t.leadingBufferZone),l=function(){t.rangeCached(r,i)&&(t.loading=!1,e=t.data.getRange(r,i),t.data.un("pageAdded",l),t.hasListeners.guaranteedrange&&t.guaranteeRange(r,i,n.callback,n.scope),n.callback&&n.callback.call(n.scope||t,e,r,s,n),t.fireEvent("datachanged",t),t.fireEvent("refresh",t),t.fireEvent("load",t,e,!0),n.groupChange&&t.fireGroupChange())};if(t.fireEvent("beforeload",t,n)!==!1){delete t.totalCount;t.loading=!0;n.callback&&(f=Ext.apply({},n),delete f.callback);t.on("prefetch",function(n,r,e){if(e)if(o=t.getTotalCount()){t.data.on("pageAdded",l);for(i=Math.min(i,o-1),c=t.getPageFromRecordIndex(Math.min(i+t.leadingBufferZone,o-1)),u=h+1;u<=c;++u)t.prefetchPage(u,f)}else t.fireEvent("datachanged",t),t.fireEvent("refresh",t),t.fireEvent("load",t,r,!0);else t.fireEvent("load",t,r,!1)},null,{single:!0});t.prefetchPage(h,f)}},prefetch:function(n){var t=this,i=t.pageSize,r,u;return i?(t.lastPageSize&&i!=t.lastPageSize&&Ext.Error.raise("pageSize cannot be dynamically altered"),t.data.pageSize||(t.data.pageSize=i)):t.pageSize=t.data.pageSize=i=n.limit,t.lastPageSize=i,n.page||(n.page=t.getPageFromRecordIndex(n.start),n.start=(n.page-1)*i,n.limit=Math.ceil(n.limit/i)*i),t.pageRequests[n.page]||(n=Ext.apply({action:"read",filters:t.filters.items,sorters:t.sorters.items,groupers:t.groupers.items,pageMapGeneration:t.data.pageMapGeneration},n),u=new Ext.data.Operation(n),t.fireEvent("beforeprefetch",t,u)!==!1&&(r=t.proxy,t.pageRequests[n.page]=r.read(u,t.onProxyPrefetch,t),r.isSynchronous&&delete t.pageRequests[n.page])),t},onPageMapClear:function(){var n=this,u=n.wasLoading,t=n.pageRequests,r,i;n.data.events.pageadded&&n.data.events.pageadded.clearListeners();n.loading=!0;n.totalCount=0;for(i in t)t.hasOwnProperty(i)&&(r=t[i],delete t[i],delete r.callback);n.fireEvent("clear",n);n.loading=u},prefetchPage:function(n,t){var i=this,u=i.pageSize||i.defaultPageSize,f=(n-1)*i.pageSize,r=i.totalCount;(r===undefined||i.getCount()!==r)&&i.prefetch(Ext.applyIf({page:n,start:f,limit:u},t))},onProxyPrefetch:function(n){var t=this,u=n.getResultSet(),i=n.getRecords(),r=n.wasSuccessful(),f=n.page;n.pageMapGeneration===t.data.pageMapGeneration&&(u&&(t.totalCount=u.total,t.fireEvent("totalcountchange",t.totalCount)),f!==undefined&&delete t.pageRequests[f],t.loading=!1,t.fireEvent("prefetch",t,i,r,n),r&&t.cachePage(i,n.page),Ext.callback(n.callback,n.scope||t,[i,n,r]))},cachePage:function(n,t){var i=this,u=n.length,r;for(Ext.isDefined(i.totalCount)||(i.totalCount=n.length,i.fireEvent("totalcountchange",i.totalCount)),r=0;r<u;r++)n[r].join(i);i.data.addPage(t,n)},rangeCached:function(n,t){return this.data&&this.data.hasRange(n,t)},pageCached:function(n){return this.data&&this.data.hasPage(n)},pagePending:function(n){return!!this.pageRequests[n]},rangeSatisfied:function(n,t){return this.rangeCached(n,t)},getPageFromRecordIndex:function(n){return Math.floor(n/this.pageSize)+1},onGuaranteedRange:function(n){var r=this,f=r.getTotalCount(),i=n.prefetchStart,t=n.prefetchEnd>f-1?f-1:n.prefetchEnd,u;t=Math.max(0,t);i>t&&Ext.log({level:"warn",msg:"Start ("+i+") was greater than end ("+t+") for the range of records requested ("+i+"-"+n.prefetchEnd+")"+(this.storeId?' from store "'+this.storeId+'"':"")});u=r.data.getRange(i,t);n.fireEvent!==!1&&r.fireEvent("guaranteedrange",u,i,t,n);n.callback&&n.callback.call(n.scope||r,u,i,t,n)},guaranteeRange:function(n,t,i,r,u){u=Ext.apply({callback:i,scope:r},u);this.getRange(n,t,u)},prefetchRange:function(n,t){var i=this,u,f,r;if(!i.rangeCached(n,t))for(u=i.getPageFromRecordIndex(n),f=i.getPageFromRecordIndex(t),i.data.maxSize=i.purgePageCount?f-u+1+i.purgePageCount:0,r=u;r<=f;r++)i.pageCached(r)||i.prefetchPage(r)},primeCache:function(n,t,i){var r=this;i===-1?(n=Math.max(n-r.leadingBufferZone,0),t=Math.min(t+r.trailingBufferZone,r.totalCount-1)):i===1?(n=Math.max(Math.min(n-r.trailingBufferZone,r.totalCount-r.pageSize),0),t=Math.min(t+r.leadingBufferZone,r.totalCount-1)):(n=Math.min(Math.max(Math.floor(n-(r.leadingBufferZone+r.trailingBufferZone)/2),0),r.totalCount-r.pageSize),t=Math.min(Math.max(Math.ceil(t+(r.leadingBufferZone+r.trailingBufferZone)/2),0),r.totalCount-1));r.prefetchRange(n,t)},sort:function(){var n=this;return n.buffered&&n.remoteSort&&n.data.clear(),n.callParent(arguments)},doSort:function(n){var t=this,r,u,i;if(t.remoteSort)t.buffered?(t.data.clear(),t.loadPage(1)):t.load();else{if(t.buffered&&Ext.Error.raise({msg:"Local sorting may not be used on a buffered store"}),t.data.sortBy(n),!t.buffered)for(r=t.getRange(),u=r.length,i=0;i<u;i++)r[i].index=i;t.fireEvent("datachanged",t);t.fireEvent("refresh",t)}},find:function(n,t,i,r,u,f){var e=this.createFilterFn(n,t,r,u,f);return e?this.data.findIndexBy(e,null,i):-1},findRecord:function(){var n=this,t=n.find.apply(n,arguments);return t!==-1?n.getAt(t):null},createFilterFn:function(n,t,i,r,u){return Ext.isEmpty(t)?!1:(t=this.data.createValueMatcher(t,i,r,u),function(i){return t.test(i.data[n])})},findExact:function(n,t,i){return this.data.findIndexBy(function(i){return i.isEqual(i.get(n),t)},this,i)},findBy:function(n,t,i){return this.data.findIndexBy(n,t,i)},collect:function(n,t,i){var r=this,u=i===!0&&r.snapshot?r.snapshot:r.data;return u.collect(n,"data",t)},getCount:function(){return this.data.getCount()},getTotalCount:function(){return this.totalCount||0},getAt:function(n){return this.data.getAt(n)},getRange:function(n,t,i){i&&i.cb&&(i.callback=i.cb,Ext.Error.raise({msg:"guaranteeRange options.cb is deprecated, use options.callback"}));var r=this,f,e,s=r.totalCount-1,h=r.lastRequestStart,o,u;if(i=Ext.apply({prefetchStart:n,prefetchEnd:t},i),r.buffered){if(t=t>=r.totalCount?s:t,f=n===0?0:n-1,e=t===s?t:t+1,r.lastRequestStart=n,r.rangeCached(f,e)){r.onGuaranteedRange(i);u=r.data.getRange(n,t)}else{r.fireEvent("cachemiss",r,n,t);o=function(){if(r.rangeCached(f,e)){r.fireEvent("cachefilled",r,n,t);r.data.un("pageAdded",o);r.onGuaranteedRange(i)}};r.data.on("pageAdded",o);r.prefetchRange(n,t)}r.primeCache(n,t,n<h?-1:1)}else u=r.data.getRange(n,t),i.callback&&i.callback.call(i.scope||r,u,n,t,i);return u},getById:function(n){var t=(this.snapshot||this.data).findBy(function(t){return t.getId()===n});return this.buffered&&!t&&Ext.Error.raise("getById called for ID that is not present in local cache"),t},indexOf:function(n){return this.data.indexOf(n)},indexOfTotal:function(n){var t=n.index;return t||t===0?t:this.indexOf(n)},indexOfId:function(n){return this.indexOf(this.getById(n))},first:function(n){var t=this;return n&&t.isGrouped()?t.aggregate(function(n){return n.length?n[0]:undefined},t,!0):t.data.first()},last:function(n){var t=this;return n&&t.isGrouped()?t.aggregate(function(n){var t=n.length;return t?n[t-1]:undefined},t,!0):t.data.last()},sum:function(n,t){var i=this;return t&&i.isGrouped()?i.aggregate(i.getSum,i,!0,[n]):i.getSum(i.data.items,n)},getSum:function(n,t){for(var r=0,i=0,u=n.length;i<u;++i)r+=n[i].get(t);return r},count:function(n){var t=this;return n&&t.isGrouped()?t.aggregate(function(n){return n.length},t,!0):t.getCount()},min:function(n,t){var i=this;return t&&i.isGrouped()?i.aggregate(i.getMin,i,!0,[n]):i.getMin(i.data.items,n)},getMin:function(n,t){var r=1,f=n.length,u,i;for(f>0&&(i=n[0].get(t));r<f;++r)u=n[r].get(t),u<i&&(i=u);return i},max:function(n,t){var i=this;return t&&i.isGrouped()?i.aggregate(i.getMax,i,!0,[n]):i.getMax(i.data.items,n)},getMax:function(n,t){var r=1,f=n.length,u,i;for(f>0&&(i=n[0].get(t));r<f;++r)u=n[r].get(t),u>i&&(i=u);return i},average:function(n,t){var i=this;return t&&i.isGrouped()?i.aggregate(i.getAverage,i,!0,[n]):i.getAverage(i.data.items,n)},getAverage:function(n,t){var i=0,r=n.length,u=0;if(n.length>0){for(;i<r;++i)u+=n[i].get(t);return u/r}return 0},aggregate:function(n,t,i,r){if(r=r||[],i&&this.isGrouped()){for(var e=this.getGroups(),s=e.length,o={},f,u=0;u<s;++u)f=e[u],o[f.name]=this.getAggregate(n,t||this,f.children,r);return o}return this.getAggregate(n,t,this.data.items,r)},getAggregate:function(n,t,i,r){return r=r||[],n.apply(t||this,[i].concat(r))},onIdChanged:function(n,t,i,r){var u=this.snapshot;u&&u.updateKey(r,i);this.data.updateKey(r,i);this.callParent(arguments)},commitChanges:function(){for(var t=this,i=t.getModifiedRecords(),r=i.length,n=0;n<r;n++)i[n].commit();t.removed.length=0},filterNewOnly:function(n){return n.phantom===!0},getRejectRecords:function(){return Ext.Array.push(this.data.filterBy(this.filterNewOnly).items,this.getUpdatedRecords())},rejectChanges:function(){for(var i=this,r=i.getRejectRecords(),u=r.length,t=0,n;t<u;t++)n=r[t],n.reject(),n.phantom&&i.remove(n);for(r=i.removed,u=r.length,t=0;t<u;t++)n=r[t],i.insert(n.removedFrom||0,n),n.reject();i.removed.length=0}},function(){Ext.regStore("ext-empty-store",{fields:[],proxy:"memory"})})