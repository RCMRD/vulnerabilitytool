Ext.define("Ext.data.Model",{alternateClassName:"Ext.data.Record",mixins:{observable:"Ext.util.Observable"},requires:["Ext.ModelManager","Ext.data.IdGenerator","Ext.data.Field","Ext.data.Errors","Ext.data.Operation","Ext.data.validations","Ext.util.MixedCollection"],compareConvertFields:function(n,t){var i=n.convert&&n.type&&n.convert!==n.type.convert,r=t.convert&&t.type&&t.convert!==t.type.convert;return i&&!r?1:!i&&r?-1:0},itemNameFn:function(n){return n.name},onClassExtended:function(n,t,i){var r=i.onBeforeCreated;i.onBeforeCreated=function(n,t){var ot=this,a=Ext.getClassName(n),e=n.prototype,b=n.prototype.superclass,k=t.validations||[],v=t.fields||[],y,o=t.associations||[],d=function(n,t){var r=0,u,i;if(n)for(n=Ext.Array.from(n),u=n.length;r<u;++r)i=n[r],Ext.isObject(i)||(i={model:i}),i.type=t,o.push(i)},nt=t.idgen,s=new Ext.util.MixedCollection(!1,e.itemNameFn),tt=new Ext.util.MixedCollection(!1,e.itemNameFn),it=b.validations,rt=b.fields,ut=b.associations,f,u,l,p=[],w="idProperty"in t?t.idProperty:e.idProperty,h=w?w.isField?w:new Ext.data.Field(w):null,ft=!1,et=function(n,t,i){var r,u;s.events.add.firing?(u=n,r=t):(r=i,u=t.originalIndex);r.originalIndex=u;h&&(r.mapping&&r.mapping===h.mapping||r.name===h.name)&&(e.idField=r,ft=!0,r.defaultValue=undefined)},c=t.proxy,g=function(){s.sortBy(e.compareConvertFields)};n.modelName=a;e.modelName=a;it&&(k=it.concat(k));t.validations=k;rt&&(v=rt.items.concat(v));s.on({add:et,replace:et});for(u=0,l=v.length;u<l;++u)y=v[u],s.add(y.isField?y:new Ext.data.Field(y));h&&!ft&&(e.idField=h,h.defaultValue=undefined,s.add(h));g();s.on({add:g,replace:g});for(t.fields=s,nt&&(t.idgen=Ext.data.IdGenerator.get(nt)),d(t.belongsTo,"belongsTo"),delete t.belongsTo,d(t.hasMany,"hasMany"),delete t.hasMany,d(t.hasOne,"hasOne"),delete t.hasOne,ut&&(o=ut.items.concat(o)),u=0,l=o.length;u<l;++u)p.push("association."+o[u].type.toLowerCase());c?c.isProxy||p.push("proxy."+(c.type||c)):n.prototype.proxy||(n.prototype.proxy=n.prototype.defaultProxyType,p.push("proxy."+n.prototype.defaultProxyType));Ext.require(p,function(){for(Ext.ModelManager.registerType(a,n),u=0,l=o.length;u<l;++u)f=o[u],f.isAssociation?f=Ext.applyIf({ownerModel:a,associatedModel:f.model},f.initialConfig):Ext.apply(f,{ownerModel:a,associatedModel:f.model}),Ext.ModelManager.getModel(f.model)===undefined?Ext.ModelManager.registerDeferredAssociation(f):tt.add(Ext.data.association.Association.create(f));t.associations=tt;r.call(ot,n,t,i);c&&c.isProxy&&n.setProxy(c);Ext.ModelManager.onModelDefined(n)})}},inheritableStatics:{setProxy:function(n){return n.isProxy||(typeof n=="string"&&(n={type:n}),n=Ext.createByAlias("proxy."+n.type,n)),n.setModel(this),this.proxy=this.prototype.proxy=n,n},getProxy:function(){var n=this.proxy;return n?n:(n=this.prototype.proxy,n.isProxy&&(n=n.clone()),this.setProxy(n))},setFields:function(n,t,i){var s=this,f,r,h=!1,e=s.prototype,u=e.fields,c=e.superclass.fields,l,o;for(t&&(e.idProperty=t,r=t.isField?t:new Ext.data.Field(t)),i&&(e.clientIdProperty=i),u?u.clear():u=s.prototype.fields=new Ext.util.MixedCollection(!1,function(n){return n.name}),c&&(n=c.items.concat(n)),o=0,l=n.length;o<l;o++)f=new Ext.data.Field(n[o]),r&&(f.mapping&&f.mapping===r.mapping||f.name===r.name)&&(h=!0,f.defaultValue=undefined),u.add(f);return r&&!h&&(r.defaultValue=undefined,u.add(r)),s.fields=u,u},getFields:function(){return this.prototype.fields.items},load:function(n,t){t=Ext.apply({},t);t=Ext.applyIf(t,{action:"read",id:n});var u=new Ext.data.Operation(t),i=t.scope||this,r;r=function(r){var u=null,f=r.wasSuccessful();f?(u=r.getRecords()[0],u.hasId()||u.setId(n),Ext.callback(t.success,i,[u,r])):Ext.callback(t.failure,i,[u,r]);Ext.callback(t.callback,i,[u,r,f])};this.getProxy().read(u,r,this)}},statics:{PREFIX:"ext-record",AUTO_ID:1,EDIT:"edit",REJECT:"reject",COMMIT:"commit",id:function(n){var t=[this.PREFIX,"-",this.AUTO_ID++].join("");return n.phantom=!0,n.internalId=t,t}},idgen:{isGenerator:!0,type:"default",generate:function(){return null},getRecId:function(n){return n.modelName+"-"+n.internalId}},editing:!1,dirty:!1,persistenceProperty:"data",evented:!1,isModel:!0,phantom:!1,idProperty:"id",clientIdProperty:null,defaultProxyType:"ajax",emptyData:[],constructor:function(n,t,i,r){var u=this,w=t||t===0,h,c,a,e,s,f,v,l,y=u.idProperty,p=u.idField,o;if(u.raw=i||n,u.modified={},u.persistenceProperty!=="data"&&Ext.log.warn(this.$className,"The persistenceProperty will be deprecated, all data will be stored in the underlying data property."),l=u[u.persistenceProperty]=r||{},u.data=u[u.persistenceProperty],u.mixins.observable.constructor.call(u),!r)if(n?!w&&y&&(t=n[y],h=t||t===0):n=u.emptyData,c=u.fields.items,a=c.length,o=0,Ext.isArray(n))for(;o<a;o++)e=c[o],s=e.name,f=n[e.originalIndex],f===undefined&&(f=e.defaultValue),e.convert&&(f=e.convert(f,u)),f!==undefined&&(l[s]=f);else for(;o<a;o++)e=c[o],s=e.name,f=n[s],f===undefined&&(f=e.defaultValue),e.convert&&(f=e.convert(f,u)),f!==undefined&&(l[s]=f);u.stores=[];w?(h=!0,l[y]=p&&p.convert?p.convert(t):t):h||(v=u.idgen.generate(),v!=null&&(u.preventInternalUpdate=!0,u.setId(v),delete u.preventInternalUpdate));u.internalId=h?t:Ext.data.Model.id(u);typeof u.init=="function"&&u.init();u.id=u.idgen.getRecId(u)},get:function(n){return this[this.persistenceProperty][n]},_singleProp:{},set:function(n,t){var i=this,c=i[i.persistenceProperty],l=i.fields,e=i.modified,a=typeof n=="string",h,o,v,y,s,r,p,w,u,f;a?(f=i._singleProp,f[n]=t):f=n;for(r in f)if(f.hasOwnProperty(r)){if(u=f[r],l&&(o=l.get(r))&&o.convert&&(u=o.convert(u,i)),h=c[r],i.isEqual(h,u))continue;if(c[r]=u,(s||(s=[])).push(r),o&&o.persist)if(e.hasOwnProperty(r)){if(i.isEqual(e[r],u)){delete e[r];i.dirty=!1;for(y in e)if(e.hasOwnProperty(y)){i.dirty=!0;break}}}else i.dirty=!0,e[r]=h;r==i.idProperty&&(v=!0,p=h,w=u)}return a&&delete f[n],v&&i.changeId(p,w),!i.editing&&s&&i.afterEdit(s),s||null},copyFrom:function(n){var t=this,e=t.fields.items,c=e.length,o=[],s,u=0,f,h,l=t.idProperty,i,r;if(n){for(f=t[t.persistenceProperty],h=n[n.persistenceProperty];u<c;u++)s=e[u],i=s.name,i!=l&&(r=h[i],r===undefined||t.isEqual(f[i],r)||(f[i]=r,o.push(i)));t.phantom&&!n.phantom&&(t.beginEdit(),t.setId(n.getId()),t.endEdit(!0),t.commit(!0))}return o},isEqual:function(n,t){return n instanceof Date&&t instanceof Date?n.getTime()===t.getTime():n===t},beginEdit:function(){var n=this,t,r,i;if(!n.editing){n.editing=!0;n.dirtySave=n.dirty;i=n[n.persistenceProperty];r=n.dataSave={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);i=n.modified;r=n.modifiedSave={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t])}},cancelEdit:function(){var n=this;n.editing&&(n.editing=!1,n.modified=n.modifiedSave,n[n.persistenceProperty]=n.dataSave,n.dirty=n.dirtySave,n.modifiedSave=n.dataSave=n.dirtySave=null)},endEdit:function(n,t){var i=this,r,u;n=n===!0;i.editing&&(i.editing=!1,r=i.dataSave,i.modifiedSave=i.dataSave=i.dirtySave=null,n||(t||(t=i.getModifiedFieldNames(r)),u=i.dirty||t.length>0,u&&i.afterEdit(t)))},getModifiedFieldNames:function(n){var i=this,r=i[i.persistenceProperty],u=[],t;n=n||i.dataSave;for(t in r)r.hasOwnProperty(t)&&(i.isEqual(r[t],n[t])||u.push(t));return u},getChanges:function(){var t=this.modified,i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]=this.get(n));return i},isModified:function(n){return this.modified.hasOwnProperty(n)},setDirty:function(){var n=this,u=n.fields.items,f=u.length,i,r,t;for(n.dirty=!0,t=0;t<f;t++)i=u[t],i.persist&&(r=i.name,n.modified[r]=n.get(r))},markDirty:function(){return Ext.log.warn("Ext.data.Model: markDirty has been deprecated. Use setDirty instead."),this.setDirty.apply(this,arguments)},reject:function(n){var t=this,i=t.modified;for(var r in i)i.hasOwnProperty(r)&&typeof i[r]!="function"&&(t[t.persistenceProperty][r]=i[r]);t.dirty=!1;t.editing=!1;t.modified={};n!==!0&&t.afterReject()},commit:function(n,t){var i=this;i.phantom=i.dirty=i.editing=!1;i.modified={};n!==!0&&i.afterCommit(t)},copy:function(n){var t=this;return new t.self(t.raw,n,null,Ext.apply({},t[t.persistenceProperty]))},setProxy:function(n){return n.isProxy||(typeof n=="string"&&(n={type:n}),n=Ext.createByAlias("proxy."+n.type,n)),n.setModel(this.self),this.proxy=n,n},getProxy:function(){return this.hasOwnProperty("proxy")?this.proxy:this.self.getProxy()},validate:function(){var f=new Ext.data.Errors,i=this.validations,e=Ext.data.validations,o,n,r,s,u,t;if(i)for(o=i.length,t=0;t<o;t++)n=i[t],r=n.field||n.name,u=n.type,s=e[u](n,this.get(r)),s||f.add({field:r,message:n.message||e[u+"Message"]});return f},isValid:function(){return this.validate().isValid()},save:function(n){n=Ext.apply({},n);var t=this,f=t.phantom?"create":"update",r=n.scope||t,e=t.stores,u=0,o,i,s,h;return Ext.apply(n,{records:[t],action:f}),s=new Ext.data.Operation(n),h=function(f){var s=f.wasSuccessful();if(s){for(o=e.length;u<o;u++)i=e[u],i.fireEvent("write",i,f),i.fireEvent("datachanged",i);Ext.callback(n.success,r,[t,f])}else Ext.callback(n.failure,r,[t,f]);Ext.callback(n.callback,r,[t,f,s])},t.getProxy()[f](s,h,t),t},destroy:function(n){n=Ext.apply({records:[this],action:"destroy"},n);var t=this,h=t.phantom!==!0,f=n.scope||t,e,o=0,c,i,u,r,s;return r=new Ext.data.Operation(n),s=function(r){if(u=[t,r],e=Ext.Array.clone(t.stores),r.wasSuccessful()){for(c=e.length;o<c;o++)i=e[o],i.remove&&i.remove(t,!0),i.fireEvent("bulkremove",i,[t],[i.indexOf(t)],!1),h&&i.fireEvent("write",i,r);t.clearListeners();Ext.callback(n.success,f,u)}else Ext.callback(n.failure,f,u);Ext.callback(n.callback,f,u)},h?t.getProxy().destroy(r,s,t):(r.complete=r.success=!0,r.resultSet=t.getProxy().reader.nullResultSet,s(r)),t},getId:function(){return this.get(this.idField.name)},getObservableId:function(){return this.id},setId:function(n){this.set(this.idProperty,n)},changeId:function(n,t){var i=this,u,r,f;i.preventInternalUpdate||(u=i.hasId(n),r=i.hasId(t),f=i.internalId,i.phantom=!r,(r!==u||r&&u)&&(i.internalId=r?t:Ext.data.Model.id(i)),i.fireEvent("idchanged",i,n,t,f),i.callStore("onIdChanged",n,t,f))},hasId:function(n){return arguments.length===0&&(n=this.getId()),!!(n||n===0)},join:function(n){var t=this;t.stores.length?Ext.Array.include(this.stores,n):t.stores[0]=n;this.store=this.stores[0]},unjoin:function(n){Ext.Array.remove(this.stores,n);this.store=this.stores[0]||null},afterEdit:function(n){this.callStore("afterEdit",n)},afterReject:function(){this.callStore("afterReject")},afterCommit:function(n){this.callStore("afterCommit",n)},callStore:function(n){var r=Ext.Array.clone(arguments),u=this.stores,i=0,f=u.length,t;for(r[0]=this;i<f;++i)t=u[i],t&&Ext.isFunction(t[n])&&t[n].apply(t,r)},getData:function(n){for(var i=this,f=i.fields.items,e=f.length,r={},u,t=0;t<e;t++)u=f[t].name,r[u]=i.get(u);return n===!0&&Ext.apply(r,i.getAssociatedData()),r},getAssociatedData:function(){return this.prepareAssociatedData({},1)},prepareAssociatedData:function(n,t){for(var a=this,nt=a.associations.items,tt=nt.length,o={},s=[],v=[],y=[],h,p,r,w,b,k,d,g,c,u,f,l,e,i=0;i<tt;i++)if(u=nt[i],g=u.associationId,d=n[g],!d||d===t)if(n[g]=t,l=u.type,e=u.name,l=="hasMany"){if(h=a[u.storeName],o[e]=[],h&&h.getCount()>0)for(p=h.data.items,c=p.length,f=0;f<c;f++)r=p[f],o[e][f]=r.getData(),s.push(r),v.push(e),y.push(f)}else(l=="belongsTo"||l=="hasOne")&&(r=a[u.instanceName],r!==undefined&&(o[e]=r.getData(),s.push(r),v.push(e),y.push(-1)));for(i=0,c=s.length;i<c;++i)r=s[i],w=o[v[i]],b=y[i],k=r.prepareAssociatedData(n,t+1),b===-1?Ext.apply(w,k):Ext.apply(w[b],k);return o}})