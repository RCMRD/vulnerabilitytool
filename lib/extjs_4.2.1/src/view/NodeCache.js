Ext.define("Ext.view.NodeCache",{constructor:function(n){this.view=n;this.clear();this.el=new Ext.dom.AbstractElement.Fly},clear:function(n){var t=this,r=this.elements,u,i;if(n)for(u in r)i=r[u],i.parentNode.removeChild(i);t.elements={};t.count=t.startIndex=0;t.endIndex=-1},fill:function(n,t){var r=this,f=r.elements={},i,u=n.length;for(t||(t=0),i=0;i<u;i++)f[t+i]=n[i];return r.startIndex=t,r.endIndex=t+u-1,r.count=u,this},insert:function(n,t){var i=this,f=i.elements,r,u=t.length;if(i.count){if((n>i.endIndex+1||n+t.length-1<i.startIndex)&&Ext.Error.raise("Discontiguous range would result from inserting "+t.length+" nodes at "+n),n<i.count)for(r=i.endIndex+u;r>=n+u;r--)f[r]=f[r-u],f[r].setAttribute("data-recordIndex",r);i.endIndex=i.endIndex+u}else i.startIndex=n,i.endIndex=n+u-1;for(r=0;r<u;r++,n++)f[n]=t[r],f[n].setAttribute("data-recordIndex",n);i.count+=u},item:function(n,t){var r=this.elements[n],i=null;return r&&(i=t?this.elements[n]:this.el.attach(this.elements[n])),i},first:function(n){return this.item(this.startIndex,n)},last:function(n){return this.item(this.endIndex,n)},getCount:function(){return this.count},slice:function(n,t){var u=this.elements,r=[],i;for(t=arguments.length<2?this.endIndex:Math.min(this.endIndex,t-1),i=n||this.startIndex;i<=t;i++)r.push(u[i]);return r},replaceElement:function(n,t,i){var u=this.elements,r=typeof n=="number"?n:this.indexOf(n);return r>-1&&(t=Ext.getDom(t),i&&(n=u[r],n.parentNode.insertBefore(t,n),Ext.removeNode(n),t.setAttribute("data-recordIndex",r)),this.elements[r]=t),this},indexOf:function(n){var i=this.elements,t;for(n=Ext.getDom(n),t=this.startIndex;t<=this.endIndex;t++)if(i[t]===n)return t;return-1},removeRange:function(n,t,i){var u=this,f=u.elements,s,r,o,e;for(t=t===undefined?u.count:Math.min(u.endIndex+1,t+1),n||(n=0),o=t-n,r=n,e=t;r<u.endIndex;r++,e++)i&&r<t&&Ext.removeNode(f[r]),e<=u.endIndex?(s=f[r]=f[e],s.setAttribute("data-recordIndex",r)):delete f[r];u.count-=o;u.endIndex-=o},removeElement:function(n,t){var i=this,h,f,s=i.elements,c,e,r=0,u,o;if(Ext.isArray(n)){for(h=n,n=[],e=h.length,r=0;r<e;r++)f=h[r],typeof f!="number"&&(f=i.indexOf(f)),f>=i.startIndex&&f<=i.endIndex&&(n[n.length]=f);Ext.Array.sort(n);e=n.length}else{if(n<i.startIndex||n>i.endIndex)return;e=1;n=[n]}for(u=o=n[0],r=0;u<=i.endIndex;u++,o++)r<e&&u===n[r]&&(o++,r++,t&&Ext.removeNode(s[u])),o<=i.endIndex&&o>=i.startIndex?(c=s[u]=s[o],c.setAttribute("data-recordIndex",u)):delete s[u];i.endIndex-=e;i.count-=e},scroll:function(n,t,i){var u=this,f=u.elements,h=n.length,r,e,l,o,c=u.view.getNodeContainer(),s=document.createDocumentFragment();if(t==-1){for(r=u.endIndex-i+1;r<=u.endIndex;r++)e=f[r],delete f[r],e.parentNode.removeChild(e);for(u.endIndex-=i,o=u.view.bufferRender(n,u.startIndex-=h),r=0;r<h;r++)f[u.startIndex+r]=o[r],s.appendChild(o[r]);c.insertBefore(s,c.firstChild)}else{for(l=u.startIndex+i,r=u.startIndex;r<l;r++)e=f[r],delete f[r],e.parentNode.removeChild(e);for(u.startIndex=r,o=u.view.bufferRender(n,u.endIndex+1),r=0;r<h;r++)f[u.endIndex+=1]=o[r],s.appendChild(o[r]);c.appendChild(s)}u.count=u.endIndex-u.startIndex+1}})