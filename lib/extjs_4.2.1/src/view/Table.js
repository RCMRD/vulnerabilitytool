Ext.define("Ext.view.Table",{extend:"Ext.view.View",alias:"widget.tableview",requires:["Ext.grid.CellContext","Ext.view.TableLayout","Ext.view.NodeCache","Ext.util.DelayedTask","Ext.util.MixedCollection"],componentLayout:"tableview",baseCls:Ext.baseCSSPrefix+"grid-view",firstCls:Ext.baseCSSPrefix+"grid-cell-first",lastCls:Ext.baseCSSPrefix+"grid-cell-last",headerRowSelector:"tr."+Ext.baseCSSPrefix+"grid-header-row",selectedItemCls:Ext.baseCSSPrefix+"grid-row-selected",beforeSelectedItemCls:Ext.baseCSSPrefix+"grid-row-before-selected",selectedCellCls:Ext.baseCSSPrefix+"grid-cell-selected",focusedItemCls:Ext.baseCSSPrefix+"grid-row-focused",beforeFocusedItemCls:Ext.baseCSSPrefix+"grid-row-before-focused",tableFocusedFirstCls:Ext.baseCSSPrefix+"grid-table-focused-first",tableSelectedFirstCls:Ext.baseCSSPrefix+"grid-table-selected-first",tableOverFirstCls:Ext.baseCSSPrefix+"grid-table-over-first",overItemCls:Ext.baseCSSPrefix+"grid-row-over",beforeOverItemCls:Ext.baseCSSPrefix+"grid-row-before-over",altRowCls:Ext.baseCSSPrefix+"grid-row-alt",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",rowClsRe:new RegExp("(?:^|\\s*)"+Ext.baseCSSPrefix+"grid-row-(first|last|alt)(?:\\s+|$)","g"),cellRe:new RegExp(Ext.baseCSSPrefix+"grid-cell-([^\\s]+) ",""),positionBody:!0,trackOver:!0,getRowClass:null,stripeRows:!0,markDirty:!0,tpl:"{%values.view.tableTpl.applyOut(values, out)%}",tableTpl:["{%",'var view=values.view,tableCls=["'+Ext.baseCSSPrefix+'" + view.id + "-table '+Ext.baseCSSPrefix+'grid-table"];',"if (view.columnLines) tableCls[tableCls.length]=view.ownerCt.colLinesCls;","if (view.rowLines) tableCls[tableCls.length]=view.ownerCt.rowLinesCls;","%}",'<table role="presentation" id="{view.id}-table" class="{[tableCls.join(" ")]}" border="0" cellspacing="0" cellpadding="0" style="{tableStyle}" tabIndex="-1">',"{[view.renderColumnSizer(out)]}","{[view.renderTHead(values, out)]}","{[view.renderTFoot(values, out)]}",'<tbody id="{view.id}-body">',"{%","view.renderRows(values.rows, values.viewStartIndex, out);","%}","<\/tbody>","<\/table>",{priority:0}],rowTpl:["{%",'var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-data-row";',"%}",'<tr role="row" {[values.rowId ? ("id=\\"" + values.rowId + "\\"") : ""]} ','data-boundView="{view.id}" ','data-recordId="{record.internalId}" ','data-recordIndex="{recordIndex}" ','class="{[values.itemClasses.join(" ")]} {[values.rowClasses.join(" ")]}{[dataRowCls]}" ','{rowAttr:attributes} tabIndex="-1">','<tpl for="columns">{%',"parent.view.renderCell(values, parent.record, parent.recordIndex, xindex - 1, out, parent)","%}","<\/tpl>","<\/tr>",{priority:0}],cellTpl:['<td role="gridcell" class="{tdCls}" {tdAttr} id="{[Ext.id()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}"','style="text-align:{align};<tpl if="style">{style}<\/tpl>">{value}<\/div>',"<\/td>",{priority:0}],refreshSelmodelOnRefresh:!1,tableValues:{},rowValues:{itemClasses:[],rowClasses:[]},cellValues:{classes:[Ext.baseCSSPrefix+"grid-cell "+Ext.baseCSSPrefix+"grid-td"]},renderBuffer:document.createElement("div"),constructor:function(n){n.grid.isTree&&(n.baseCls=Ext.baseCSSPrefix+"tree-view");this.callParent([n])},initComponent:function(){var n=this,t=n.scroll;this.addEvents("beforecellclick","cellclick","beforecelldblclick","celldblclick","beforecellcontextmenu","cellcontextmenu","beforecellmousedown","cellmousedown","beforecellmouseup","cellmouseup","beforecellkeydown","cellkeydown");n.body=new Ext.dom.Element.Fly;n.body.id=n.id+"gridBody";n.autoScroll=undefined;n.trackOver||(n.overItemCls=null,n.beforeOverItemCls=null);t===!0||t==="both"?n.autoScroll=!0:t==="horizontal"?n.overflowX="auto":t==="vertical"&&(n.overflowY="auto");n.selModel.view=n;n.headerCt.view=n;n.grid.view=n;n.initFeatures(n.grid);delete n.grid;n.tpl=n.getTpl("tpl");n.itemSelector=n.getItemSelector();n.all=new Ext.view.NodeCache(n);n.callParent()},moveColumn:function(n,t,i){var r=this,o=i>1?document.createDocumentFragment():undefined,h=t,a=r.getGridColumns().length,c=a-1,p=(r.firstCls||r.lastCls)&&(t===0||t==a||n===0||n==c),e,s,v,l,f,u,y;if(r.rendered&&t!==n){for(v=r.el.query(r.getDataRowSelector()),t>n&&o&&(h-=i),e=0,l=v.length;e<l;e++){if(f=v[e],u=f.childNodes,p){if(u.length===1){Ext.fly(u[0]).addCls(r.firstCls);Ext.fly(u[0]).addCls(r.lastCls);continue}n===0?(Ext.fly(u[0]).removeCls(r.firstCls),Ext.fly(u[1]).addCls(r.firstCls)):n===c&&(Ext.fly(u[c]).removeCls(r.lastCls),Ext.fly(u[c-1]).addCls(r.lastCls));t===0?(Ext.fly(u[0]).removeCls(r.firstCls),Ext.fly(u[n]).addCls(r.firstCls)):t===a&&(Ext.fly(u[c]).removeCls(r.lastCls),Ext.fly(u[n]).addCls(r.lastCls))}if(o){for(s=0;s<i;s++)o.appendChild(u[n]);f.insertBefore(o,u[h]||null)}else f.insertBefore(u[n],u[h]||null)}for(y=r.el.query(r.getBodySelector()),e=0,l=y.length;e<l;e++)if(f=y[e],o){for(s=0;s<i;s++)o.appendChild(f.childNodes[n]);f.insertBefore(o,f.childNodes[h]||null)}else f.insertBefore(f.childNodes[n],f.childNodes[h]||null)}},scrollToTop:Ext.emptyFn,addElListener:function(n,t,i){this.mon(this,n,t,i,{element:"el"})},getGridColumns:function(){return this.ownerCt.columnManager.getColumns()},getHeaderAtIndex:function(n){return this.ownerCt.columnManager.getHeaderAtIndex(n)},getCell:function(n,t){var i=this.getNode(n,!0);return Ext.fly(i).down(t.getCellSelector())},getFeature:function(n){var t=this.featuresMC;if(t)return t.get(n)},findFeature:function(n){if(this.features)return Ext.Array.findBy(this.features,function(t){if(t.ftype===n)return!0})},initFeatures:function(n){var t=this,r,u,i,f;for(t.tableTpl=Ext.XTemplate.getTpl(this,"tableTpl"),t.rowTpl=Ext.XTemplate.getTpl(this,"rowTpl"),t.cellTpl=Ext.XTemplate.getTpl(this,"cellTpl"),t.featuresMC=new Ext.util.MixedCollection,u=t.features=t.constructFeatures(),f=u?u.length:0,r=0;r<f;r++)i=u[r],i.view=t,i.grid=n,t.featuresMC.add(i),i.init(n)},renderTHead:function(n,t){var r=n.view.headerFns,u,i;if(r)for(i=0,u=r.length;i<u;++i)r[i].call(this,n,t)},addHeaderFn:function(){var n=this.headerFns;n||(n=this.headerFns=[]);n.push(fn)},renderTFoot:function(n,t){var r=n.view.footerFns,u,i;if(r)for(i=0,u=r.length;i<u;++i)r[i].call(this,n,t)},addFooterFn:function(n){var t=this.footerFns;t||(t=this.footerFns=[]);t.push(n)},addTableTpl:function(n){return this.addTpl("tableTpl",n)},addRowTpl:function(n){return this.addTpl("rowTpl",n)},addCellTpl:function(n){return this.addTpl("cellTpl",n)},addTpl:function(n,t){var r=this,i,u;for(t=Ext.Object.chain(t),t.isTemplate||(t.applyOut=r.tplApplyOut),i=r[n];t.priority<i.priority;i=i.nextTpl)u=i;return u?u.nextTpl=t:r[n]=t,t.nextTpl=i,t},tplApplyOut:function(n,t){this.before&&this.before(n,t)===!1||(this.nextTpl.applyOut(n,t),this.after&&this.after(n,t))},constructFeatures:function(){var f=this,i=f.features,n,r,t=0,u;if(i)for(r=[],u=i.length;t<u;t++)n=i[t],n.isFeature||(n=Ext.create("feature."+n.ftype,n)),r[t]=n;return r},beforeRender:function(){var n=this;n.callParent();n.enableTextSelection||n.protoEl.unselectable()},onViewScroll:function(n,t){this.callParent(arguments);this.fireEvent("bodyscroll",n,t)},createRowElement:function(n,t){var i=this,r=i.renderBuffer;return i.tpl.overwrite(r,i.collectData([n],t)),Ext.fly(r).down(i.getNodeContainerSelector(),!0).firstChild},bufferRender:function(n,t){var i=this,r=i.renderBuffer;return i.tpl.overwrite(r,i.collectData(n,t)),Ext.Array.toArray(Ext.fly(r).down(i.getNodeContainerSelector(),!0).childNodes)},collectData:function(n,t){return this.rowValues.view=this,{view:this,rows:n,viewStartIndex:t,tableStyle:this.bufferedRenderer?"position:absolute;top:"+this.bufferedRenderer.bodyTop:""}},collectNodes:function(){this.all.fill(this.getNodeContainer().childNodes,this.all.startIndex)},refreshSize:function(){var n=this,t,i=n.getBodySelector();i&&n.body.attach(n.el.child(i,!0));n.hasLoadingHeight||(t=n.up("tablepanel"),Ext.suspendLayouts(),n.callParent(),t.updateLayout(),Ext.resumeLayouts(!0))},statics:{getBoundView:function(n){return Ext.getCmp(n.getAttribute("data-boundView"))}},getRecord:function(n){if(n=this.getNode(n),n){var t=n.getAttribute("data-recordIndex");return t&&(t=parseInt(t,10),t>-1)?this.store.data.getAt(t):this.dataSource.data.get(n.getAttribute("data-recordId"))}},indexOf:function(n){return(n=this.getNode(n,!1),!n&&n!==0)?-1:this.all.indexOf(n)},indexInStore:function(n){if(n=this.getNode(n,!0),!n&&n!==0)return-1;var t=n.getAttribute("data-recordIndex");return t?parseInt(t,10):this.dataSource.indexOf(this.getRecord(n))},renderRows:function(n,t,i){var r=this.rowValues,f=n.length,u;for(r.view=this,r.columns=this.ownerCt.columnManager.getColumns(),u=0;u<f;u++,t++)r.itemClasses.length=r.rowClasses.length=0,this.renderRow(n[u],t,i);r.view=r.columns=r.record=null},renderColumnSizer:function(n){for(var r=this.getGridColumns(),f=r.length,i,u,t=0;t<f;t++)i=r[t],u=i.hidden?0:i.lastBox?i.lastBox.width:Ext.grid.header.Container.prototype.defaultWidth,n.push('<colgroup><col class="',Ext.baseCSSPrefix,"grid-cell-",r[t].getItemId(),'" style="width:'+u+'px"><\/colgroup>')},renderRow:function(n,t,i){var r=this,c=t===-1,f=r.selModel,u=r.rowValues,e=u.itemClasses,o=u.rowClasses,s,h=r.rowTpl;if(u.record=n,u.recordId=n.internalId,u.recordIndex=t,u.rowId=r.getRowId(n),u.itemCls=u.rowCls="",u.columns||(u.columns=r.ownerCt.columnManager.getColumns()),e.length=o.length=0,c||(e[0]=Ext.baseCSSPrefix+"grid-row",f&&f.isRowSelected&&(f.isRowSelected(t+1)&&e.push(r.beforeSelectedItemCls),f.isRowSelected(n)&&e.push(r.selectedItemCls)),r.stripeRows&&t%2!=0&&o.push(r.altRowCls),r.getRowClass&&(s=r.getRowClass(n,t,null,r.dataSource),s&&o.push(s))),i)h.applyOut(u,i);else return h.apply(u)},renderCell:function(n,t,i,r,u){var e=this,c=e.selModel,f=e.cellValues,o=f.classes,l=t.data[n.dataIndex],a=e.cellTpl,h,s;f.record=t;f.column=n;f.recordIndex=i;f.columnIndex=r;f.cellIndex=r;f.align=n.align;f.tdCls=n.tdCls;f.innerCls=n.innerCls;f.style=f.tdAttr="";f.unselectableAttr=e.enableTextSelection?"":'unselectable="on"';n.renderer&&n.renderer.call?(h=n.renderer.call(n.scope||e.ownerCt,l,f,t,i,r,e.dataSource,e),f.css&&(t.cssWarning=!0,f.tdCls+=" "+f.css,delete f.css)):h=l;f.value=h==null||h===""?"&#160;":h;o[1]=Ext.baseCSSPrefix+"grid-cell-"+n.getItemId();s=2;n.tdCls&&(o[s++]=n.tdCls);e.markDirty&&t.isModified(n.dataIndex)&&(o[s++]=e.dirtyCls);n.isFirstVisible&&(o[s++]=e.firstCls);n.isLastVisible&&(o[s++]=e.lastCls);e.enableTextSelection||(o[s++]=Ext.baseCSSPrefix+"unselectable");o[s++]=f.tdCls;c&&c.isCellSelected&&c.isCellSelected(e,i,r)&&(o[s++]=e.selectedCellCls);o.length=s;f.tdCls=o.join(" ");a.applyOut(f,u);f.column=null},getNode:function(n,t){var r,i=this.callParent(arguments);if(i&&i.tagName)if(t){if(!(r=Ext.fly(i)).is(this.dataRowSelector))return r.down(this.dataRowSelector,!0)}else if(t===!1&&!(r=Ext.fly(i)).is(this.itemSelector))return r.up(this.itemSelector,null,!0);return i},getRowId:function(n){return this.id+"-record-"+n.internalId},constructRowId:function(n){return this.id+"-record-"+n},getNodeById:function(n,t){return n=this.constructRowId(n),this.retrieveNode(n,t)},getNodeByRecord:function(n,t){var i=this.getRowId(n);return this.retrieveNode(i,t)},retrieveNode:function(n,t){var i=this.el.getById(n,!0),r=this.itemSelector,u;return t===!1&&i&&!(u=Ext.fly(i)).is(r)?u.up(r,null,!0):i},updateIndexes:Ext.emptyFn,bodySelector:"table",nodeContainerSelector:"tbody",itemSelector:"tr."+Ext.baseCSSPrefix+"grid-row",dataRowSelector:"tr."+Ext.baseCSSPrefix+"grid-data-row",cellSelector:"td."+Ext.baseCSSPrefix+"grid-cell",sizerSelector:"col."+Ext.baseCSSPrefix+"grid-cell",innerSelector:"div."+Ext.baseCSSPrefix+"grid-cell-inner",getNodeContainer:function(){return this.el.down(this.nodeContainerSelector,!0)},getBodySelector:function(){return this.bodySelector+"."+Ext.baseCSSPrefix+this.id+"-table"},getNodeContainerSelector:function(){return this.nodeContainerSelector},getColumnSizerSelector:function(n){return this.sizerSelector+"-"+n.getItemId()},getItemSelector:function(){return this.itemSelector},getDataRowSelector:function(){return this.dataRowSelector},getCellSelector:function(n){var t=this.cellSelector;return n&&(t+="-"+n.getItemId()),t},getCellInnerSelector:function(n){return this.getCellSelector(n)+" "+this.innerSelector},addRowCls:function(n,t){var i=this.getNode(n,!1);i&&Ext.fly(i).addCls(t)},removeRowCls:function(n,t){var i=this.getNode(n,!1);i&&Ext.fly(i).removeCls(t)},setHighlightedItem:function(n){var t=this,i=t.highlightedItem;i&&t.el.isAncestor(i)&&t.isRowStyleFirst(i)&&t.getRowStyleTableEl(i).removeCls(t.tableOverFirstCls);n&&t.isRowStyleFirst(n)&&t.getRowStyleTableEl(n).addCls(t.tableOverFirstCls);t.callParent(arguments)},onRowSelect:function(n){var t=this;t.addRowCls(n,t.selectedItemCls);t.isRowStyleFirst(n)?t.getRowStyleTableEl(n).addCls(t.tableSelectedFirstCls):t.addRowCls(n-1,t.beforeSelectedItemCls)},onRowDeselect:function(n){var t=this;t.removeRowCls(n,[t.selectedItemCls,t.focusedItemCls]);t.isRowStyleFirst(n)?t.getRowStyleTableEl(n).removeCls([t.tableFocusedFirstCls,t.tableSelectedFirstCls]):t.removeRowCls(n-1,[t.beforeFocusedItemCls,t.beforeSelectedItemCls])},onCellSelect:function(n){var t=this.getCellByPosition(n);t&&(t.addCls(this.selectedCellCls),this.scrollCellIntoView(t))},onCellDeselect:function(n){var t=this.getCellByPosition(n,!0);t&&Ext.fly(t).removeCls(this.selectedCellCls)},getCellByPosition:function(n,t){if(n){var i=this.getNode(n.row,!0),r=this.ownerCt.columnManager.getHeaderAtIndex(n.column);if(r&&i)return Ext.fly(i).down(this.getCellSelector(r),t)}return!1},getFocusEl:function(){var n=this,t;if(n.refreshCounter)t=n.focusedRow,t&&n.el.contains(t)||(n.all.getCount()&&(t=n.getNode(n.all.item(0).dom,!0))?n.focusRow(t):t=n.body);else return n.el;return Ext.get(t)},onRowFocus:function(n,t,i){var r=this;t?(r.addRowCls(n,r.focusedItemCls),r.isRowStyleFirst(n)?r.getRowStyleTableEl(n).addCls(r.tableFocusedFirstCls):r.addRowCls(n-1,r.beforeFocusedItemCls),i||r.focusRow(n)):(r.removeRowCls(n,r.focusedItemCls),r.isRowStyleFirst(n)?r.getRowStyleTableEl(n).removeCls(r.tableFocusedFirstCls):r.removeRowCls(n-1,r.beforeFocusedItemCls));(Ext.isIE6||Ext.isIE7)&&!r.ownerCt.rowLines&&r.repaintRow(n)},focus:function(n,t){var i=this,r=Ext.isIE&&!t,u;r&&(u=i.el.dom.scrollLeft);this.callParent(arguments);r&&(i.el.dom.scrollLeft=u)},focusRow:function(n,t){var i=this,u,f=i.ownerCt&&i.ownerCt.collapsed,r;i.isVisible(!0)&&!f&&(n=i.getNode(n,!0))&&(i.scrollRowIntoView(n),r=i.getRecord(n),u=i.indexInStore(n),i.selModel.setLastFocused(r),i.focusedRow=n,i.focus(!1,t,function(){i.fireEvent("rowfocus",r,n,u)}))},scrollRowIntoView:function(n){n=this.getNode(n,!0);n&&Ext.fly(n).scrollIntoView(this.el,!1)},focusCell:function(n){var t=this,i=t.getCellByPosition(n),r=t.getRecord(n.row);t.focusRow(r);i&&(t.scrollCellIntoView(i),t.fireEvent("cellfocus",r,i,n))},scrollCellIntoView:function(n){n.row!=null&&n.column!=null&&(n=this.getCellByPosition(n));n&&Ext.fly(n).scrollIntoView(this.el,!0)},scrollByDelta:function(n,t){t=t||"scrollTop";var i=this.el.dom;i[t]=i[t]+=n},isDataRow:function(n){return Ext.fly(n).hasCls(Ext.baseCSSPrefix+"grid-data-row")},syncRowHeights:function(n,t){n=Ext.get(n);t=Ext.get(t);n.dom.style.height=t.dom.style.height="";var f=this,u=f.rowTpl,i=n.dom.offsetHeight,r=t.dom.offsetHeight;if(i!==r){while(u){if(u.syncRowHeights&&u.syncRowHeights(n,t)===!1)break;u=u.nextTpl}i=n.dom.offsetHeight;r=t.dom.offsetHeight;i!==r&&(n=n.down("[data-recordId]")||n,t=t.down("[data-recordId]")||t,n&&t&&(n.dom.style.height=t.dom.style.height="",i=n.dom.offsetHeight,r=t.dom.offsetHeight,i>r?(n.setHeight(i),t.setHeight(i)):r>i&&(n.setHeight(r),t.setHeight(r))))}},onIdChanged:function(n,t,i,r,u){var e=this,f;e.viewReady&&(f=e.getNodeById(u),f&&(f.setAttribute("data-recordId",t.internalId),f.id=e.getRowId(t)))},onUpdate:function(n,t,i,r){var u=this,s=u.rowTpl,l,o,e,f,c,g,a,h,v,y,p,w,b,k,d;if(u.viewReady&&(e=u.getNodeByRecord(t,!1),e)){if(v=u.overItemCls,y=u.overItemCls,p=u.focusedItemCls,w=u.beforeFocusedItemCls,b=u.selectedItemCls,k=u.beforeSelectedItemCls,l=u.indexInStore(t),o=Ext.fly(e,"_internal"),f=u.createRowElement(t,l),o.hasCls(v)&&Ext.fly(f).addCls(v),o.hasCls(y)&&Ext.fly(f).addCls(y),o.hasCls(p)&&Ext.fly(f).addCls(p),o.hasCls(w)&&Ext.fly(f).addCls(w),o.hasCls(b)&&Ext.fly(f).addCls(b),o.hasCls(k)&&Ext.fly(f).addCls(k),d=u.ownerCt.columnManager.getColumns(),Ext.isIE9m&&e.mergeAttributes)e.mergeAttributes(f,!0);else for(c=f.attributes,g=c.length,h=0;h<g;h++)a=c[h].name,a!=="id"&&e.setAttribute(a,c[h].value);for(d.length&&u.updateColumns(t,u.getNode(e,!0),u.getNode(f,!0),d,r);s;){if(s.syncContent&&s.syncContent(e,f)===!1)break;s=s.nextTpl}u.fireEvent("itemupdate",t,l,e);u.refreshSize()}},updateColumns:function(n,t,i,r,u){var f=this,s,p,c,e,b=r.length,h,l,o,a,v,w=f.editingPlugin||f.lockingPartner&&f.ownerCt.ownerLockable.view.editingPlugin,k=w&&w.editing,y=f.getCellSelector();if(t.mergeAttributes)t.mergeAttributes(i,!0);else for(s=i.attributes,p=s.length,e=0;e<p;e++)c=s[e].name,c!=="id"&&t.setAttribute(c,s[e].value);for(h=0;h<b;h++)l=r[h],f.shouldUpdateCell(n,l,u)&&(y=f.getCellSelector(l),o=Ext.DomQuery.selectNode(y,t),a=Ext.DomQuery.selectNode(y,i),k?Ext.fly(o).syncContent(a):(v=o.parentNode,v.insertBefore(a,o),v.removeChild(o)))},shouldUpdateCell:function(n,t,i){if(t.hasCustomRenderer||!i)return!0;if(i)for(var f=i.length,u,r=0;r<f;++r)if(u=i[r],u===t.dataIndex||u===n.idProperty)return!0;return!1},refresh:function(){var n=this,t=n.el&&n.el.isAncestor(Ext.Element.getActiveElement());if(n.callParent(arguments),n.headerCt.setSortState(),n.el&&!n.all.getCount()&&n.headerCt&&n.headerCt.tooNarrow&&n.el.createChild({style:"position:absolute;height:1px;width:1px;left:"+(n.headerCt.getFullWidth()-1)+"px"}),t)n.selModel.onLastFocusChanged(null,n.selModel.lastFocused)},processItemEvent:function(n,t,i,r){if(this.indexInStore(t)!==-1){var u=this,f=r.getTarget(u.getCellSelector(),t),o,c=u.statics().EventMap,l=u.getSelectionModel(),e=r.type,a=u.features,p=a.length,s,v,h,y;if(e=="keydown"&&!f&&l.getCurrentPosition&&(f=u.getCellByPosition(l.getCurrentPosition(),!0)),f){if(!f.parentNode)return!1;y=u.getHeaderByCell(f);o=Ext.Array.indexOf(u.getGridColumns(),y)}else o=-1;if(v=u.fireEvent("uievent",e,u,f,i,o,r,n,t),v===!1||u.callParent(arguments)===!1){u.selModel.onVetoUIEvent(e,u,f,i,o,r,n,t);return!1}for(s=0;s<p;++s)if(h=a[s],h.wrapsItem&&h.vetoEvent(n,t,i,r)===!1)return u.processSpecialEvent(r),!1;return e=="mouseover"||e=="mouseout"?!0:f?!(u["onBeforeCell"+c[e]](f,o,n,t,i,r)===!1||u.fireEvent("beforecell"+e,u,f,o,n,t,i,r)===!1||u["onCell"+c[e]](f,o,n,t,i,r)===!1||u.fireEvent("cell"+e,u,f,o,n,t,i,r)===!1):!0}return this.processSpecialEvent(r),!1},processSpecialEvent:function(n){var t=this,c=t.features,l=c.length,r=n.type,u,i,o,f,s,h,e=t.ownerCt;if(t.callParent(arguments),r!="mouseover"&&r!="mouseout"){for(u=0;u<l;u++)if(i=c[u],i.hasFeatureEvent&&(f=n.getTarget(i.eventSelector,t.getTargetEl()),f&&(o=i.eventPrefix,s=i.getFireEventArgs("before"+o+r,t,f,n),h=i.getFireEventArgs(o+r,t,f,n),t.fireEvent.apply(t,s)===!1||e.fireEvent.apply(e,s)===!1||t.fireEvent.apply(t,h)===!1||e.fireEvent.apply(e,h)===!1)))return!1;return!0}},onCellMouseDown:Ext.emptyFn,onCellMouseUp:Ext.emptyFn,onCellClick:Ext.emptyFn,onCellDblClick:Ext.emptyFn,onCellContextMenu:Ext.emptyFn,onCellKeyDown:Ext.emptyFn,onBeforeCellMouseDown:Ext.emptyFn,onBeforeCellMouseUp:Ext.emptyFn,onBeforeCellClick:Ext.emptyFn,onBeforeCellDblClick:Ext.emptyFn,onBeforeCellContextMenu:Ext.emptyFn,onBeforeCellKeyDown:Ext.emptyFn,expandToFit:function(n){this.autoSizeColumn(n)},autoSizeColumn:function(n){if(Ext.isNumber(n)&&(n=this.getGridColumns[n]),n){if(n.isGroupHeader){n.autoSize();return}delete n.flex;n.setWidth(this.getMaxContentWidth(n))}},getMaxContentWidth:function(n){var i=this,r=i.el.query(n.getCellInnerSelector()),c=n.getWidth(),u=0,f=r.length,e=Ext.supports.ScrollWidthInlinePaddingBug,o=i.body.select(i.getColumnSizerSelector(n)),s=Math.max,h,t;for(e&&f>0&&(h=i.getCellPaddingAfter(r[0])),o.setWidth(1),t=n.textEl.dom.offsetWidth+n.titleEl.getPadding("lr");u<f;u++)t=s(t,r[u].scrollWidth);return e&&(t+=h),t=s(t,40),o.setWidth(c),t},getPositionByEvent:function(n){var t=this,i=n.getTarget(t.cellSelector),r=n.getTarget(t.itemSelector),u=t.getRecord(r),f=t.getHeaderByCell(i);return t.getPosition(u,f)},getHeaderByCell:function(n){if(n){var t=n.className.match(this.cellRe);if(t&&t[1])return this.ownerCt.columnManager.getHeaderById(t[1])}return!1},walkCells:function(n,t,i,r,u,f){if(!n)return!1;var e=this,o=n.row,h=n.column,l=e.dataSource.getCount(),a=e.ownerCt.columnManager.getColumns().length-1,s=o,c=h,v=e.ownerCt.columnManager.getHeaderAtIndex(h);if(!v||v.hidden||!l)return!1;i=i||{};t=t.toLowerCase();switch(t){case"right":if(h===a){if(r||o===l-1)return!1;i.ctrlKey||(s=e.walkRows(o,1),s!==o&&(c=0))}else c=i.ctrlKey?a:h+1;break;case"left":if(h===0){if(r||o===0)return!1;i.ctrlKey||(s=e.walkRows(o,-1),s!==o&&(c=a))}else c=i.ctrlKey?0:h-1;break;case"up":if(o===0)return!1;s=i.ctrlKey?e.walkRows(-1,1):e.walkRows(o,-1);break;case"down":if(o===l-1)return!1;s=i.ctrlKey?e.walkRows(l,-1):e.walkRows(o,1)}return u&&u.call(f||e,{row:s,column:c})!==!0?!1:new Ext.grid.CellContext(e).setPosition(s,c)},walkRows:function(n,t){var r=this,f=0,e=n,o,h=(r.dataSource.buffered?r.dataSource.getTotalCount():r.dataSource.getCount())-1,u=t<0?0:h,s=u?1:-1,i=n;do{if(u?i>=u:i<=0)return e||u;i+=s;(o=Ext.fly(r.getNode(i,!0)))&&o.isVisible(!0)&&(f+=s,e=i)}while(f!==t);return i},walkRecs:function(n,t){var i=this,o=0,u=n,s,c=(i.store.buffered?i.store.getTotalCount():i.store.getCount())-1,f=t<0?0:c,h=f?1:-1,r=i.store.indexOf(n),e;do{if(f?r>=f:r<=0)return u;r+=h;e=i.store.getAt(r);(s=Ext.fly(i.getNodeByRecord(e,!0)))&&s.isVisible(!0)&&(o+=h,u=e)}while(o!==t);return u},getFirstVisibleRowIndex:function(){var n=this,i=n.dataSource.buffered?n.dataSource.getTotalCount():n.dataSource.getCount(),t=n.indexOf(n.all.first())-1;do if(t+=1,t===i)return;while(!Ext.fly(n.getNode(t,!0)).isVisible(!0));return t},getLastVisibleRowIndex:function(){var t=this,n=t.indexOf(t.all.last());do if(n-=1,n===-1)return;while(!Ext.fly(t.getNode(n,!0)).isVisible(!0));return n},getHeaderCt:function(){return this.headerCt},getPosition:function(n,t){return new Ext.grid.CellContext(this).setPosition(n,t)},beforeDestroy:function(){var n=this;n.rendered&&n.el.removeAllListeners();n.callParent(arguments)},onDestroy:function(){var i=this,t=i.featuresMC,r,n;if(t)for(n=0,r=t.getCount();n<r;++n)t.getAt(n).destroy();i.featuresMC=null;this.callParent(arguments)},onAdd:function(n,t,i){this.callParent(arguments);this.doStripeRows(i)},onRemove:function(n,t,i){this.callParent(arguments);this.doStripeRows(i[0])},doStripeRows:function(n,t){var i=this,f,e,r,u;if(i.rendered&&i.stripeRows)for(f=i.getNodes(n,t),r=0,e=f.length;r<e;r++)u=f[r],u.className=u.className.replace(i.rowClsRe," "),n++,n%2==0&&(u.className+=" "+i.altRowCls)},repaintRow:function(n){for(var r=this.getNode(n),t=r.childNodes,i=t.length;i--;)t[i].className=t[i].className},getRowStyleTableEl:function(n){var t=this;return n.tagName||(n=this.getNode(n)),(t.isGrouping?Ext.fly(n):this.el).down("table.x-grid-table")},isRowStyleFirst:function(n){var i=this,t;return n===-1?!1:(n.tagName?t=i.indexOf(n):(t=n,n=this.getNode(n)),!t||i.isGrouping&&Ext.fly(n).hasCls(Ext.baseCSSPrefix+"grid-group-row"))},getCellPaddingAfter:function(n){return Ext.fly(n).getPadding("r")}})