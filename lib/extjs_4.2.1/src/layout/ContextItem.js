Ext.define("Ext.layout.ContextItem",{requires:["Ext.layout.ClassList"],heightModel:null,widthModel:null,sizeModel:null,optOut:!1,ownerSizePolicy:null,boxChildren:null,boxParent:null,isBorderBoxValue:null,children:[],dirty:null,dirtyCount:0,hasRawContent:!0,isContextItem:!0,isTopLevel:!1,consumersContentHeight:0,consumersContentWidth:0,consumersContainerHeight:0,consumersContainerWidth:0,consumersHeight:0,consumersWidth:0,ownerCtContext:null,remainingChildDimensions:0,props:null,state:null,wrapsComponent:!1,constructor:function(n){var t=this,v=Ext.layout.SizeModel.sizeModels,y=v.configured,o=v.shrinkWrap,s,r,f,u,h,c,i,p,w,b,k,l,e,a;Ext.apply(t,n);s=t.el;t.id=s.id;t.flushedProps={};t.props=h={};t.styles={};i=t.target;i.isComponent?(t.wrapsComponent=!0,t.framing=i.frameSize||null,t.isComponentChild=i.ownerLayout&&i.ownerLayout.isComponentLayout,r=i.lastBox,f=i.ownerCt,f&&(u=f.el&&t.context.items[f.el.id])&&(t.ownerCtContext=u),t.sizeModel=c=i.getSizeModel(u&&u.widthModel.pairsByHeightOrdinal[u.heightModel.ordinal]),t.widthModel=l=c.width,t.heightModel=e=c.height,r&&r.invalid===!1&&(b=i.width===(p=r.width),k=i.height===(w=r.height),l===o&&e===o?a=!0:l===y&&b&&(a=e===o||e===y&&k),a&&(t.optOut=!0,h.width=p,h.height=w))):r=s.lastBox;t.lastBox=r},init:function(n,t){var i=this,u=i.props,e=i.dirty,r=i.ownerCtContext,y=i.target.ownerLayout,h=!i.state,p=n||h,a,c,w,b,l,f,k=i.heightModel,d=i.widthModel,o,s,v=0;if(i.dirty=i.invalid=!1,i.props={},i.remainingChildDimensions=0,i.boxChildren&&(i.boxChildren.length=0),h||(i.clearAllBlocks("blocks"),i.clearAllBlocks("domBlocks")),!i.wrapsComponent)return p;if(f=i.target,i.state={},h)f.beforeLayout&&f.beforeLayout!==Ext.emptyFn&&f.beforeLayout(),!r&&(b=f.ownerCt)&&(r=i.context.items[b.el.id]),r?(i.ownerCtContext=r,i.isBoxParent=f.ownerLayout.isItemBoxParent(i)):i.isTopLevel=!0,i.frameBodyContext=i.getEl("frameBody");else for(r=i.ownerCtContext,i.isTopLevel=!r,a=i.children,c=0,w=a.length;c<w;++c)a[c].init(!0);return i.hasRawContent=!(f.isContainer&&f.items.items.length>0),n?(i.widthModel=i.heightModel=null,l=f.getSizeModel(r&&r.widthModel.pairsByHeightOrdinal[r.heightModel.ordinal]),h&&(i.sizeModel=l),i.widthModel=l.width,i.heightModel=l.height,r&&!i.isComponentChild&&(r.remainingChildDimensions+=2)):u&&(i.recoverProp("x",u,e),i.recoverProp("y",u,e),i.widthModel.calculated?i.recoverProp("width",u,e):"width"in u&&++v,i.heightModel.calculated?i.recoverProp("height",u,e):"height"in u&&++v,r&&!i.isComponentChild&&(r.remainingChildDimensions+=v)),u&&y&&y.manageMargins&&(i.recoverProp("margin-top",u,e),i.recoverProp("margin-right",u,e),i.recoverProp("margin-bottom",u,e),i.recoverProp("margin-left",u,e)),t&&(o=t.heightModel,s=t.widthModel,s&&o&&d&&k&&d.shrinkWrap&&k.shrinkWrap&&s.constrainedMax&&o.constrainedMin&&(o=null),s&&(i.widthModel=s),o&&(i.heightModel=o),t.state&&Ext.apply(i.state,t.state)),p},initContinue:function(n){var t=this,i=t.ownerCtContext,e=t.target,r=t.widthModel,f=e.getHierarchyState(),u;return r.fixed?f.inShrinkWrapTable=!1:delete f.inShrinkWrapTable,n&&(i&&r.shrinkWrap?(u=i.isBoxParent?i:i.boxParent,u&&u.addBoxChild(t)):r.natural&&(t.boxParent=i)),n},initDone:function(n){var t=this,i=t.props,r=t.state;t.remainingChildDimensions===0&&(i.containerChildrenSizeDone=!0);n&&(i.containerLayoutDone=!0);t.boxChildren&&t.boxChildren.length&&t.widthModel.shrinkWrap&&(t.el.setWidth(1e4),r.blocks=(r.blocks||0)+1)},initAnimation:function(){var n=this,t=n.target,i=n.ownerCtContext;i&&i.isTopLevel?n.animatePolicy=t.ownerLayout.getAnimatePolicy(n):!i&&t.isCollapsingOrExpanding&&t.animCollapse&&(n.animatePolicy=t.componentLayout.getAnimatePolicy(n));n.animatePolicy&&n.context.queueAnimation(n)},addCls:function(n){this.getClassList().addMany(n)},removeCls:function(n){this.getClassList().removeMany(n)},addBlock:function(n,t,i){var r=this,u=r[n]||(r[n]={}),f=u[i]||(u[i]={});f[t.id]||(f[t.id]=t,++t.blockCount,++r.context.blockCount)},addBoxChild:function(n){var i=this,t,r=n.widthModel;n.boxParent=this;n.measuresBox=r.shrinkWrap?n.hasRawContent:r.natural;n.measuresBox&&(t=i.boxChildren,t?t.push(n):i.boxChildren=[n])},addPositionStyles:function(n,t){var r=t.x,u=t.y,i=0;return r!==undefined&&(n.left=r+"px",++i),u!==undefined&&(n.top=u+"px",++i),i},addTrigger:function(n,t){var r=this,f=t?"domTriggers":"triggers",e=r[f]||(r[f]={}),o=r.context,i=o.currentLayout,u=e[n]||(e[n]={});u[i.id]||(u[i.id]=i,++i.triggerCount,u=o.triggers[t?"dom":"data"],(u[i.id]||(u[i.id]=[])).push({item:this,prop:n}),r.props[n]!==undefined&&(t&&r.dirty&&n in r.dirty||++i.firedTriggers))},boxChildMeasured:function(){var n=this,t=n.state,i=t.boxesMeasured=(t.boxesMeasured||0)+1;i==n.boxChildren.length&&(t.clearBoxWidth=1,++n.context.progressCount,n.markDirty())},borderNames:["border-top-width","border-right-width","border-bottom-width","border-left-width"],marginNames:["margin-top","margin-right","margin-bottom","margin-left"],paddingNames:["padding-top","padding-right","padding-bottom","padding-left"],trblNames:["top","right","bottom","left"],cacheMissHandlers:{borderInfo:function(n){var t=n.getStyles(n.borderNames,n.trblNames);return t.width=t.left+t.right,t.height=t.top+t.bottom,t},marginInfo:function(n){var t=n.getStyles(n.marginNames,n.trblNames);return t.width=t.left+t.right,t.height=t.top+t.bottom,t},paddingInfo:function(n){var i=n.frameBodyContext||n,t=i.getStyles(n.paddingNames,n.trblNames);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}},checkCache:function(n){return this.cacheMissHandlers[n](this)},clearAllBlocks:function(n){var t=this[n],i;if(t)for(i in t)this.clearBlocks(n,i)},clearBlocks:function(n,t){var r=this[n],u=r&&r[t],f,i,e;if(u){delete r[t];f=this.context;for(e in u)i=u[e],--f.blockCount,--i.blockCount||i.pending||i.done||f.queueLayout(i)}},block:function(n,t){this.addBlock("blocks",n,t)},domBlock:function(n,t){this.addBlock("domBlocks",n,t)},fireTriggers:function(n,t){var u=this[n],r=u&&u[t],e=this.context,i,f;if(r)for(f in r)i=r[f],++i.firedTriggers,i.done||i.blockCount||i.pending||e.queueLayout(i)},flush:function(){var n=this,i=n.dirty,t=n.state,r=n.el;n.dirtyCount=0;n.classList&&n.classList.dirty&&n.classList.flush();"attributes"in n&&(r.set(n.attributes),delete n.attributes);"innerHTML"in n&&(r.innerHTML=n.innerHTML,delete n.innerHTML);t&&t.clearBoxWidth&&(t.clearBoxWidth=0,n.el.setStyle("width",null),--t.blocks||n.context.queueItemLayouts(n));i&&(delete n.dirty,n.writeProps(i,!0))},flushAnimations:function(){var n=this,c=n.previousSize,i,r,l,e,u,o,f,a,t,s,h;if(c){for(i=n.target,r=i.layout&&i.layout.animate,r&&(l=Ext.isNumber(r)?r:r.duration),e=Ext.Object.getKeys(n.animatePolicy),u=Ext.apply({},{from:{},to:{},duration:l||Ext.fx.Anim.prototype.duration},r),o=0,f=0,a=e.length;f<a;f++)t=e[f],s=c[t],h=n.peek(t),s!=h&&(t=n.translateProps[t]||t,u.from[t]=s,u.to[t]=h,++o);if(o){n.isCollapsingOrExpanding===1?i.componentLayout.undoLayout(n):n.writeProps(u.from);n.el.animate(u);Ext.fx.Manager.getFxQueue(n.el.id)[0].on({afteranimate:function(){n.isCollapsingOrExpanding===1?(i.componentLayout.redoLayout(n),i.afterCollapse(!0)):n.isCollapsingOrExpanding===2&&i.afterExpand(!0)}})}}},getBorderInfo:function(){var n=this,t=n.borderInfo;return t||(n.borderInfo=t=n.checkCache("borderInfo")),t},getClassList:function(){return this.classList||(this.classList=new Ext.layout.ClassList(this))},getEl:function(n,t){var r=this,u,i,f;if(n){if(n.dom)i=n;else if(u=r.target,t&&(u=t),i=u[n],typeof i=="function"&&(i=i.call(u),i===r.el))return this;i&&(f=r.context.getEl(r,i))}return f||null},getFrameInfo:function(){var i=this,r=i.frameInfo,n,t;return r||(n=i.framing,t=i.getBorderInfo(),i.frameInfo=r=n?{top:n.top+t.top,right:n.right+t.right,bottom:n.bottom+t.bottom,left:n.left+t.left,width:n.width+t.width,height:n.height+t.height}:t),r},getMarginInfo:function(){var t=this,n=t.marginInfo,i,e,r,u,f;return n||(t.wrapsComponent?(i=t.target,u=i.ownerLayout,f=u?u.id:null,e=u&&u.manageMargins,n=i.margin$,n&&n.ownerId!==f&&(n=null),n||(n=t.parseMargins(i,i.margin)||t.checkCache("marginInfo"),e&&(r=t.parseMargins(i,i.margins,u.defaultMargins),r&&(n={top:n.top+r.top,right:n.right+r.right,bottom:n.bottom+r.bottom,left:n.left+r.left}),t.setProp("margin-top",0),t.setProp("margin-right",0),t.setProp("margin-bottom",0),t.setProp("margin-left",0)),n.ownerId=f,i.margin$=n),n.width=n.left+n.right,n.height=n.top+n.bottom):n=t.checkCache("marginInfo"),t.marginInfo=n),n},clearMarginCache:function(){delete this.marginInfo;delete this.target.margin$},getPaddingInfo:function(){var n=this,t=n.paddingInfo;return t||(n.paddingInfo=t=n.checkCache("paddingInfo")),t},getProp:function(n){var t=this,i=t.props[n];return t.addTrigger(n),i},getDomProp:function(n){var t=this,i=t.dirty&&n in t.dirty?undefined:t.props[n];return t.addTrigger(n,!0),i},getStyle:function(n){var i=this,r=i.styles,u,t;return n in r?t=r[n]:(u=i.styleInfo[n],t=i.el.getStyle(n),u&&u.parseInt&&(t=parseInt(t,10)||0),r[n]=t),t},getStyles:function(n,t){var s=this,h=s.styles,c={},o=0,a=n.length,i,r,f,u,l,v,y,e;for(t=t||n,i=0;i<a;++i)u=n[i],u in h?(c[t[i]]=h[u],++o,i&&o==1&&(r=n.slice(0,i),f=t.slice(0,i))):o&&((r||(r=[])).push(u),(f||(f=[])).push(t[i]));if(o<a)for(r=r||n,f=f||t,v=s.styleInfo,y=s.el.getStyle(r),i=r.length;i--;)u=r[i],l=v[u],e=y[u],l&&l.parseInt&&(e=parseInt(e,10)||0),c[f[i]]=e,h[u]=e;return c},hasProp:function(n){return this.getProp(n)!=null},hasDomProp:function(n){return this.getDomProp(n)!=null},invalidate:function(n){this.context.queueInvalidate(this,n)},markDirty:function(){++this.dirtyCount==1&&this.context.queueFlush(this)},onBoxMeasured:function(){var n=this.boxParent,t=this.state;n&&n.widthModel.shrinkWrap&&!t.boxMeasured&&this.measuresBox&&(t.boxMeasured=1,n.boxChildMeasured())},parseMargins:function(n,t,i){t===!0&&(t=5);var u=typeof t,r;return u=="string"||u=="number"?r=n.parseBox(t):(t||i)&&(r={top:0,right:0,bottom:0,left:0},i&&Ext.apply(r,this.parseMargins(n,i)),t&&(t=Ext.apply(r,n.parseBox(t)))),r},peek:function(n){return this.props[n]},recoverProp:function(n,t,i){var r=this,f=r.props,u;n in t&&(f[n]=t[n],i&&n in i&&(u=r.dirty||(r.dirty={}),u[n]=i[n]))},redo:function(n){var i=this,r,u,t;if(i.revertProps(i.props),n&&i.wrapsComponent){if(i.childItems)for(t=0,r=i.childItems,u=r.length;t<u;t++)r[t].redo(n);for(t=0,r=i.children,u=r.length;t<u;t++)r[t].redo()}},removeEl:function(n,t){var r=this,u,i;if(n){if(n.dom)i=n;else if(u=r.target,t&&(u=t),i=u[n],typeof i=="function"&&(i=i.call(u),i===r.el))return this;i&&r.context.removeEl(r,i)}},revertProps:function(n){var t,r=this.flushedProps,i={};for(t in n)r.hasOwnProperty(t)&&(i[t]=n[t]);this.writeProps(i)},setAttribute:function(n,t){var i=this;i.attributes||(i.attributes={});i.attributes[n]=t;i.markDirty()},setBox:function(n){var t=this;"left"in n&&t.setProp("x",n.left);"top"in n&&t.setProp("y",n.top);t.setSize(n.width,n.height)},setContentHeight:function(n,t){return!t&&this.hasRawContent?1:this.setProp("contentHeight",n)},setContentWidth:function(n,t){return!t&&this.hasRawContent?1:this.setProp("contentWidth",n)},setContentSize:function(n,t,i){return this.setContentWidth(n,i)+this.setContentHeight(t,i)==2},setProp:function(n,t,i){var r=this,f=typeof t,u,e;return f=="undefined"||f==="number"&&isNaN(t)?0:r.props[n]===t?1:(r.props[n]=t,++r.context.progressCount,i===!1?(r.fireTriggers("domTriggers",n),r.clearBlocks("domBlocks",n)):(e=r.styleInfo[n],e&&(r.dirty||(r.dirty={}),(n=="width"||n=="height")&&(u=r.isBorderBoxValue,u===null&&(r.isBorderBoxValue=u=!!r.el.isBorderBox()),u||(r.borderInfo||r.getBorderInfo(),r.paddingInfo||r.getPaddingInfo())),r.dirty[n]=t,r.markDirty())),r.fireTriggers("triggers",n),r.clearBlocks("blocks",n),1)},setHeight:function(n,t){var i=this,f=i.target,r=i.ownerCtContext,u,e,o,s,h;if(n<0&&(n=0),i.wrapsComponent){if(o=i.collapsedVert?0:f.minHeight||0,n=Ext.Number.constrain(n,o,f.maxHeight),s=i.props.height,!i.setProp("height",n,t))return NaN;r&&!i.isComponentChild&&isNaN(s)&&(h=--r.remainingChildDimensions,h||r.setProp("containerChildrenSizeDone",!0));u=i.frameBodyContext;u&&(e=i.getFrameInfo(),u.setHeight(n-e.height,t))}else if(!i.setProp("height",n,t))return NaN;return n},setWidth:function(n,t){var i=this,f=i.target,r=i.ownerCtContext,u,e,o,s,h;if(n<0&&(n=0),i.wrapsComponent){if(o=i.collapsedHorz?0:f.minWidth||0,n=Ext.Number.constrain(n,o,f.maxWidth),s=i.props.width,!i.setProp("width",n,t))return NaN;r&&!i.isComponentChild&&isNaN(s)&&(h=--r.remainingChildDimensions,h||r.setProp("containerChildrenSizeDone",!0));u=i.frameBodyContext;u&&(e=i.getFrameInfo(),u.setWidth(n-e.width,t))}else if(!i.setProp("width",n,t))return NaN;return n},setSize:function(n,t,i){this.setWidth(n,i);this.setHeight(t,i)},translateProps:{x:"left",y:"top"},undo:function(n){var i=this,r,u,t;if(i.revertProps(i.lastBox),n&&i.wrapsComponent){if(i.childItems)for(t=0,r=i.childItems,u=r.length;t<u;t++)r[t].undo(n);for(t=0,r=i.children,u=r.length;t<u;t++)r[t].undo()}},unsetProp:function(n){var t=this.dirty;delete this.props[n];t&&delete t[n]},writeProps:function(n,t){if(!(n&&typeof n=="object")){Ext.Logger.warn("writeProps expected dirtyProps to be an object");return}var i=this,v=i.el,e={},o=0,nt=i.styleInfo,h,f,y,r=n.width,u=n.height,tt=i.isBorderBoxValue,p=i.target,w=Math.max,b=0,k=0,d,g,s,l,c,a;"displayed"in n&&v.setDisplayed(n.displayed);for(f in n)t&&(i.fireTriggers("domTriggers",f),i.clearBlocks("domBlocks",f),i.flushedProps[f]=1),h=nt[f],h&&h.dom&&(e[f]=h.suffix&&(y=parseInt(n[f],10))?y+h.suffix:n[f],++o);if(("x"in n||"y"in n)&&(p.isComponent?p.setPosition(n.x,n.y):o+=i.addPositionStyles(e,n)),!tt&&(r>0||u>0)){if(!(i.borderInfo&&i.paddingInfo))throw Error("Needed to have gotten the borderInfo and paddingInfo when the width or height was setProp'd");i.frameBodyContext||(b=i.paddingInfo.width,k=i.paddingInfo.height);r&&(r=w(parseInt(r,10)-(i.borderInfo.width+b),0),e.width=r+"px",++o);u&&(u=w(parseInt(u,10)-(i.borderInfo.height+k),0),e.height=u+"px",++o)}i.wrapsComponent&&Ext.isIE9&&Ext.isStrict&&((d=r!==undefined&&i.hasOverflowY)||(g=u!==undefined&&i.hasOverflowX))&&(s=i.isAbsolute,s===undefined&&(s=!1,a=i.target.getTargetEl(),c=a.getStyle("position"),c=="absolute"&&(c=a.getStyle("box-sizing"),s=c=="border-box"),i.isAbsolute=s),s&&(l=Ext.getScrollbarSize(),d&&(r=parseInt(r,10)+l.width,e.width=r+"px",++o),g&&(u=parseInt(u,10)+l.height,e.height=u+"px",++o)));o&&v.setStyle(e)}},function(){var n={dom:!0,parseInt:!0,suffix:"px"},i={dom:!0},t={dom:!1};this.prototype.styleInfo={containerChildrenSizeDone:t,containerLayoutDone:t,displayed:t,done:t,x:t,y:t,columnWidthsDone:t,left:n,top:n,right:n,bottom:n,width:n,height:n,"border-top-width":n,"border-right-width":n,"border-bottom-width":n,"border-left-width":n,"margin-top":n,"margin-right":n,"margin-bottom":n,"margin-left":n,"padding-top":n,"padding-right":n,"padding-bottom":n,"padding-left":n,"line-height":i,display:i}})