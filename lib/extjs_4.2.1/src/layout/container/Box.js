Ext.define("Ext.layout.container.Box",{alias:["layout.box"],extend:"Ext.layout.container.Container",alternateClassName:"Ext.layout.BoxLayout",requires:["Ext.layout.container.boxOverflow.None","Ext.layout.container.boxOverflow.Menu","Ext.layout.container.boxOverflow.Scroller","Ext.util.Format","Ext.dd.DragDropManager"],defaultMargins:{top:0,right:0,bottom:0,left:0},padding:0,pack:"start",flex:undefined,stretchMaxPartner:undefined,alignRoundingMethod:"round",type:"box",scrollOffset:0,itemCls:Ext.baseCSSPrefix+"box-item",targetCls:Ext.baseCSSPrefix+"box-layout-ct",targetElCls:Ext.baseCSSPrefix+"box-target",innerCls:Ext.baseCSSPrefix+"box-inner",availableSpaceOffset:0,reserveOffset:!0,manageMargins:!0,createsInnerCt:!0,childEls:["innerCt","targetEl"],renderTpl:["{%var oc,l=values.$comp.layout,oh=l.overflowHandler;","if (oh.getPrefixConfig!==Ext.emptyFn) {","if(oc=oh.getPrefixConfig())dh.generateMarkup(oc, out)","}%}",'<div id="{ownerId}-innerCt" class="{[l.innerCls]} {[oh.getOverflowCls()]}" role="presentation">','<div id="{ownerId}-targetEl" class="{targetElCls}">',"{%this.renderBody(out, values)%}","<\/div>","<\/div>","{%if (oh.getSuffixConfig!==Ext.emptyFn) {","if(oc=oh.getSuffixConfig())dh.generateMarkup(oc, out)","}%}",{disableFormats:!0,definitions:"var dh=Ext.DomHelper;"}],constructor:function(){var n=this,t;n.callParent(arguments);n.flexSortFn=Ext.Function.bind(n.flexSort,n);n.initOverflowHandler();t=typeof n.padding;(t=="string"||t=="number")&&(n.padding=Ext.util.Format.parseBox(n.padding),n.padding.height=n.padding.top+n.padding.bottom,n.padding.width=n.padding.left+n.padding.right)},_percentageRe:/^\s*(\d+(?:\.\d*)?)\s*[%]\s*$/,getItemSizePolicy:function(n,t){var i=this,u=i.sizePolicy,f=i.align,s=n.flex,e=f,r=i.names,y=n[r.width],h=n[r.height],o=i._percentageRe,c=o.test(y),l=f=="stretch",a=f=="stretchmax",v=i.constrainAlign;return!t&&(l||s||c||v&&!a)&&(t=i.owner.getSizeModel()),l?!o.test(h)&&t[r.height].shrinkWrap&&(e="stretchmax"):a||(e=o.test(h)?"stretch":v&&!t[r.height].shrinkWrap?"stretchmax":""),(s||c)&&(t[r.width].shrinkWrap||(u=u.flex)),u[e]},flexSort:function(n,t){var h=this.names.maxWidth,c=this.names.minWidth,l=Infinity,a=n.target,v=t.target,i=0,r,u,f,e,o,s;return f=a[h]||l,e=v[h]||l,r=a[c]||0,u=v[c]||0,o=isFinite(r)||isFinite(u),s=isFinite(f)||isFinite(e),(o||s)&&(s&&(i=f-e),i===0&&o&&(i=u-r)),i},isItemBoxParent:function(){return!0},isItemShrinkWrap:function(){return!0},roundFlex:function(n){return Math.ceil(n)},beginCollapse:function(n){var t=this;t.direction==="vertical"&&n.collapsedVertical()?(n.collapseMemento.capture(["flex"]),delete n.flex):t.direction==="horizontal"&&n.collapsedHorizontal()&&(n.collapseMemento.capture(["flex"]),delete n.flex)},beginExpand:function(n){n.collapseMemento.restore(["flex"])},beginLayout:function(n){var t=this,r=t.owner,i=r.stretchMaxPartner,f=t.innerCt.dom.style,u=t.names;n.boxNames=u;t.overflowHandler.beginLayout(n);typeof i=="string"&&(i=Ext.getCmp(i)||r.query(i)[0]);n.stretchMaxPartner=i&&n.context.getCmp(i);t.callParent(arguments);n.innerCtContext=n.getEl("innerCt",t);t.scrollParallel=r.scrollFlags[u.x];t.scrollPerpendicular=r.scrollFlags[u.y];t.scrollParallel&&(t.scrollPos=r.getTargetEl().dom[u.scrollLeft]);f.width="";f.height=""},beginLayoutCycle:function(n,t){var r=this,i=r.align,f=n.boxNames,u=r.pack,e=f.heightModel;r.overflowHandler.beginLayoutCycle(n,t);r.callParent(arguments);n.parallelSizeModel=n[f.widthModel];n.perpendicularSizeModel=n[e];n.boxOptions={align:i={stretch:i=="stretch",stretchmax:i=="stretchmax",center:i==f.center,bottom:i==f.afterY},pack:u={center:u=="center",end:u=="end"}};i.stretch&&n.perpendicularSizeModel.shrinkWrap&&(i.stretchmax=!0,i.stretch=!1);i.nostretch=!(i.stretch||i.stretchmax);n.parallelSizeModel.shrinkWrap&&(u.center=u.end=!1);r.cacheFlexes(n);r.targetEl.setWidth(2e4)},cacheFlexes:function(n){for(var o=this,i=n.boxNames,p=i.widthModel,w=i.heightModel,b=n.boxOptions.align.nostretch,s=0,h=n.childItems,c=h.length,f=[],l=0,k=i.minWidth,a=o._percentageRe,v=0,y=0,r,t,e,u;c--;)t=h[c],r=t.target,t[p].calculated&&(t.flex=e=r.flex,e?(s+=e,f.push(t),l+=r[k]||0):(u=a.exec(r[i.width]),t.percentageParallel=parseFloat(u[1])/100,++v)),b&&t[w].calculated&&(u=a.exec(r[i.height]),t.percentagePerpendicular=parseFloat(u[1])/100,++y);n.flexedItems=f;n.flexedMinSize=l;n.totalFlex=s;n.percentageWidths=v;n.percentageHeights=y;Ext.Array.sort(f,o.flexSortFn)},calculate:function(n){var t=this,f=t.getContainerSize(n),u=n.boxNames,i=n.state,r=i.boxPlan||(i.boxPlan={}),e=n.targetContext;if(r.targetSize=f,!n.parallelSizeModel.shrinkWrap&&!f[u.gotWidth]){t.done=!1;return}i.parallelDone||(i.parallelDone=t.calculateParallel(n,u,r));i.perpendicularDone||(i.perpendicularDone=t.calculatePerpendicular(n,u,r));i.parallelDone&&i.perpendicularDone?(t.owner.dock&&(Ext.isIE7m||Ext.isIEQuirks)&&!t.owner.width&&!t.horizontal&&(r.isIEVerticalDock=!0,r.calculatedWidth=r.maxSize+n.getPaddingInfo().width+n.getFrameInfo().width,e!==n&&(r.calculatedWidth+=e.getPaddingInfo().width)),t.publishInnerCtSize(n,t.reserveOffset?t.availableSpaceOffset:0),t.done&&(n.childItems.length>1||n.stretchMaxPartner)&&n.boxOptions.align.stretchmax&&!i.stretchMaxDone&&(t.calculateStretchMax(n,u,r),i.stretchMaxDone=!0),t.overflowHandler.calculate(n)):t.done=!1},calculateParallel:function(n,t,i){var e=this,l=t.width,a=n.childItems,g=t.beforeX,nt=t.afterX,ot=t.setWidth,p=a.length,tt=n.flexedItems,st=tt.length,it=n.boxOptions.pack,rt=e.padding,ut=i.targetSize[l],w=0,f=rt[g],o=f+rt[nt]+e.scrollOffset+(e.reserveOffset?e.availableSpaceOffset:0),ft=Ext.getScrollbarSize()[t.width],r,v,s,b,u,k,y,h,et,c,d;if(ft&&e.scrollPerpendicular&&n.parallelSizeModel.shrinkWrap&&!n.boxOptions.align.stretch&&!n.perpendicularSizeModel.shrinkWrap){if(!n.state.perpendicularDone)return!1;et=!0}for(r=0;r<p;++r)if(u=a[r],v=u.marginInfo||u.getMarginInfo(),w+=v[l],!u[t.widthModel].calculated&&(c=u.getProp(l),o+=c,isNaN(o)))return!1;if(o+=w,n.percentageWidths){if(d=ut-w,isNaN(d))return!1;for(r=0;r<p;++r)u=a[r],u.percentageParallel&&(c=Math.ceil(d*u.percentageParallel),c=u.setWidth(c),o+=c)}if(n.parallelSizeModel.shrinkWrap)i.availableSpace=0,i.tooNarrow=!1;else if(i.availableSpace=ut-o,i.tooNarrow=i.availableSpace<n.flexedMinSize,i.tooNarrow&&Ext.getScrollbarSize()[t.height]&&e.scrollParallel&&n.state.perpendicularDone)for(n.state.perpendicularDone=!1,r=0;r<p;++r)a[r].invalidate();for(h=o,s=i.availableSpace,b=n.totalFlex,r=0;r<st;r++)u=tt[r],k=u.flex,y=e.roundFlex(k/b*s),y=u[ot](y),h+=y,s=Math.max(0,s-y),b-=k;for(it.center?(f+=s/2,f<0&&(f=0)):it.end&&(f+=s),r=0;r<p;++r)u=a[r],v=u.marginInfo,f+=v[g],u.setProp(t.x,f),f+=v[nt]+u.props[l];return h+=n.targetContext.getPaddingInfo()[l],n.state.contentWidth=h,et&&n.peek(t.contentHeight)>i.targetSize[t.height]&&(h+=ft,n[t.hasOverflowY]=!0,n.target.componentLayout[t.setWidthInDom]=!0,n[t.invalidateScrollY]=Ext.isStrict&&Ext.isIE8),n[t.setContentWidth](h),!0},calculatePerpendicular:function(n,t,i){var o=this,l=n.perpendicularSizeModel.shrinkWrap,lt=i.targetSize,d=n.childItems,et=d.length,p=Math.max,f=t.height,at=t.setHeight,ot=t.beforeY,vt=t.y,st=o.padding,g=st[ot],s=lt[f]-g-st[t.afterY],w=n.boxOptions.align,nt=w.stretch,yt=w.stretchmax,tt=w.center,it=w.bottom,ht=o.constrainAlign,u=0,ct=0,pt=o.onBeforeConstrainInvalidateChild,wt=o.onAfterConstrainInvalidateChild,b=Ext.getScrollbarSize().height,v,h,e,c,rt,a,r,k,ut,ft,y;if((nt||(tt||it)&&!l)&&isNaN(s))return!1;if(o.scrollParallel&&i.tooNarrow&&(l?ft=!0:(s-=b,i.targetSize[f]-=b)),nt)a=s;else{for(h=0;h<et;h++){if(r=d[h],c=(r.marginInfo||r.getMarginInfo())[f],y=r.percentagePerpendicular)if(++ct,l)continue;else e=y*s-c,e=r[t.setHeight](e);else e=r.getProp(f);if(!l&&ht&&r[t.heightModel].shrinkWrap&&e>s&&(r.invalidate({before:pt,after:wt,layout:o,childHeight:s,names:t}),n.state.parallelDone=!1),isNaN(u=p(u,e+c,r.target[t.minHeight]||0)))return!1}if(ft&&(u+=b,n[t.hasOverflowX]=!0,n.target.componentLayout[t.setHeightInDom]=!0,n[t.invalidateScrollX]=Ext.isStrict&&Ext.isIE8),k=n.stretchMaxPartner,k&&(n.setProp("maxChildHeight",u),ut=k.childItems,ut&&ut.length&&(u=p(u,k.getProp("maxChildHeight")),isNaN(u))))return!1;n[t.setContentHeight](u+o.padding[f]+n.targetContext.getPaddingInfo()[f]);ft&&(u-=b);i.maxSize=u;yt?a=u:(tt||it||ct)&&(a=(ht?l?u:s:l?u:p(s,u))-n.innerCtContext.getBorderInfo()[f])}for(h=0;h<et;h++)r=d[h],c=r.marginInfo||r.getMarginInfo(),v=g+c[ot],nt?r[at](a-c[f]):(y=r.percentagePerpendicular,l&&y&&(c=r.marginInfo||r.getMarginInfo(),e=y*a-c[f],e=r.setHeight(e)),tt?(rt=a-r.props[f],rt>0&&(v=g+Math[o.alignRoundingMethod](rt/2))):it&&(v=p(0,a-v-r.props[f]))),r.setProp(vt,v);return!0},onBeforeConstrainInvalidateChild:function(n,t){var i=t.names.heightModel;n[i].constrainedMin||(n[i]=Ext.layout.SizeModel.calculated)},onAfterConstrainInvalidateChild:function(n,t){var i=t.names;n.setProp(i.beforeY,0);n[i.heightModel].calculated&&n[i.setHeight](t.childHeight)},calculateStretchMax:function(n,t,i){for(var e=this,s=t.height,c=t.width,h=n.childItems,l=h.length,a=i.maxSize,v=e.onBeforeStretchMaxInvalidateChild,y=e.onAfterStretchMaxInvalidateChild,r,u,o,f=0;f<l;++f)r=h[f],u=r.props,o=a-r.getMarginInfo()[s],(o!=u[s]||r[t.heightModel].constrained)&&r.invalidate({before:v,after:y,layout:e,childWidth:u[c],childHeight:o,childX:u.x,childY:u.y,names:t})},onBeforeStretchMaxInvalidateChild:function(n,t){var i=t.names.heightModel;n[i].constrainedMax||(n[i]=Ext.layout.SizeModel.calculated)},onAfterStretchMaxInvalidateChild:function(n,t){var i=t.names,r=t.childHeight,u=t.childWidth;n.setProp("x",t.childX);n.setProp("y",t.childY);n[i.heightModel].calculated&&n[i.setHeight](r);n[i.widthModel].calculated&&n[i.setWidth](u)},completeLayout:function(n){var i=this,h=n.boxNames,r=n.invalidateScrollX,u=n.invalidateScrollY,s,f,e,o,t;i.overflowHandler.completeLayout(n);(r||u)&&(f=i.getTarget(),s=f.dom,t=s.style,r&&(e=f.getStyle("overflowX"),e=="auto"?(e=t.overflowX,t.overflowX="scroll"):r=!1),u&&(o=f.getStyle("overflowY"),o=="auto"?(o=t.overflowY,t.overflowY="scroll"):u=!1),(r||u)&&(s.scrollWidth,r&&(t.overflowX=e),u&&(t.overflowY=o)));i.scrollParallel&&(i.owner.getTargetEl().dom[h.scrollLeft]=i.scrollPos)},finishedLayout:function(n){this.overflowHandler.finishedLayout(n);this.callParent(arguments);this.targetEl.setWidth(n.innerCtContext.props.width)},publishInnerCtSize:function(n,t){var f=this,i=n.boxNames,s=i.height,h=i.width,e=n.boxOptions.align,c=f.owner.dock,l=f.padding,u=n.state.boxPlan,a=u.targetSize,v=a[s],o=n.innerCtContext,y=(n.parallelSizeModel.shrinkWrap||u.tooNarrow&&f.scrollParallel?n.state.contentWidth-n.targetContext.getPaddingInfo()[h]:a[h])-(t||0),r;e.stretch?r=v:(r=u.maxSize+l[i.beforeY]+l[i.afterY]+o.getBorderInfo()[s],!n.perpendicularSizeModel.shrinkWrap&&(e.center||e.bottom)&&(r=Math.max(v,r)));o[i.setWidth](y);o[i.setHeight](r);isNaN(y+r)&&(f.done=!1);u.calculatedWidth&&(c=="left"||c=="right")&&n.setWidth(u.calculatedWidth,!0,!0)},onRemove:function(n){var t=this;if(t.callParent(arguments),t.overflowHandler)t.overflowHandler.onRemove(n);n.layoutMarginCap==t.id&&delete n.layoutMarginCap},initOverflowHandler:function(){var t=this,n=t.overflowHandler,i,r;typeof n=="string"&&(n={type:n});i="None";n&&n.type!==undefined&&(i=n.type);r=Ext.layout.container.boxOverflow[i];r[t.type]&&(r=r[t.type]);t.overflowHandler=Ext.create("Ext.layout.container.boxOverflow."+i,t,n)},getRenderTarget:function(){return this.targetEl},getElementTarget:function(){return this.innerCt},calculateChildBox:Ext.deprecated(),calculateChildBoxes:Ext.deprecated(),updateChildBoxes:Ext.deprecated(),destroy:function(){Ext.destroy(this.innerCt,this.overflowHandler);this.callParent(arguments)},getRenderData:function(){var n=this.callParent();return n.targetElCls=this.targetElCls,n}})