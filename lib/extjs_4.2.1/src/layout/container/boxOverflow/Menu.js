Ext.define("Ext.layout.container.boxOverflow.Menu",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],alternateClassName:"Ext.layout.boxOverflow.Menu",noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items">(None)<\/div>',constructor:function(){var n=this;n.callParent(arguments);n.triggerButtonCls=n.triggerButtonCls||Ext.baseCSSPrefix+"box-menu-after";n.menuItems=[]},beginLayout:function(n){this.callParent(arguments);this.clearOverflow(n)},beginLayoutCycle:function(n,t){this.callParent(arguments);t||(this.clearOverflow(n),this.layout.cacheChildItems(n))},onRemove:function(n){Ext.Array.remove(this.menuItems,n)},getSuffixConfig:function(){var n=this,i=n.layout,t=i.owner,r=t.id;return n.menu=new Ext.menu.Menu({listeners:{scope:n,beforeshow:n.beforeMenuShow}}),n.menuTrigger=new Ext.button.Button({id:r+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+n.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item",plain:t.usePlainButtons,ownerCt:t,ownerLayout:i,iconCls:Ext.baseCSSPrefix+n.getOwnerType(t)+"-more-icon",ui:t instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",menu:n.menu,showEmptyMenu:!0,getSplitCls:function(){return""}}),n.menuTrigger.getRenderTree()},getOverflowCls:function(){return Ext.baseCSSPrefix+this.layout.direction+"-box-overflow-body"},handleOverflow:function(n){var t=this,u=t.layout,i=u.names,f=n.state.boxPlan,r=[null,null];return t.showTrigger(n),t.layout.direction!=="vertical"&&(r[i.heightIndex]=(f.maxSize-t.menuTrigger[i.getHeight]())/2,t.menuTrigger.setPosition.apply(t.menuTrigger,r)),{reservedSpace:t.triggerTotalWidth}},captureChildElements:function(){var t=this,n=t.menuTrigger,i=t.layout.names;n.rendering&&(n.finishRender(),t.triggerTotalWidth=n[i.getWidth]()+n.el.getMargin(i.parallelMargins))},_asLayoutRoot:{isRoot:!0},clearOverflow:function(){var n=this,i=n.menuItems,t,r=0,f=i.length,u=n.layout.owner,e=n._asLayoutRoot;for(u.suspendLayouts(),n.captureChildElements(),n.hideTrigger(),u.resumeLayouts();r<f;r++)t=i[r],t.suspendLayouts(),t.show(),t.resumeLayouts(e);i.length=0},showTrigger:function(n){var t=this,o=t.layout,s=o.owner,h=o.names,v=h.x,c=h.width,y=n.state.boxPlan,l=y.targetSize[c],a=n.childItems,p=a.length,r=t.menuTrigger,u,f,i,e;for(r.suspendLayouts(),r.show(),r.resumeLayouts(t._asLayoutRoot),l-=t.triggerTotalWidth,s.suspendLayouts(),t.menuItems.length=0,i=0;i<p;i++)u=a[i],e=u.props,e[v]+e[c]>l&&(f=u.target,t.menuItems.push(f),f.hide());s.resumeLayouts()},hideTrigger:function(){var n=this.menuTrigger;n&&n.hide()},beforeMenuShow:function(n){var i=this,f=i.menuItems,r=0,o=f.length,t,u,e=function(n,t){return n.isXType("buttongroup")&&!(t instanceof Ext.toolbar.Separator)};for(n.suspendLayouts(),i.clearMenu(),n.removeAll();r<o;r++)(t=f[r],!r&&t instanceof Ext.toolbar.Separator)||(u&&(e(t,u)||e(u,t))&&n.add("-"),i.addComponentToMenu(n,t),u=t);n.items.length<1&&n.add(i.noItemsMenuText);n.resumeLayouts()},createMenuConfig:function(n,t){var r=this,i=Ext.apply({},n.initialConfig),u=n.toggleGroup;if(Ext.copyTo(i,n,["iconCls","icon","itemId","disabled","handler","scope","menu","tabIndex"]),Ext.apply(i,{text:n.overflowText||n.text,hideOnClick:t,destroyMenu:!1,listeners:{}}),n.isFormField?(i.value=n.getValue(),i.listeners.change=function(t,i){n.setValue(i)}):(u||n.enableToggle)&&Ext.apply(i,{hideOnClick:!1,group:u,checked:n.pressed,handler:function(t,i){n.onClick(i)}}),n.isButton&&!n.changeListenersAdded){n.on({textchange:r.onButtonAttrChange,iconchange:r.onButtonAttrChange,toggle:r.onButtonToggle});n.changeListenersAdded=!0}return delete i.margin,delete i.ownerCt,delete i.xtype,delete i.id,delete i.itemId,i},onButtonAttrChange:function(n){var t=n.overflowClone;t.suspendLayouts();t.setText(n.text);t.setIcon(n.icon);t.setIconCls(n.iconCls);t.resumeLayouts(!0)},onButtonToggle:function(n,t){n.overflowClone.checked!==t&&n.overflowClone.setChecked(t)},addComponentToMenu:function(n,t){var i=this,r,u,f;if(t instanceof Ext.toolbar.Separator)n.add("-");else if(t.isComponent)if(t.isXType("splitbutton"))t.overflowClone=n.add(i.createMenuConfig(t,!0));else if(t.isXType("button"))t.overflowClone=n.add(i.createMenuConfig(t,!t.menu));else if(t.isXType("buttongroup"))for(u=t.items.items,f=u.length,r=0;r<f;r++)i.addComponentToMenu(n,u[r]);else t.overflowClone=n.add(Ext.create(Ext.getClassName(t),i.createMenuConfig(t)))},clearMenu:function(){var t=this.menu,i,n,u,r;if(t&&t.items)for(i=t.items.items,u=i.length,n=0;n<u;n++)r=i[n],r.setMenu&&r.setMenu(null)},destroy:function(){var n=this.menuTrigger;n&&!this.layout.owner.items.contains(n)&&delete n.ownerCt;Ext.destroy(this.menu,n)}})