Ext.define("Ext.layout.component.Dock",{extend:"Ext.layout.component.Component",alias:"layout.dock",alternateClassName:"Ext.layout.component.AbstractDock",type:"dock",horzAxisProps:{name:"horz",oppositeName:"vert",dockBegin:"left",dockEnd:"right",horizontal:!0,marginBegin:"margin-left",maxSize:"maxWidth",minSize:"minWidth",pos:"x",setSize:"setWidth",shrinkWrapDock:"shrinkWrapDockWidth",size:"width",sizeModel:"widthModel"},vertAxisProps:{name:"vert",oppositeName:"horz",dockBegin:"top",dockEnd:"bottom",horizontal:!1,marginBegin:"margin-top",maxSize:"maxHeight",minSize:"minHeight",pos:"y",setSize:"setHeight",shrinkWrapDock:"shrinkWrapDockHeight",size:"height",sizeModel:"heightModel"},initializedBorders:-1,horizontalCollapsePolicy:{width:!0,x:!0},verticalCollapsePolicy:{height:!0,y:!0},finishRender:function(){var n=this,t,i;n.callParent();t=n.getRenderTarget();i=n.getDockedItems();n.finishRenderItems(t,i)},isItemBoxParent:function(){return!0},isItemShrinkWrap:function(){return!0},noBorderClasses:[Ext.baseCSSPrefix+"docked-noborder-top",Ext.baseCSSPrefix+"docked-noborder-right",Ext.baseCSSPrefix+"docked-noborder-bottom",Ext.baseCSSPrefix+"docked-noborder-left"],noBorderClassesSides:{top:Ext.baseCSSPrefix+"docked-noborder-top",right:Ext.baseCSSPrefix+"docked-noborder-right",bottom:Ext.baseCSSPrefix+"docked-noborder-bottom",left:Ext.baseCSSPrefix+"docked-noborder-left"},borderWidthProps:{top:"border-top-width",right:"border-right-width",bottom:"border-bottom-width",left:"border-left-width"},handleItemBorders:function(){var t=this,u=t.owner,n,s,h=t.lastDockedItems,c=t.borders,l=u.dockedItems.generation,a=t.noBorderClassesSides,v=t.borderWidthProps,i,o,r,e,f,y=t.collapsed;if(t.initializedBorders!=l&&(!u.border||u.manageBodyBorders)){for(t.initializedBorders=l,t.collapsed=!1,t.lastDockedItems=s=t.getLayoutItems(),t.collapsed=y,n={top:[],right:[],bottom:[],left:[]},i=0,o=s.length;i<o;i++)(r=s[i],e=r.dock,r.ignoreBorderManagement)||(n[e].satisfied||(n[e].push(r),n[e].satisfied=!0),n.top.satisfied||e==="bottom"||n.top.push(r),n.right.satisfied||e==="left"||n.right.push(r),n.bottom.satisfied||e==="top"||n.bottom.push(r),n.left.satisfied||e==="right"||n.left.push(r));if(h)for(i=0,o=h.length;i<o;i++)r=h[i],r.isDestroyed||r.ignoreBorderManagement||u.manageBodyBorders||r.removeCls(t.noBorderClasses);if(c)for(f in c)u.manageBodyBorders&&c[f].satisfied&&u.setBodyStyle(v[f],"");for(f in n)if(o=n[f].length,u.manageBodyBorders)n[f].satisfied&&u.setBodyStyle(v[f],"1px");else{for(i=0;i<o;i++)n[f][i].addCls(a[f]);(n[f].satisfied||u.bodyBorder)&&u.bodyBorder!==!1||u.addBodyCls(a[f])}t.borders=n}},beforeLayoutCycle:function(n){var f=this,i=f.owner,e=f.sizeModels.shrinkWrap,t=i.shrinkWrapDock,r,u;i.collapsed&&(i.collapsedVertical()?(u=!0,n.measureDimensions=1):(r=!0,n.measureDimensions=2));n.collapsedVert=u;n.collapsedHorz=r;u?n.heightModel=e:r&&(n.widthModel=e);t=t===!0?3:t||0;n.shrinkWrapDockHeight=t&1&&n.heightModel.shrinkWrap;n.shrinkWrapDockWidth=t&2&&n.widthModel.shrinkWrap},beginLayout:function(n){var t=this,r=t.owner,h=t.getLayoutItems(),l=n.context,a=h.length,c,e,u,f,i,o,s;for(t.callParent(arguments),o=r.getCollapsed(),o!==t.lastCollapsedState&&Ext.isDefined(t.lastCollapsedState)&&(t.owner.collapsed?(n.isCollapsingOrExpanding=1,r.addClsWithUI(r.collapsedCls)):(n.isCollapsingOrExpanding=2,r.removeClsWithUI(r.collapsedCls),n.lastCollapsedState=t.lastCollapsedState)),t.lastCollapsedState=o,n.dockedItems=c=[],e=0;e<a;e++)u=h[e],u.rendered&&(s=u.dock,f=l.getCmp(u),f.dockedAt={x:0,y:0},f.offsets=i=Ext.Element.parseBox(u.offsets||0),f.horizontal=s=="top"||s=="bottom",i.width=i.left+i.right,i.height=i.top+i.bottom,c.push(f));n.bodyContext=n.getEl("body")},beginLayoutCycle:function(n){var t=this,o=n.dockedItems,h=o.length,i=t.owner,r=i.frameBody,s=t.lastHeightModel,u,f,e;for(t.callParent(arguments),t.owner.manageHeight?t.lastBodyDisplay&&(i.body.dom.style.display=t.lastBodyDisplay=""):(t.lastBodyDisplay!=="inline-block"&&(i.body.dom.style.display=t.lastBodyDisplay="inline-block"),s&&s.shrinkWrap&&!n.heightModel.shrinkWrap&&(i.body.dom.style.marginBottom="")),n.widthModel.auto&&(n.widthModel.shrinkWrap&&i.el.setWidth(null),i.body.setWidth(null),r&&r.setWidth(null)),n.heightModel.auto&&(i.body.setHeight(null),r&&r.setHeight(null)),n.collapsedVert?n.setContentHeight(0):n.collapsedHorz&&n.setContentWidth(0),u=0;u<h;u++)if(f=o[u].target,e=f.dock,e=="right")f.setLocalX(0);else if(e!="left")continue},calculate:function(n){var t=this,l=t.measureAutoDimensions(n,n.measureDimensions),e=n.state,u=e.horzDone,f=e.vertDone,o=n.bodyContext,c,i,r,s,h;for(n.borderInfo||n.getBorderInfo(),n.paddingInfo||n.getPaddingInfo(),n.frameInfo||n.getFrameInfo(),o.borderInfo||o.getBorderInfo(),o.paddingInfo||o.getPaddingInfo(),n.frameBorder||((c=n.framing)?(n.frameBorder=c.border,n.framePadding=c.padding):(n.frameBorder=n.borderInfo,n.framePadding=n.paddingInfo)),i=!u&&t.createAxis(n,l.contentWidth,n.widthModel,t.horzAxisProps,n.collapsedHorz),r=!f&&t.createAxis(n,l.contentHeight,n.heightModel,t.vertAxisProps,n.collapsedVert),s=0,h=n.dockedItems.length;h--;++s)i&&t.dockChild(n,i,h,s),r&&t.dockChild(n,r,h,s);i&&t.finishAxis(n,i)&&(e.horzDone=u=i);r&&t.finishAxis(n,r)&&(e.vertDone=f=r);u&&f&&t.finishConstraints(n,u,f)?t.finishPositions(n,u,f):t.done=!1},createAxis:function(n,t,i,r,u){var a=this,e=0,v=a.owner,y=v[r.maxSize],p=v[r.minSize]||0,o=r.dockBegin,s=r.dockEnd,w=r.pos,h=r.size,b=y!=null,d=i.shrinkWrap,k,c,l,f;return d?u?f=0:(k=n.bodyContext,f=t+k.borderInfo[h]):(c=n.frameBorder,l=n.framePadding,e=c[o]+l[o],f=n.getProp(h)-(c[s]+l[s])),{shrinkWrap:i.shrinkWrap,sizeModel:i,initialBegin:e,begin:e,end:f,collapsed:u,horizontal:r.horizontal,ignoreFrameBegin:null,ignoreFrameEnd:null,initialSize:f-e,maxChildSize:0,hasMinMaxConstraints:(p||b)&&i.shrinkWrap,minSize:p,maxSize:b?y:1e9,bodyPosProp:a.owner.manageHeight?w:r.marginBegin,dockBegin:o,dockEnd:s,posProp:w,sizeProp:h,setSize:r.setSize,shrinkWrapDock:n[r.shrinkWrapDock],sizeModelName:r.sizeModel,dockedPixelsEnd:0}},dockChild:function(n,t,i,r){var e=this,u=n.dockedItems[t.shrinkWrap?i:r],f=u.target,s=f.dock,h=t.sizeProp,o,c;f.ignoreParentFrame&&n.isCollapsingOrExpanding&&u.clearMarginCache();u.marginInfo||u.getMarginInfo();s==t.dockBegin?o=t.shrinkWrap?e.dockOutwardBegin(n,u,f,t):e.dockInwardBegin(n,u,f,t):s==t.dockEnd?o=t.shrinkWrap?e.dockOutwardEnd(n,u,f,t):e.dockInwardEnd(n,u,f,t):t.shrinkWrapDock?(c=u.getProp(h)+u.marginInfo[h],t.maxChildSize=Math.max(t.maxChildSize,c),o=0):o=e.dockStretch(n,u,f,t);u.dockedAt[t.posProp]=o},dockInwardBegin:function(n,t,i,r){var e=r.begin,o=r.sizeProp,s=i.ignoreParentFrame,u,h,f;return s&&(r.ignoreFrameBegin=t,f=i.dock,u=n.frameBorder[f],e-=u+n.framePadding[f]),i.overlay||(h=t.getProp(o)+t.marginInfo[o],r.begin+=h,s&&(r.begin-=u)),e},dockInwardEnd:function(n,t,i,r){var e=r.sizeProp,o=t.getProp(e)+t.marginInfo[e],u=r.end-o,f;return i.overlay||(r.end=u),i.ignoreParentFrame&&(r.ignoreFrameEnd=t,f=n.frameBorder[i.dock],u+=f+n.framePadding[i.dock],r.end+=f),u},dockOutwardBegin:function(n,t,i,r){var u=r.begin,f=r.sizeProp,e;return r.collapsed?r.ignoreFrameBegin=r.ignoreFrameEnd=t:i.ignoreParentFrame&&(r.ignoreFrameBegin=t),i.overlay||(e=t.getProp(f)+t.marginInfo[f],u-=e,r.begin=u),u},dockOutwardEnd:function(n,t,i,r){var f=r.end,e=r.sizeProp,u;return u=t.getProp(e)+t.marginInfo[e],r.collapsed?r.ignoreFrameBegin=r.ignoreFrameEnd=t:i.ignoreParentFrame&&(r.ignoreFrameEnd=t),i.overlay||(r.end=f+u,r.dockedPixelsEnd+=u),f},dockStretch:function(n,t,i,r){var s=i.dock,f=r.sizeProp,h=s=="top"||s=="bottom",c=n.frameBorder,l=t.offsets,a=n.framePadding,y=h?"right":"bottom",e=h?"left":"top",o=r.begin+l[e],v,u;return i.stretch!==!1&&(u=r.end-o-l[y],i.ignoreParentFrame&&(o-=a[e]+c[e],u+=a[f]+c[f]),v=t.marginInfo,u-=v[f],t[r.setSize](u)),o},finishAxis:function(n,t){if(isNaN(t.maxChildSize))return!1;var e=t.begin,f=t.end-e,h=t.collapsed,nt=t.setSize,c=t.dockBegin,y=t.dockEnd,l=n.framePadding,p=n.frameBorder,i=p[c],s=n.framing,a=s&&s[c],o=h?0:l[c],tt=t.sizeProp,w=t.ignoreFrameBegin,b=t.ignoreFrameEnd,k=n.bodyContext,d=Math.max(i+o-a,0),r,v,u,g;return t.shrinkWrap?(v=t.initialSize,s?(u=-e+i+o,r=u-a-d):(r=-e,u=r+o),h||(f+=l[tt]),w?(u-=i,r-=i,w.dockedAt[t.posProp]-=o):f+=i,h||(b?b.dockedAt[t.posProp]+=l[y]:f+=p[y]),t.size=f,t.horizontal||this.owner.manageHeight||(g=!1)):(s?(u=0,r=e-a-d):(u=-i,r=e-o-i),v=f),t.delta=u,k[nt](v,g),k.setProp(t.bodyPosProp,r),!isNaN(f)},beforeInvalidateShrinkWrapDock:function(n,t){var i=t.axis.sizeModelName;n[i].constrainedMin||(n[i]=Ext.layout.SizeModel.calculated)},afterInvalidateShrinkWrapDock:function(n,t){var i=t.axis,u=t.layout,r;n[i.sizeModelName].calculated&&(r=u.dockStretch(t.ownerContext,n,n.target,i),n.setProp(i.posProp,i.delta+r))},finishConstraints:function(n,t,i){var v=this,o=v.sizeModels,p=t.shrinkWrap,w=i.shrinkWrap,y=v.owner,b,l,a,u,r,f,s,h,e,c;if(p&&(f=t.size,s=t.collapsed?0:t.minSize,h=t.maxSize,e=t.maxChildSize,c=Math.max(f,e),c>h?(r=o.constrainedMax,a=h):c<s?(r=o.constrainedMin,a=s):f<e?(r=o.constrainedDock,y.dockConstrainedWidth=a=e):a=f),w&&(f=i.size,s=i.collapsed?0:i.minSize,h=i.maxSize,e=i.maxChildSize,c=Math.max(f,e+f-i.initialSize),c>h?(u=o.constrainedMax,l=h):c<s?(u=o.constrainedMin,l=s):f<e?(u=o.constrainedDock,y.dockConstrainedHeight=l=e):(n.collapsedVert||y.manageHeight||(b=!1,n.bodyContext.setProp("margin-bottom",i.dockedPixelsEnd)),l=f)),r||u){if(r&&u&&r.constrainedMax&&u.constrainedByMin)return n.invalidate({widthModel:r}),!1;if(!n.widthModel.calculatedFromShrinkWrap&&!n.heightModel.calculatedFromShrinkWrap)return n.invalidate({widthModel:r,heightModel:u}),!1}else v.invalidateAxes(n,t,i);return p&&(n.setWidth(a),r&&(n.widthModel=r)),w&&(n.setHeight(l,b),u&&(n.heightModel=u)),!0},invalidateAxes:function(n,t,i){var p=this.beforeInvalidateShrinkWrapDock,w=this.afterInvalidateShrinkWrapDock,l=t.end-t.begin,a=i.initialSize,v=t.shrinkWrapDock&&t.maxChildSize<l,s=i.shrinkWrapDock&&i.maxChildSize<a,h,y,f,r,e,c,u,o;if(v||s)for(s&&(i.begin=i.initialBegin,i.end=i.begin+i.initialSize),h=n.dockedItems,f=0,y=h.length;f<y;++f)r=h[f],c=r.horizontal,u=null,v&&c?(o=t.sizeProp,e=l,u=t):s&&!c&&(o=i.sizeProp,e=a,u=i),u&&(e-=r.getMarginInfo()[o],e!==r.props[o]&&r.invalidate({before:p,after:w,axis:u,ownerContext:n,layout:this}))},finishPositions:function(n,t,i){for(var f=n.dockedItems,e=f.length,o=t.delta,s=i.delta,r,u=0;u<e;++u)r=f[u],r.setProp("x",o+r.dockedAt.x),r.setProp("y",s+r.dockedAt.y)},finishedLayout:function(n){var i=this,t=n.target;i.callParent(arguments);n.animatePolicy||(n.isCollapsingOrExpanding===1?t.afterCollapse(!1):n.isCollapsingOrExpanding===2&&t.afterExpand(!1))},getAnimatePolicy:function(n){var i=this,t,r;return n.isCollapsingOrExpanding==1?t=i.lastCollapsedState:n.isCollapsingOrExpanding==2&&(t=n.lastCollapsedState),t=="left"||t=="right"?r=i.horizontalCollapsePolicy:(t=="top"||t=="bottom")&&(r=i.verticalCollapsePolicy),r},getDockedItems:function(n,t){var r=this,h=n==="visual",i=h?Ext.ComponentQuery.query("[rendered]",r.owner.dockedItems.items):r.owner.dockedItems.items,e=i&&i.length&&n!==!1,c,o,u,f,s,l;if(t==null)u=e&&!h?i.slice():i;else{for(u=[],f=0,l=i.length;f<l;++f)o=i[f].dock,s=o=="top"||o=="left",(t?s:!s)&&u.push(i[f]);e=e&&u.length}return e&&(c=(n=n||"render")=="render",Ext.Array.sort(u,function(t,i){var u,f;return c&&(u=r.owner.dockOrder[t.dock])!==(f=r.owner.dockOrder[i.dock])&&!(u+f)?u-f:(u=r.getItemWeight(t,n),f=r.getItemWeight(i,n),u!==undefined&&f!==undefined)?u-f:0})),u||[]},getItemWeight:function(n,t){var i=n.weight||this.owner.defaultDockWeights[n.dock];return i[t]||i},getLayoutItems:function(){var i=this,r,f,u,n,t;if(i.owner.collapsed)t=i.owner.getCollapsedDockedItems();else for(r=i.getDockedItems("visual"),f=r.length,t=[],n=0;n<f;n++)u=r[n],u.hidden||t.push(u);return t},measureContentWidth:function(n){var t=n.bodyContext;return t.el.getWidth()-t.getBorderInfo().width},measureContentHeight:function(n){var t=n.bodyContext;return t.el.getHeight()-t.getBorderInfo().height},redoLayout:function(n){var i=this,t=i.owner;n.isCollapsingOrExpanding==1?(t.reExpander&&t.reExpander.el.show(),t.addClsWithUI(t.collapsedCls),n.redo(!0)):n.isCollapsingOrExpanding==2&&(t.removeClsWithUI(t.collapsedCls),n.bodyContext.redo())},renderChildren:function(){var n=this,t=n.getDockedItems(),i=n.getRenderTarget();n.handleItemBorders();n.renderItems(t,i)},renderItems:function(n,t){for(var f=this,s=n.length,e=0,r=0,c=0,l=f.getRenderTarget().dom.childNodes,a=l.length,h,i,o=0,u=0;o<a;o++){if(h=l[o],Ext.fly(h).hasCls(Ext.baseCSSPrefix+"resizable-handle"))break;for(u=0;u<s;u++)if(i=n[u],i.rendered&&i.el.dom===h)break;u===s&&c++}for(;e<s;e++,r++)i=n[e],e===r&&(i.dock==="right"||i.dock==="bottom")&&(r+=c),i&&!i.rendered?f.renderItem(i,t,r):f.isValidParent(i,t,r)||f.moveItem(i,t,r)},undoLayout:function(n){var i=this,t=i.owner;n.isCollapsingOrExpanding==1?(t.reExpander&&t.reExpander.el.hide(),t.removeClsWithUI(t.collapsedCls),n.undo(!0)):n.isCollapsingOrExpanding==2&&(t.addClsWithUI(t.collapsedCls),n.bodyContext.undo())},sizePolicy:{nostretch:{setsWidth:0,setsHeight:0},horz:{shrinkWrap:{setsWidth:1,setsHeight:0,readsWidth:1},stretch:{setsWidth:1,setsHeight:0}},vert:{shrinkWrap:{setsWidth:0,setsHeight:1,readsHeight:1},stretch:{setsWidth:0,setsHeight:1}},stretchV:{setsWidth:0,setsHeight:1},autoStretchH:{readsWidth:1,setsWidth:1,setsHeight:0},autoStretchV:{readsHeight:1,setsWidth:0,setsHeight:1}},getItemSizePolicy:function(n,t){var u=this,r=u.sizePolicy,i=u.owner.shrinkWrapDock,f,e;return n.stretch===!1?r.nostretch:(f=n.dock,e=f=="left"||f=="right",i=i===!0?3:i||0,e?(r=r.vert,i=i&1):(r=r.horz,i=i&2),i&&(t||(t=u.owner.getSizeModel()),t[e?"height":"width"].shrinkWrap))?r.shrinkWrap:r.stretch},configureItem:function(n){this.callParent(arguments);n.addCls(Ext.baseCSSPrefix+"docked");n.addClsWithUI(this.getDockCls(n.dock))},getDockCls:function(n){return"docked-"+n},afterRemove:function(n){this.callParent(arguments);this.itemCls&&n.el.removeCls(this.itemCls+"-"+n.dock);var t=n.el.dom;!n.destroying&&t&&t.parentNode.removeChild(t);this.childrenChanged=!0},borderCollapseMap:{},getBorderCollapseTable:function(){var u=this,t=u.borderCollapseMap,f=u.owner,n=f.baseCls,r=f.ui,i;return t=t[n]||(t[n]={}),i=t[r],i||(n+="-"+r+"-outer-border-",t[r]=i=[0,n+"l",n+"b",n+"bl",n+"r",n+"rl",n+"rb",n+"rbl",n+"t",n+"tl",n+"tb",n+"tbl",n+"tr",n+"trl",n+"trb",n+"trbl"]),i}})