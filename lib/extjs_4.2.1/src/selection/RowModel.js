Ext.define("Ext.selection.RowModel",{extend:"Ext.selection.Model",alias:"selection.rowmodel",requires:["Ext.util.KeyNav"],deltaScroll:5,enableKeyNav:!0,ignoreRightMouseSelection:!1,constructor:function(){this.addEvents("beforedeselect","beforeselect","deselect","select");this.views=[];this.callParent(arguments)},bindComponent:function(n){var t=this;n.on({itemmousedown:t.onRowMouseDown,itemclick:t.onRowClick,scope:t});t.enableKeyNav&&t.initKeyNav(n)},initKeyNav:function(n){var t=this;if(!n.rendered){n.on("render",Ext.Function.bind(t.initKeyNav,t,[n],0),t,{single:!0});return}n.el.set({tabIndex:-1});t.keyNav=new Ext.util.KeyNav({target:n,ignoreInputFields:!0,eventName:"itemkeydown",processEvent:function(n,t,i,r,u){return u.record=t,u.recordIndex=r,u},up:t.onKeyUp,down:t.onKeyDown,right:t.onKeyRight,left:t.onKeyLeft,pageDown:t.onKeyPageDown,pageUp:t.onKeyPageUp,home:t.onKeyHome,end:t.onKeyEnd,space:t.onKeySpace,enter:t.onKeyEnter,scope:t})},onUpdate:function(n){var i=this,t=i.view,r;if(t&&i.isSelected(n)){r=t.indexOf(n);t.onRowSelect(r);if(n===i.lastFocused)t.onRowFocus(r,!0)}},getRowsVisible:function(){var n=!1,t=this.views[0],i=t.all.first(),r,u;return i&&(r=i.getHeight(),u=t.el.getHeight(),n=Math.floor(u/r)),n},onKeyEnd:function(n){var t=this,i=t.views[0];i.bufferedRenderer?i.bufferedRenderer.scrollTo(t.store.getCount()-1,!1,function(i,r){t.afterKeyNavigate(n,r)}):t.afterKeyNavigate(n,i.getRecord(i.all.getCount()-1))},onKeyHome:function(n){var t=this,i=t.views[0];i.bufferedRenderer?i.bufferedRenderer.scrollTo(0,!1,function(i,r){t.afterKeyNavigate(n,r)}):t.afterKeyNavigate(n,i.getRecord(0))},onKeyPageUp:function(n){var t=this,i=t.views[0],r=t.getRowsVisible(),u,f;r&&(i.bufferedRenderer?(u=Math.max(n.recordIndex-r,0),(t.lastKeyEvent||(t.lastKeyEvent=new Ext.EventObjectImpl)).setEvent(n.browserEvent),i.bufferedRenderer.scrollTo(u,!1,t.afterBufferedScrollTo,t)):(f=i.walkRecs(n.record,-r),t.afterKeyNavigate(n,f)))},onKeyPageDown:function(n){var t=this,i=t.views[0],r=t.getRowsVisible(),u,f;r&&(i.bufferedRenderer?(u=Math.min(n.recordIndex+r,t.store.getCount()-1),(t.lastKeyEvent||(t.lastKeyEvent=new Ext.EventObjectImpl)).setEvent(n.browserEvent),i.bufferedRenderer.scrollTo(u,!1,t.afterBufferedScrollTo,t)):(f=i.walkRecs(n.record,r),t.afterKeyNavigate(n,f)))},onKeySpace:function(n){var t=this.lastFocused;t&&this.afterKeyNavigate(n,t)},onKeyEnter:Ext.emptyFn,onKeyUp:function(n){var t=this.views[0].walkRecs(n.record,-1);t&&this.afterKeyNavigate(n,t)},onKeyDown:function(n){var t=this.views[0].walkRecs(n.record,1);t&&this.afterKeyNavigate(n,t)},afterBufferedScrollTo:function(n,t){this.afterKeyNavigate(this.lastKeyEvent,t)},scrollByDeltaX:function(n){var i=this.views[0],r=i.up(),t=r.horizontalScroller;t&&t.scrollByDeltaX(n)},onKeyLeft:function(){this.scrollByDeltaX(-this.deltaScroll)},onKeyRight:function(){this.scrollByDeltaX(this.deltaScroll)},onRowMouseDown:function(n,t,i,r,u){var f=this;if(r!==-1){if(!f.allowRightMouseSelection(u))return;f.isSelected(t)?f.mousedownAction=!1:(f.mousedownAction=!0,f.processSelection(n,t,i,r,u))}},onVetoUIEvent:function(n,t,i,r,u,f,e){n=="mousedown"&&(this.mousedownAction=!this.isSelected(e))},onRowClick:function(n,t,i,r,u){this.mousedownAction?this.mousedownAction=!1:this.processSelection(n,t,i,r,u)},processSelection:function(n,t,i,r,u){this.selectWithEvent(t,u)},allowRightMouseSelection:function(n){var t=this.ignoreRightMouseSelection&&n.button!==0;return t&&(t=this.hasSelection()),!t},onSelectChange:function(n,t,i,r){var u=this,f=u.views,h=f.length,e=f[0].indexOf(n),s=t?"select":"deselect",o=0;if((i||u.fireEvent("before"+s,u,n,e))!==!1&&r()!==!1){for(;o<h;o++)if(t)f[o].onRowSelect(e,i);else f[o].onRowDeselect(e,i);i||u.fireEvent(s,u,n,e)}},onLastFocusChanged:function(n,t,i){var f=this.views,e=f.length,u,r=0;if(n&&(u=f[0].indexOf(n),u!=-1))for(;r<e;r++)f[r].onRowFocus(u,!1,!0);if(t&&(u=f[0].indexOf(t),u!=-1))for(r=0;r<e;r++)f[r].onRowFocus(u,!0,i);this.callParent(arguments)},onEditorTab:function(n,t){var r=this,u=r.views[0],f=n.getActiveRecord(),e=n.getActiveColumn(),i=u.getPosition(f,e),o=t.shiftKey?"left":"right";do i=u.walkCells(i,o,t,r.preventWrap);while(i&&(!i.columnHeader.getEditor(f)||!n.startEditByPosition(i)))},getCurrentPosition:function(){var n=this.selected.items[0];if(n)return new Ext.grid.CellContext(this.view).setPosition(this.store.indexOf(n),0)},selectByPosition:function(n){this.select(this.store.getAt(n.row))},selectNext:function(n,t){var i=this,e=i.store,f=i.getSelection(),o=f[f.length-1],r=i.views[0].indexOf(o)+1,u;return r===e.getCount()||r===0?u=!1:(i.doSelect(r,n,t),u=!0),u},selectPrevious:function(n,t){var i=this,f=i.getSelection(),e=f[0],u=i.views[0].indexOf(e)-1,r;return u<0?r=!1:(i.doSelect(u,n,t),r=!0),r},isRowSelected:function(n){return this.isSelected(n)}})