Ext.define("Ext.grid.header.Container",{extend:"Ext.container.Container",requires:["Ext.grid.ColumnLayout","Ext.grid.plugin.HeaderResizer","Ext.grid.plugin.HeaderReorderer"],uses:["Ext.grid.column.Column","Ext.grid.ColumnManager","Ext.menu.Menu","Ext.menu.CheckItem","Ext.menu.Separator"],border:!0,alias:"widget.headercontainer",baseCls:Ext.baseCSSPrefix+"grid-header-ct",dock:"top",weight:100,defaultType:"gridcolumn",detachOnRemove:!1,defaultWidth:100,sortAscText:"Sort Ascending",sortDescText:"Sort Descending",sortClearText:"Clear Sort",columnsText:"Columns",headerOpenCls:Ext.baseCSSPrefix+"column-header-open",menuSortAscCls:Ext.baseCSSPrefix+"hmenu-sort-asc",menuSortDescCls:Ext.baseCSSPrefix+"hmenu-sort-desc",menuColsIcon:Ext.baseCSSPrefix+"cols-icon",triStateSort:!1,ddLock:!1,dragging:!1,sortable:!0,enableColumnHide:!0,initComponent:function(){var n=this;n.headerCounter=0;n.plugins=n.plugins||[];n.isColumn||(n.enableColumnResize&&(n.resizer=new Ext.grid.plugin.HeaderResizer,n.plugins.push(n.resizer)),n.enableColumnMove&&(n.reorderer=new Ext.grid.plugin.HeaderReorderer,n.plugins.push(n.reorderer)));n.isColumn&&(!n.items||n.items.length===0)?(n.isContainer=!1,n.layout={type:"container",calculate:Ext.emptyFn}):(n.layout=Ext.apply({type:"gridcolumn",align:"stretch"},n.initialConfig.layout),n.isRootHeader&&(n.grid.columnManager=n.columnManager=new Ext.grid.ColumnManager(n)));n.defaults=n.defaults||{};Ext.applyIf(n.defaults,{triStateSort:n.triStateSort,sortable:n.sortable});n.menuTask=new Ext.util.DelayedTask(n.updateMenuDisabledState,n);n.callParent();n.addEvents("columnresize","headerclick","headercontextmenu","headertriggerclick","columnmove","columnhide","columnshow","columnschanged","sortchange","menucreate")},isLayoutRoot:function(){return this.hiddenHeaders?!1:this.callParent()},getOwnerHeaderCt:function(){var n=this;return n.isRootHeader?n:n.up("[isRootHeader]")},onDestroy:function(){var n=this;n.menu&&n.menu.un("hide",n.onMenuHide,n);n.menuTask.cancel();Ext.destroy(n.resizer,n.reorderer);n.callParent()},applyColumnsState:function(n){if(n&&n.length)for(var e=this,o=e.items.items,s=o.length,u=0,h=n.length,t,f,i,r=0;r<h;r++)for(f=n[r],i=s;i--;)if(t=o[i],t.getStateId&&t.getStateId()==f.id){u!==i&&e.moveHeader(i,u);t.applyColumnState&&t.applyColumnState(f);++u;break}},getColumnsState:function(){var i=this,t=[],n;return i.items.each(function(i){n=i.getColumnState&&i.getColumnState();n&&t.push(n)}),t},onAdd:function(n){var t=this;n.headerId||(n.headerId=n.initialConfig.id||Ext.id(null,"header-"));n.getStateId()||(n.stateId=n.initialConfig.id||"h"+ ++t.headerCounter);Ext.global.console&&Ext.global.console.warn&&(t._usedIDs||(t._usedIDs={}),t._usedIDs[n.headerId]&&Ext.global.console.warn(this.$className,"attempted to reuse an existing id",n.headerId),t._usedIDs[n.headerId]=!0);t.callParent(arguments);t.onColumnsChanged()},onMove:function(){this.callParent(arguments);this.onColumnsChanged()},onShow:function(){this.callParent(arguments);this.onColumnsChanged()},onColumnsChanged:function(){for(var n=this;n;){if(n.purgeCache(),n.isRootHeader)break;n=n.ownerCt}n&&n.rendered&&n.fireEvent("columnschanged",n)},onRemove:function(n){var t=this,i=t.ownerCt;t.callParent(arguments);t._usedIDs||(t._usedIDs={});delete t._usedIDs[n.headerId];t.destroying||(t.onColumnsChanged(),t.isGroupHeader&&!t.items.getCount()&&i&&(t.detachComponent(n),Ext.suspendLayouts(),i.remove(t),Ext.resumeLayouts(!0)))},applyDefaults:function(n){var t;return n&&!n.isComponent&&n.xtype=="rownumberer"?t=n:(t=this.callParent(arguments),n.isGroupHeader||"width"in t||t.flex||(t.width=this.defaultWidth)),t},setSortState:function(){var i=this.up("[store]").store,n=i.getFirstSorter(),t;n?(t=this.down("gridcolumn[dataIndex="+n.property+"]"),t&&t.setSortState(n.direction,!1,!0)):this.clearOtherSortStates(null)},getHeaderMenu:function(){var t=this.getMenu(),n;return t&&(n=t.child("#columnItem"),n)?n.menu:null},onHeaderVisibilityChange:function(n,t){var i=this,r=i.getHeaderMenu(),u;i.purgeCache();r&&(u=i.getMenuItemForHeader(r,n),u&&u.setChecked(t,!0),r.isVisible()&&i.menuTask.delay(50))},updateMenuDisabledState:function(n){var r=this,e=r.query(":not([hidden])"),t,o=e.length,u,i,f;for(n||(n=r.getMenu()),t=0;t<o;++t)u=e[t],i=r.getMenuItemForHeader(n,u),i&&(f=u.isHideable()?"enable":"disable",i.menu&&(f+="CheckChange"),i[f]())},getMenuItemForHeader:function(n,t){return t?n.down("menucheckitem[headerId="+t.id+"]"):null},onHeaderShow:function(n){var t=this,i=t.ownerCt;t.forceFit&&delete t.flex;t.onHeaderVisibilityChange(n,!0);if(!n.isGroupHeader&&i)i.onHeaderShow(t,n);t.fireEvent("columnshow",t,n);t.fireEvent("columnschanged",this)},onHeaderHide:function(n){var t=this,i=t.ownerCt;t.onHeaderVisibilityChange(n,!1);if(!n.isGroupHeader&&i)i.onHeaderHide(t,n);t.fireEvent("columnhide",t,n);t.fireEvent("columnschanged",this)},tempLock:function(){this.ddLock=!0;Ext.Function.defer(function(){this.ddLock=!1},200,this)},onHeaderResize:function(n,t){var i=this,r=i.view,u=i.ownerCt;if(r&&r.body.dom&&(i.tempLock(),u))u.onHeaderResize(i,n,t);i.fireEvent("columnresize",this,n,t)},onHeaderClick:function(n,t,i){n.fireEvent("headerclick",this,n,t,i);this.fireEvent("headerclick",this,n,t,i)},onHeaderContextMenu:function(n,t,i){n.fireEvent("headercontextmenu",this,n,t,i);this.fireEvent("headercontextmenu",this,n,t,i)},onHeaderTriggerClick:function(n,t,i){var r=this;n.fireEvent("headertriggerclick",r,n,t,i)!==!1&&r.fireEvent("headertriggerclick",r,n,t,i)!==!1&&r.showMenuBy(i,n)},showMenuBy:function(n,t){var i=this.getMenu(),u=i.down("#ascItem"),f=i.down("#descItem"),r;i.activeHeader=i.ownerButton=t;t.setMenuActive(!0);r=t.sortable?"enable":"disable";u&&u[r]();f&&f[r]();i.showBy(n)},onMenuHide:function(n){n.activeHeader.setMenuActive(!1)},moveHeader:function(n,t){this.tempLock();this.onHeaderMoved(this.move(n,t),1,n,t)},purgeCache:function(){var n=this,t=n.menu;n.gridDataColumns=n.hideableColumns=null;n.columnManager&&n.columnManager.invalidate();t&&t.hidden&&(t.hide(),t.destroy(),n.menu=null)},onHeaderMoved:function(n,t,i,r){var u=this,f=u.ownerCt;if(f&&f.onHeaderMove)f.onHeaderMove(u,n,t,i,r);u.fireEvent("columnmove",u,n,i,r)},getMenu:function(){var n=this;return n.menu||(n.menu=new Ext.menu.Menu({hideOnParentHide:!1,items:n.getMenuItems(),listeners:{hide:n.onMenuHide,scope:n}}),n.fireEvent("menucreate",n,n.menu)),n.updateMenuDisabledState(n.menu),n.menu},getMenuItems:function(){var n=this,t=[],i=n.enableColumnHide?n.getColumnMenu(n):null;return n.sortable&&(t=[{itemId:"ascItem",text:n.sortAscText,cls:n.menuSortAscCls,handler:n.onSortAscClick,scope:n},{itemId:"descItem",text:n.sortDescText,cls:n.menuSortDescCls,handler:n.onSortDescClick,scope:n}]),i&&i.length&&(n.sortable&&t.push("-"),t.push({itemId:"columnItem",text:n.columnsText,cls:n.menuColsIcon,menu:i,hideOnClick:!1})),t},onSortAscClick:function(){var n=this.getMenu(),t=n.activeHeader;t.setSortState("ASC")},onSortDescClick:function(){var n=this.getMenu(),t=n.activeHeader;t.setSortState("DESC")},getColumnMenu:function(n){for(var u=[],r=0,t,f=n.query(">gridcolumn[hideable]"),e=f.length,i;r<e;r++){t=f[r];i=new Ext.menu.CheckItem({text:t.menuText||t.text,checked:!t.hidden,hideOnClick:!1,headerId:t.id,menu:t.isGroupHeader?this.getColumnMenu(t):undefined,checkHandler:this.onColumnCheckChange,scope:this});u.push(i);t.on({destroy:Ext.Function.bind(i.destroy,i)})}return u},onColumnCheckChange:function(n,t){var i=Ext.getCmp(n.headerId);i[t?"show":"hide"]()},getColumnCount:function(){return this.getGridColumns().length},getFullWidth:function(){for(var i=0,r=this.getVisibleGridColumns(),u=r.length,t=0,n;t<u;t++)n=r[t],i+=n.getDesiredWidth?n.getDesiredWidth()||0:n.getWidth();return i},clearOtherSortStates:function(n){for(var i=this.getGridColumns(),r=i.length,t=0;t<r;t++)i[t]!==n&&i[t].setSortState(null,!0)},getVisibleGridColumns:function(){for(var t=this.getGridColumns(),i=[],r=t.length,n=0;n<r;n++)t[n].hidden||(i[i.length]=t[n]);return i},getGridColumns:function(n,t){if(!n&&this.gridDataColumns)return this.gridDataColumns;var e=this,u=n||[],s,r,f,i,o;if(t=t||e.hidden,e.items)for(s=e.items.items,r=0,f=s.length;r<f;r++)i=s[r],i.isGroupHeader?i.getGridColumns(u,t):(i.hiddenAncestor=t,u.push(i));if(n||(e.gridDataColumns=u),!n&&f){for(r=0,f=u.length;r<f;r++)i=u[r],i.isFirstVisible=i.isLastVisible=!1,i.hidden||i.hiddenAncestor||(o||(i.isFirstVisible=!0),o=i);o&&(o.isLastVisible=!0)}return u},getHideableColumns:function(){var n=this,t=n.hideableColumns;return t||(t=n.hideableColumns=n.query("[hideable]")),t},getHeaderIndex:function(n){return this.columnManager.getHeaderIndex(n)},getHeaderAtIndex:function(n){return this.columnManager.getHeaderAtIndex(n)},getVisibleHeaderClosestToIndex:function(n){return this.columnManager.getVisibleHeaderClosestToIndex(n)},autoSizeColumn:function(n){var t=this.view;t&&t.autoSizeColumn(n)}})