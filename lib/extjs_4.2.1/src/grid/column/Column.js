Ext.define("Ext.grid.column.Column",{extend:"Ext.grid.header.Container",alias:"widget.gridcolumn",requires:["Ext.util.KeyNav","Ext.grid.ColumnComponentLayout","Ext.grid.ColumnLayout"],alternateClassName:"Ext.grid.Column",baseCls:Ext.baseCSSPrefix+"column-header",hoverCls:Ext.baseCSSPrefix+"column-header-over",handleWidth:4,sortState:null,possibleSortStates:["ASC","DESC"],childEls:["titleEl","triggerEl","textEl"],noWrap:!0,renderTpl:'<div id="{id}-titleEl" {tipMarkup}class="'+Ext.baseCSSPrefix+'column-header-inner"><span id="{id}-textEl" class="'+Ext.baseCSSPrefix+'column-header-text{childElCls}">{text}<\/span><tpl if="!menuDisabled"><div id="{id}-triggerEl" class="'+Ext.baseCSSPrefix+'column-header-trigger{childElCls}"><\/div><\/tpl><\/div>{%this.renderContainer(out,values)%}',dataIndex:null,text:"&#160;",menuText:null,emptyCellText:"&#160;",sortable:!0,resizable:!0,hideable:!0,menuDisabled:!1,renderer:!1,editRenderer:!1,align:"left",draggable:!0,tooltipType:"qtip",initDraggable:Ext.emptyFn,tdCls:"",isHeader:!0,isColumn:!0,ascSortCls:Ext.baseCSSPrefix+"column-header-sort-ASC",descSortCls:Ext.baseCSSPrefix+"column-header-sort-DESC",componentLayout:"columncomponent",groupSubHeaderCls:Ext.baseCSSPrefix+"group-sub-header",groupHeaderCls:Ext.baseCSSPrefix+"group-header",clickTargetName:"titleEl",detachOnRemove:!0,initResizable:Ext.emptyFn,initComponent:function(){var n=this,t,i;n.header!=null&&(n.text=n.header,n.header=null);n.triStateSort||(n.possibleSortStates.length=2);n.columns!=null?(n.isGroupHeader=!0,n.dataIndex&&Ext.Error.raise("Ext.grid.column.Column: Group header may not accept a dataIndex"),(n.width&&n.width!==Ext.grid.header.Container.prototype.defaultWidth||n.flex)&&Ext.Error.raise("Ext.grid.column.Column: Group header does not support setting explicit widths or flexs. The group header width is calculated by the sum of its children."),n.items=n.columns,n.columns=n.flex=n.width=null,n.cls=(n.cls||"")+" "+n.groupHeaderCls,n.sortable=n.resizable=!1,n.align="center"):n.flex&&(n.minWidth=n.minWidth||Ext.grid.plugin.HeaderResizer.prototype.minColWidth);n.addCls(Ext.baseCSSPrefix+"column-header-align-"+n.align);t=n.renderer;t?(typeof t=="string"&&(n.renderer=Ext.util.Format[t]),n.hasCustomRenderer=!0):n.defaultRenderer&&(n.scope=n,n.renderer=n.defaultRenderer);n.callParent(arguments);i={element:n.clickTargetName,click:n.onTitleElClick,contextmenu:n.onTitleElContextMenu,mouseenter:n.onTitleMouseOver,mouseleave:n.onTitleMouseOut,scope:n};n.resizable&&(i.dblclick=n.onTitleElDblClick);n.on(i)},onAdd:function(n){n.isColumn&&(n.isSubHeader=!0,n.addCls(this.groupSubHeaderCls));this.hidden&&n.hide();this.callParent(arguments)},onRemove:function(n){n.isSubHeader&&(n.isSubHeader=!1,n.removeCls(this.groupSubHeaderCls));this.callParent(arguments)},initRenderData:function(){var n=this,t="",i=n.tooltip,r=n.tooltipType=="qtip"?"data-qtip":"title";return Ext.isEmpty(i)||(t=r+'="'+i+'" '),Ext.applyIf(n.callParent(arguments),{text:n.text,menuDisabled:n.menuDisabled,tipMarkup:t})},applyColumnState:function(n){var t=this;t.applyColumnsState(n.columns);n.hidden!=null&&(t.hidden=n.hidden);n.locked!=null&&(t.locked=n.locked);n.sortable!=null&&(t.sortable=n.sortable);n.width!=null?(t.flex=null,t.width=n.width):n.flex!=null&&(t.width=null,t.flex=n.flex)},getColumnState:function(){var n=this,r=n.items.items,f=r?r.length:0,i,u=[],t={id:n.getStateId()};if(n.savePropsToState(["hidden","sortable","locked","flex","width"],t),n.isGroupHeader){for(i=0;i<f;i++)u.push(r[i].getColumnState());u.length&&(t.columns=u)}else n.isSubHeader&&n.ownerCt.hidden&&delete n.hidden;return"width"in t&&delete t.flex,t},getStateId:function(){return this.stateId||this.headerId},setText:function(n){this.text=n;this.rendered&&this.textEl.update(n)},getIndex:function(){return this.isGroupColumn?!1:this.getOwnerHeaderCt().getHeaderIndex(this)},getVisibleIndex:function(){return this.isGroupColumn?!1:Ext.Array.indexOf(this.getOwnerHeaderCt().getVisibleGridColumns(),this)},beforeRender:function(){var n=this,t=n.up("tablepanel");n.callParent();!t||n.sortable&&t.sortableColumns!==!1||n.groupable||n.lockable||t.enableColumnHide!==!1&&n.getOwnerHeaderCt().getHideableColumns().length||(n.menuDisabled=!0);n.protoEl.unselectable()},afterRender:function(){var n=this,t=n.triggerEl;n.callParent(arguments);Ext.isIE8&&Ext.isStrict||n.mon(n.getFocusEl(),{focus:n.onTitleMouseOver,blur:n.onTitleMouseOut,scope:n});t&&n.self.triggerElWidth===undefined&&(t.setStyle("display","block"),n.self.triggerElWidth=t.getWidth(),t.setStyle("display",""));n.keyNav=new Ext.util.KeyNav(n.el,{enter:n.onEnterKey,down:n.onDownKey,scope:n})},afterComponentLayout:function(n,t,i){var r=this,u=r.getOwnerHeaderCt();if(r.callParent(arguments),u&&(i!=null||r.flex)&&n!==i)u.onHeaderResize(r,n,!0)},onDestroy:function(){var n=this;Ext.destroy(n.textEl,n.keyNav,n.field);n.keyNav=null;n.callParent(arguments)},onTitleMouseOver:function(){this.titleEl.addCls(this.hoverCls)},onTitleMouseOut:function(){this.titleEl.removeCls(this.hoverCls)},onDownKey:function(n){if(this.triggerEl)this.onTitleElClick(n,this.triggerEl.dom||this.el.dom)},onEnterKey:function(n){this.onTitleElClick(n,this.el.dom)},onTitleElDblClick:function(n){var t=this,i,r;if(t.isOnLeftEdge(n))i=t.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])"),i&&i.getOwnerHeaderCt()===t.getOwnerHeaderCt()&&i.autoSize();else if(t.isOnRightEdge(n)){if(t.isGroupHeader&&n.getPoint().isContainedBy(t.layout.innerCt)){r=t.query("gridcolumn:not([hidden]):not([isGroupHeader])");this.getOwnerHeaderCt().autoSizeColumn(r[r.length-1]);return}t.autoSize()}},autoSize:function(){var i=this,t,r,n,u;if(i.isGroupHeader){for(t=i.query("gridcolumn:not([hidden]):not([isGroupHeader])"),r=t.length,u=this.getOwnerHeaderCt(),Ext.suspendLayouts(),n=0;n<r;n++)u.autoSizeColumn(t[n]);Ext.resumeLayouts(!0);return}this.getOwnerHeaderCt().autoSizeColumn(this)},onTitleElClick:function(n,t){var i=this,r=i.getOwnerHeaderCt();if(r&&!r.ddLock)if(i.triggerEl&&(n.target===i.triggerEl.dom||t===i.triggerEl.dom||n.within(i.triggerEl)))r.onHeaderTriggerClick(i,n,t);else if(n.getKey()||!i.isOnLeftEdge(n)&&!i.isOnRightEdge(n)){i.toggleSortState();r.onHeaderClick(i,n,t)}},onTitleElContextMenu:function(n,t){var r=this,i=r.getOwnerHeaderCt();if(i&&!i.ddLock)i.onHeaderContextMenu(r,n,t)},processEvent:function(){return this.fireEvent.apply(this,arguments)},toggleSortState:function(){var n=this,t,i;n.sortable&&(t=Ext.Array.indexOf(n.possibleSortStates,n.sortState),i=(t+1)%n.possibleSortStates.length,n.setSortState(n.possibleSortStates[i]))},doSort:function(n){var t=this.up("tablepanel"),i=t.store;t.ownerLockable&&i.isNodeStore&&(i=t.ownerLockable.lockedGrid.store);i.sort({property:this.getSortParam(),direction:n})},getSortParam:function(){return this.dataIndex},setSortState:function(n,t,i){var r=this,f=r.ascSortCls,e=r.descSortCls,u=r.getOwnerHeaderCt(),o=r.sortState;if(n=n||null,!r.sorting&&o!==n&&r.getSortParam()!=null){n&&!i&&(r.sorting=!0,r.doSort(n),r.sorting=!1);switch(n){case"DESC":r.addCls(e);r.removeCls(f);break;case"ASC":r.addCls(f);r.removeCls(e);break;default:r.removeCls([f,e])}!u||r.triStateSort||t||u.clearOtherSortStates(r);r.sortState=n;(r.triStateSort||n!=null)&&u.fireEvent("sortchange",u,r,n)}},isHideable:function(){var n={hideCandidate:this,result:this.hideable};return n.result&&this.ownerCt.bubble(this.hasOtherMenuEnabledChildren,null,[n]),n.result},hasOtherMenuEnabledChildren:function(n){var t,i;if(!this.isXType("headercontainer"))return n.result=!1,!1;if(t=this.query(">:not([hidden]):not([menuDisabled])"),i=t.length,Ext.Array.contains(t,n.hideCandidate)&&i--,i)return!1;n.hideCandidate=this},isLockable:function(){var n={result:this.lockable!==!1};return n.result&&this.ownerCt.bubble(this.hasMultipleVisibleChildren,null,[n]),n.result},isLocked:function(){return this.locked||!!this.up("[isColumn][locked]","[isRootHeader]")},hasMultipleVisibleChildren:function(n){return this.isXType("headercontainer")?this.query(">:not([hidden])").length>1?!1:void 0:(n.result=!1,!1)},hide:function(n){var t=this,r=t.getOwnerHeaderCt(),e=t.ownerCt,o,f,i,s,u;if(!t.isVisible())return t;if(!r)return t.callParent(),t;if(r.forceFit&&(t.visibleSiblingCount=r.getVisibleGridColumns().length-1,t.flex&&(t.savedWidth=t.getWidth(),t.flex=null)),o=e.isGroupHeader,o&&!n&&(i=e.query(">:not([hidden])"),i.length===1&&i[0]==t)){t.ownerCt.hide();return}if(Ext.suspendLayouts(),t.isGroupHeader)for(i=t.items.items,u=0,s=i.length;u<s;u++)f=i[u],f.hidden||f.hide(!0);t.callParent();r.onHeaderHide(t);return Ext.resumeLayouts(!0),t},show:function(n,t){var i=this,o=i.getOwnerHeaderCt(),s=i.ownerCt,f,e,r,u,h,l,a,v,c=Ext.grid.header.Container.prototype.defaultWidth;if(i.isVisible())return i;if(!i.rendered){i.hidden=!1;return}if(l=o.el.getViewSize().width-(o.view.el.dom.scrollHeight>o.view.el.dom.clientHeight?Ext.getScrollbarSize().width:0),o.forceFit)if(f=Ext.ComponentQuery.query(":not([flex])",o.getVisibleGridColumns()),f.length)i.width=i.savedWidth||i.width||c;else{for(f=o.getVisibleGridColumns(),e=f.length,v=i.visibleSiblingCount,h=i.savedWidth||i.width||c,h=Math.min(h*(v/e),c,Math.max(l-e*c,c)),i.width=null,i.flex=h,l-=h,a=0,r=0;r<e;r++)u=f[r],u.flex=u.width||u.getWidth(),a+=u.flex,u.width=null;for(r=0;r<e;r++)u=f[r],u.flex=u.flex/a*l}if(Ext.suspendLayouts(),i.isSubHeader&&s.hidden&&s.show(!1,!0),i.callParent(arguments),i.isGroupHeader&&t!==!0&&!i.query(":not([hidden])").length)for(f=i.items.items,r=0,e=f.length;r<e;r++)u=f[r],u.hidden&&u.show(!0);if(Ext.resumeLayouts(!0),s=i.getOwnerHeaderCt(),s)s.onHeaderShow(i)},getDesiredWidth:function(){var n=this;return n.rendered&&n.componentLayout&&n.componentLayout.lastComponentSize?n.componentLayout.lastComponentSize.width:n.flex?n.width:n.width},getCellSelector:function(){return"."+Ext.baseCSSPrefix+"grid-cell-"+this.getItemId()},getCellInnerSelector:function(){return this.getCellSelector()+" ."+Ext.baseCSSPrefix+"grid-cell-inner"},isOnLeftEdge:function(n){return n.getXY()[0]-this.getX()<=this.handleWidth},isOnRightEdge:function(n){return this.getX()+this.getWidth()-n.getXY()[0]<=this.handleWidth},setMenuActive:function(n){this.titleEl[n?"addCls":"removeCls"](this.headerOpenCls)}})