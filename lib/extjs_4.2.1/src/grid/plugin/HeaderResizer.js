Ext.define("Ext.grid.plugin.HeaderResizer",{extend:"Ext.AbstractPlugin",requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.gridheaderresizer",disabled:!1,config:{dynamic:!1},colHeaderCls:Ext.baseCSSPrefix+"column-header",minColWidth:40,maxColWidth:1e3,wResizeCursor:"col-resize",eResizeCursor:"col-resize",init:function(n){this.headerCt=n;n.on("render",this.afterHeaderRender,this,{single:!0})},destroy:function(){this.tracker&&this.tracker.destroy()},afterHeaderRender:function(){var n=this.headerCt,t=n.el;n.mon(t,"mousemove",this.onHeaderCtMouseMove,this);this.tracker=new Ext.dd.DragTracker({disabled:this.disabled,onBeforeStart:Ext.Function.bind(this.onBeforeStart,this),onStart:Ext.Function.bind(this.onStart,this),onDrag:Ext.Function.bind(this.onDrag,this),onEnd:Ext.Function.bind(this.onEnd,this),tolerance:3,autoStart:300,el:t})},onHeaderCtMouseMove:function(n){var i=this,f,e,r,t,o,u;i.headerCt.dragging?i.activeHd&&(i.activeHd.el.dom.style.cursor="",delete i.activeHd):(e=n.getTarget("."+i.colHeaderCls,3,!0),e&&(r=Ext.getCmp(e.id),r.isOnLeftEdge(n)?(t=r.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])"),t&&(u=i.headerCt.up("tablepanel"),o=t.up("tablepanel"),o===u||u.ownerCt.isXType("tablepanel")&&u.ownerCt.view.lockedGrid===o||(t=null))):t=r.isOnRightEdge(n)?r:null,t?(t.isGroupHeader&&(f=t.getGridColumns(),t=f[f.length-1]),!t||t.fixed||t.resizable===!1||i.disabled||(i.activeHd=t,r.el.dom.style.cursor=i.eResizeCursor,r.triggerEl&&(r.triggerEl.dom.style.cursor=i.eResizeCursor))):(r.el.dom.style.cursor="",r.triggerEl&&(r.triggerEl.dom.style.cursor=""),i.activeHd=null)))},onBeforeStart:function(){return this.dragHd=this.activeHd,!this.dragHd||this.headerCt.dragging?(this.headerCt.dragging=!1,!1):(this.tracker.constrainTo=this.getConstrainRegion(),!0)},getConstrainRegion:function(){var n=this,r=n.dragHd.el,i=0,t,u;return n.headerCt.forceFit?(t=n.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])"),t&&(n.headerInSameGrid(t)||(t=null),i=t.getWidth()-n.minColWidth)):i=(u=n.dragHd.up("tablepanel")).isLocked?n.dragHd.up("[scrollerOwner]").getWidth()-u.getWidth()-30:n.maxColWidth-r.getWidth(),n.adjustConstrainRegion(r.getRegion(),0,i,0,n.minColWidth)},onStart:function(){var n=this,h=n.dragHd,c=h.el.getWidth(),f=h.getOwnerHeaderCt(),e,o,i,t,r,u,s;n.headerCt.dragging=!0;n.origWidth=c;n.dynamic||(i=t=f.up("tablepanel"),i.ownerLockable&&(t=i.ownerLockable),e=n.getLeftMarkerX(t),r=t.getLhsMarker(),u=t.getRhsMarker(),s=i.body.getHeight()+f.getHeight(),o=f.getOffsetsTo(t)[1],r.setLocalY(o),u.setLocalY(o),r.setHeight(s),u.setHeight(s),n.setMarkerX(r,e),n.setMarkerX(u,e+c))},onDrag:function(){var t=this,n;t.dynamic?t.doResize():(n=this.headerCt.up("tablepanel"),n.ownerLockable&&(n=n.ownerLockable),this.setMarkerX(this.getMovingMarker(n),this.calculateDragX(n)))},getMovingMarker:function(n){return n.getRhsMarker()},onEnd:function(){if(this.headerCt.dragging=!1,this.dragHd){if(!this.dynamic){var n=this.headerCt.up("tablepanel");n.ownerLockable&&(n=n.ownerLockable);this.setMarkerX(n.getLhsMarker(),-9999);this.setMarkerX(n.getRhsMarker(),-9999)}this.doResize()}},doResize:function(){var t=this,i=t.dragHd,n,r;i&&(r=t.tracker.getOffset("point"),i.flex&&delete i.flex,Ext.suspendLayouts(),t.adjustColumnWidth(r[0]),t.headerCt.forceFit&&(n=i.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])"),n&&!t.headerInSameGrid(n)&&(n=null),n&&(delete n.flex,n.setWidth(n.getWidth()-r[0]))),Ext.resumeLayouts(!0))},headerInSameGrid:function(n){var t=this.dragHd.up("tablepanel");return!!n.up(t)},disable:function(){this.disabled=!0;this.tracker&&this.tracker.disable()},enable:function(){this.disabled=!1;this.tracker&&this.tracker.enable()},calculateDragX:function(n){return this.tracker.getXY("point")[0]-n.getX()-n.el.getBorderWidth("l")},getLeftMarkerX:function(n){return this.dragHd.getX()-n.getX()-n.el.getBorderWidth("l")-1},setMarkerX:function(n,t){n.setLocalX(t)},adjustConstrainRegion:function(n,t,i,r,u){return n.adjust(t,i,r,u)},adjustColumnWidth:function(n){this.dragHd.setWidth(this.origWidth+n)}})