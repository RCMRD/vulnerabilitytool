Ext.define("Ext.grid.feature.Summary",{extend:"Ext.grid.feature.AbstractSummary",alias:"feature.summary",dock:undefined,dockedSummaryCls:Ext.baseCSSPrefix+"docked-summary",panelBodyCls:Ext.baseCSSPrefix+"summary-",init:function(n){var t=this,i=t.view;if(t.callParent(arguments),t.dock){n.headerCt.on({afterlayout:t.onStoreUpdate,scope:t});n.on({beforerender:function(){var r=[t.summaryTableCls];i.columnLines&&(r[r.length]=i.ownerCt.colLinesCls);t.summaryBar=n.addDocked({childEls:["innerCt"],renderTpl:['<div id="{id}-innerCt">','<table cellPadding="0" cellSpacing="0" class="'+r.join(" ")+'">','<tr class="'+t.summaryRowCls+'"><\/tr>',"<\/table>","<\/div>"],style:"overflow:hidden",itemId:"summaryBar",cls:[t.dockedSummaryCls,t.dockedSummaryCls+"-"+t.dock],xtype:"component",dock:t.dock,weight:1e7})[0]},afterrender:function(){n.body.addCls(t.panelBodyCls+t.dock);i.mon(i.el,{scroll:t.onViewScroll,scope:t});t.onStoreUpdate()},single:!0});n.headerCt.afterComponentLayout=Ext.Function.createSequence(n.headerCt.afterComponentLayout,function(){t.summaryBar.innerCt.setWidth(this.getFullWidth()+Ext.getScrollbarSize().width)})}else t.view.addFooterFn(t.renderTFoot);n.on({columnmove:t.onStoreUpdate,scope:t});i.mon(i.store,{update:t.onStoreUpdate,datachanged:t.onStoreUpdate,scope:t})},renderTFoot:function(n,t){var r=n.view,i=r.findFeature("summary");i.showSummaryRow&&(t.push("<tfoot>"),i.outputSummaryRecord(i.createSummaryRecord(r),n,t),t.push("<\/tfoot>"))},vetoEvent:function(n,t,i,r){return!r.getTarget(this.summaryRowSelector)},onViewScroll:function(){this.summaryBar.el.dom.scrollLeft=this.view.el.dom.scrollLeft},createSummaryRecord:function(n){var u=n.headerCt.getVisibleGridColumns(),f={records:n.store.getRange()},e=u.length,r,t,i=this.summaryRecord||(this.summaryRecord=new n.store.model(null,n.id+"-summary-record"));for(i.beginEdit(),r=0;r<e;r++)t=u[r],t.dataIndex||(t.dataIndex=t.id),i.set(t.dataIndex,this.getSummary(n.store,t.summaryType,t.dataIndex,f));return i.endEdit(!0),i.commit(!0),i.isSummary=!0,i},onStoreUpdate:function(){var n=this,r=n.view,f=n.createSummaryRecord(r),e=r.createRowElement(f,-1),i,t,u;r.rendered&&(i=n.dock?n.summaryBar.el.down("."+n.summaryRowCls,!0):n.view.getNode(f),i&&(u=i.parentNode,u.insertBefore(e,i),u.removeChild(i),t=n.lockingPartner,t&&t.grid.rendered&&!n.calledFromLockingPartner&&(t.calledFromLockingPartner=!0,t.onStoreUpdate(),t.calledFromLockingPartner=!1)),n.dock&&n.onColumnHeaderLayout())},onColumnHeaderLayout:function(){for(var r=this.view,u=r.headerCt.getVisibleGridColumns(),n,f=u.length,e=this.summaryBar.el,t,i=0;i<f;i++)n=u[i],t=e.down(r.getCellSelector(n)),t&&(n.hidden?t.setDisplayed(!1):(t.setDisplayed(!0),t.setWidth(n.width||(n.lastBox?n.lastBox.width:100))))}})