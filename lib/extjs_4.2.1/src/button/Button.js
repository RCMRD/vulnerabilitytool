Ext.define("Ext.button.Button",{alias:"widget.button",extend:"Ext.Component",requires:["Ext.button.Manager","Ext.menu.Manager","Ext.util.ClickRepeater","Ext.layout.component.Button","Ext.util.TextMetrics","Ext.util.KeyMap"],mixins:{queryable:"Ext.Queryable"},alternateClassName:"Ext.Button",isButton:!0,componentLayout:"button",hidden:!1,disabled:!1,pressed:!1,tabIndex:0,enableToggle:!1,menuAlign:"tl-bl?",showEmptyMenu:!1,textAlign:"center",clickEvent:"click",preventDefault:!0,handleMouseEvents:!0,tooltipType:"qtip",baseCls:Ext.baseCSSPrefix+"btn",pressedCls:"pressed",overCls:"over",focusCls:"focus",menuActiveCls:"menu-active",hrefTarget:"_blank",childEls:["btnEl","btnWrap","btnInnerEl","btnIconEl"],renderTpl:['<span id="{id}-btnWrap" class="{baseCls}-wrap','<tpl if="splitCls"> {splitCls}<\/tpl>','{childElCls}" unselectable="on">','<span id="{id}-btnEl" class="{baseCls}-button">','<span id="{id}-btnInnerEl" class="{baseCls}-inner {innerCls}','{childElCls}" unselectable="on">',"{text}","<\/span>",'<span role="img" id="{id}-btnIconEl" class="{baseCls}-icon-el {iconCls}','{childElCls} {glyphCls}" unselectable="on" style="','<tpl if="iconUrl">background-image:url({iconUrl});<\/tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};<\/tpl>">','<tpl if="glyph">&#{glyph};<\/tpl><tpl if="iconCls || iconUrl">&#160;<\/tpl>',"<\/span>","<\/span>","<\/span>",'<tpl if="closable">','<span id="{id}-closeEl" class="{baseCls}-close-btn" title="{closeText}" tabIndex="0"><\/span>',"<\/tpl>"],scale:"small",allowedScales:["small","medium","large"],iconAlign:"left",arrowAlign:"right",arrowCls:"arrow",maskOnDisable:!1,shrinkWrap:3,frame:!0,_triggerRegion:{},initComponent:function(){var n=this;n.autoEl={tag:"a",role:"button",hidefocus:"on",unselectable:"on"};n.addCls("x-unselectable");n.callParent(arguments);n.addEvents("click","toggle","mouseover","mouseout","menushow","menuhide","menutriggerover","menutriggerout","textchange","iconchange","glyphchange");n.menu&&(n.split=!0,n.menu=Ext.menu.Manager.get(n.menu),n.menu.ownerButton=n);n.url&&(n.href=n.url);n.href&&!n.hasOwnProperty("preventDefault")&&(n.preventDefault=!1);Ext.isString(n.toggleGroup)&&n.toggleGroup!==""&&(n.enableToggle=!0);n.html&&!n.text&&(n.text=n.html,delete n.html);n.glyphCls=n.baseCls+"-glyph"},getActionEl:function(){return this.el},getFocusEl:function(){return this.el},onDisable:function(){this.callParent(arguments)},setComponentCls:function(){var n=this,t=n.getComponentCls();Ext.isEmpty(n.oldCls)||(n.removeClsWithUI(n.oldCls),n.removeClsWithUI(n.pressedCls));n.oldCls=t;n.addClsWithUI(t)},getComponentCls:function(){var n=this,t;return t=n.iconCls||n.icon||n.glyph?[n.text?"icon-text-"+n.iconAlign:"icon"]:n.text?["noicon"]:[],n.pressed&&(t[t.length]=n.pressedCls),t},beforeRender:function(){var n=this,t=n.autoEl,i=n.getHref(),r=n.hrefTarget;n.disabled||(t.tabIndex=n.tabIndex);i&&(t.href=i,r&&(t.target=r));n.callParent();n.oldCls=n.getComponentCls();n.addClsWithUI(n.oldCls);Ext.applyIf(n.renderData,n.getTemplateArgs())},onRender:function(){var n=this,r,i,t;n.doc=Ext.getDoc();n.callParent(arguments);i=n.el;n.tooltip&&n.setTooltip(n.tooltip,!0);n.handleMouseEvents?(t={scope:n,mouseover:n.onMouseOver,mouseout:n.onMouseOut,mousedown:n.onMouseDown},n.split&&(t.mousemove=n.onMouseMove)):t={scope:n};n.menu&&(n.mon(n.menu,{scope:n,show:n.onMenuShow,hide:n.onMenuHide}),n.keyMap=new Ext.util.KeyMap({target:n.el,key:Ext.EventObject.DOWN,handler:n.onDownKey,scope:n}));n.repeat?n.mon(new Ext.util.ClickRepeater(i,Ext.isObject(n.repeat)?n.repeat:{}),"click",n.onRepeatClick,n):t[n.clickEvent]?r=!0:t[n.clickEvent]=n.onClick;n.mon(i,t);r&&n.mon(i,n.clickEvent,n.onClick,n);Ext.button.Manager.register(n)},getTemplateArgs:function(){var n=this,t=n.glyph,r=Ext._glyphFontFamily,i;return typeof t=="string"&&(i=t.split("@"),t=i[0],r=i[1]),{innerCls:n.getInnerCls(),splitCls:n.getSplitCls(),iconUrl:n.icon,iconCls:n.iconCls,glyph:t,glyphCls:t?n.glyphCls:"",glyphFontFamily:r,text:n.text||"&#160;"}},setHref:function(n){this.href=n;this.el.dom.href=this.getHref()},getHref:function(){var n=this,t=n.href;return t?Ext.urlAppend(t,Ext.Object.toQueryString(Ext.apply({},n.params,n.baseParams))):!1},setParams:function(n){this.params=n;this.el.dom.href=this.getHref()},getSplitCls:function(){var n=this;return n.split?n.baseCls+"-"+n.arrowCls+" "+(n.baseCls+"-"+n.arrowCls+"-"+n.arrowAlign):""},getInnerCls:function(){return this.textAlign?this.baseCls+"-inner-"+this.textAlign:""},setIcon:function(n){n=n||"";var t=this,r=t.btnIconEl,i=t.icon||"";return t.icon=n,n!=i&&(r&&(r.setStyle("background-image",n?"url("+n+")":""),t.setComponentCls(),t.didIconStateChange(i,n)&&t.updateLayout()),t.fireEvent("iconchange",t,i,n)),t},setIconCls:function(n){n=n||"";var t=this,r=t.btnIconEl,i=t.iconCls||"";return t.iconCls=n,i!=n&&(r&&(r.removeCls(i),r.addCls(n),t.setComponentCls(),t.didIconStateChange(i,n)&&t.updateLayout()),t.fireEvent("iconchange",t,i,n)),t},setGlyph:function(n){n=n||0;var t=this,i=t.btnIconEl,f=t.glyph,r,u;return t.glyph=n,i&&(typeof n=="string"&&(u=n.split("@"),n=u[0],r=u[1]||Ext._glyphFontFamily),n?f!=n&&(i.dom.innerHTML="&#"+n+";"):i.dom.innerHTML="",r&&i.setStyle("font-family",r)),t.fireEvent("glyphchange",t,t.glyph,f),t},setTooltip:function(n,t){var i=this;return i.rendered?(t&&n||i.clearTip(),n&&(Ext.quickTipsActive&&Ext.isObject(n)?(Ext.tip.QuickTipManager.register(Ext.apply({target:i.el.id},n)),i.tooltip=n):i.el.dom.setAttribute(i.getTipAttr(),n))):i.tooltip=n,i},setTextAlign:function(n){var t=this,i=t.btnEl;return i&&(i.removeCls(t.baseCls+"-inner-"+t.textAlign),i.addCls(t.baseCls+"-inner-"+n)),t.textAlign=n,t},getTipAttr:function(){return this.tooltipType=="qtip"?"data-qtip":"title"},getRefItems:function(n){var t=this.menu,i;return t&&(i=t.getRefItems(n),i.unshift(t)),i||[]},clearTip:function(){var n=this,t=n.el;Ext.quickTipsActive&&Ext.isObject(n.tooltip)?Ext.tip.QuickTipManager.unregister(t):t.dom.removeAttribute(n.getTipAttr())},beforeDestroy:function(){var n=this;n.rendered&&n.clearTip();n.menu&&n.destroyMenu!==!1&&Ext.destroy(n.menu);Ext.destroy(n.btnInnerEl,n.repeater);n.callParent()},onDestroy:function(){var n=this;n.rendered&&(n.doc.un("mouseover",n.monitorMouseOver,n),delete n.doc,Ext.destroy(n.keyMap),delete n.keyMap);Ext.button.Manager.unregister(n);n.callParent()},setHandler:function(n,t){return this.handler=n,this.scope=t,this},setText:function(n){n=n||"";var t=this,i=t.text||"";return n!=i&&(t.text=n,t.rendered&&(t.btnInnerEl.update(n||"&#160;"),t.setComponentCls(),Ext.isStrict&&Ext.isIE8&&t.el.repaint(),t.updateLayout()),t.fireEvent("textchange",t,i,n)),t},didIconStateChange:function(n,t){var i=Ext.isEmpty(t);return Ext.isEmpty(n)?!i:i},getText:function(){return this.text},toggle:function(n,t){var i=this;return n=n===undefined?!i.pressed:!!n,n!==i.pressed&&(i.rendered&&i[n?"addClsWithUI":"removeClsWithUI"](i.pressedCls),i.pressed=n,t||(i.fireEvent("toggle",i,n),Ext.callback(i.toggleHandler,i.scope||i,[i,n]))),i},maybeShowMenu:function(){var n=this;!n.menu||n.hasVisibleMenu()||n.ignoreNextClick||n.showMenu(!0)},showMenu:function(n){var t=this,i=t.menu;return t.rendered&&(t.tooltip&&Ext.quickTipsActive&&t.getTipAttr()!="title"&&Ext.tip.QuickTipManager.getQuickTip().cancelShow(t.el),i.isVisible()&&i.hide(),(!n||t.showEmptyMenu||i.items.getCount()>0)&&i.showBy(t.el,t.menuAlign)),t},hideMenu:function(){return this.hasVisibleMenu()&&this.menu.hide(),this},hasVisibleMenu:function(){var n=this.menu;return n&&n.rendered&&n.isVisible()},onRepeatClick:function(n,t){this.onClick(t)},onClick:function(n){var t=this;((t.preventDefault||t.disabled&&t.getHref()&&n)&&n.preventDefault(),n.type==="keydown"||n.button===0)&&(t.disabled||(t.doToggle(),t.maybeShowMenu(),t.fireHandler(n)))},fireHandler:function(n){var t=this,i=t.handler;t.fireEvent("click",t,n)!==!1&&i&&i.call(t.scope||t,t,n)},doToggle:function(){var n=this;n.enableToggle&&(n.allowDepress!==!1||!n.pressed)&&n.toggle()},onMouseOver:function(n){var t=this;if(!t.disabled&&!n.within(t.el,!0,!0))t.onMouseEnter(n)},onMouseOut:function(n){var t=this;if(!n.within(t.el,!0,!0)){if(t.overMenuTrigger)t.onMenuTriggerOut(n);t.onMouseLeave(n)}},onMouseMove:function(n){var t=this,f=t.el,u=t.overMenuTrigger,i,r;if(t.split)if(i=t.arrowAlign==="right"?n.getX()-t.getX():n.getY()-f.getY(),r=t.getTriggerRegion(),i>r.begin&&i<r.end){if(!u)t.onMenuTriggerOver(n)}else if(u)t.onMenuTriggerOut(n)},getTriggerRegion:function(){var n=this,t=n._triggerRegion,r=n.getTriggerSize(),i=n.arrowAlign==="right"?n.getWidth():n.getHeight();return t.begin=i-r,t.end=i,t},getTriggerSize:function(){var n=this,t=n.triggerSize,i,r;return t==null&&(i=n.arrowAlign,r=i.charAt(0),t=n.triggerSize=n.el.getFrameWidth(r)+n.getBtnWrapFrameWidth(r),n.frameSize&&(t=n.triggerSize+=n.frameSize[i])),t},getBtnWrapFrameWidth:function(n){return this.btnWrap.getFrameWidth(n)},addOverCls:function(){this.disabled||this.addClsWithUI(this.overCls)},removeOverCls:function(){this.removeClsWithUI(this.overCls)},onMouseEnter:function(n){this.fireEvent("mouseover",this,n)},onMouseLeave:function(n){this.fireEvent("mouseout",this,n)},onMenuTriggerOver:function(n){var t=this,i=t.arrowTooltip;t.overMenuTrigger=!0;t.split&&i&&t.btnWrap.dom.setAttribute(t.getTipAttr(),i);t.fireEvent("menutriggerover",t,t.menu,n)},onMenuTriggerOut:function(n){var t=this;delete t.overMenuTrigger;t.split&&t.arrowTooltip&&t.btnWrap.dom.setAttribute(t.getTipAttr(),"");t.fireEvent("menutriggerout",t,t.menu,n)},enable:function(){var n=this;return n.callParent(arguments),n.removeClsWithUI("disabled"),n.rendered&&n.el.dom.setAttribute("tabIndex",n.tabIndex),n},disable:function(){var n=this;return n.callParent(arguments),n.addClsWithUI("disabled"),n.removeClsWithUI(n.overCls),n.rendered&&n.el.dom.removeAttribute("tabIndex"),n.btnInnerEl&&Ext.isIE7m&&n.btnInnerEl.repaint(),n},setScale:function(n){var t=this,i=t.ui.replace("-"+t.scale,"");if(!Ext.Array.contains(t.allowedScales,n))throw"#setScale: scale must be an allowed scale ("+t.allowedScales.join(", ")+")";t.scale=n;t.setUI(i)},setUI:function(n){var t=this;t.scale&&!n.match(t.scale)&&(n=n+"-"+t.scale);t.callParent([n])},onMouseDown:function(n){var t=this;if(Ext.isIE&&t.getFocusEl().focus(),!t.disabled&&n.button===0){Ext.button.Manager.onButtonMousedown(t,n);t.addClsWithUI(t.pressedCls)}},onMouseUp:function(n){var t=this;n.button===0&&(t.pressed||t.removeClsWithUI(t.pressedCls))},onMenuShow:function(){var n=this;n.ignoreNextClick=0;n.addClsWithUI(n.menuActiveCls);n.fireEvent("menushow",n,n.menu)},onMenuHide:function(){var n=this;n.removeClsWithUI(n.menuActiveCls);n.ignoreNextClick=Ext.defer(n.restoreClick,250,n);n.fireEvent("menuhide",n,n.menu);n.focus()},restoreClick:function(){this.ignoreNextClick=0},onDownKey:function(n,t){var i=this;if(i.menu&&!i.disabled)return i.showMenu(),t.stopEvent(),!1}})